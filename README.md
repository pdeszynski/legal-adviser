# Legal AI Platform

A modern AI-powered legal assistance platform built with Domain-Driven Design principles and a Modular Monolith architecture.

## üèóÔ∏è Architecture

This project is structured as a **monorepo** containing three main applications:

- **Frontend** (`apps/web`): Next.js + Refine.dev + Shadcn UI + Tailwind CSS
- **Backend** (`apps/backend`): Nest.js Modular Monolith with GraphQL API
- **AI Engine** (`apps/ai-engine`): Python FastAPI service with PydanticAI and LangGraph

### Key Principles

- **Domain-Driven Design (DDD)**: Deep domain modeling of legal concepts
- **Modular Monolith**: Strict module boundaries with event-driven communication
- **CQRS**: Separate read/write models where it matters
- **AI-First**: Complex agentic workflows for legal document generation and analysis
- **Strong Typing**: No `any` or untyped dictionaries
- **Code-First**: API schemas autogenerated from code

## üìã Prerequisites

- **Node.js**: 20+
- **Python**: 3.11+
- **PNPM**: Latest version (package manager for Node.js)
- **UV**: Latest version (package manager for Python)
- **Docker**: For PostgreSQL and Redis
- **Docker Compose**: For orchestrating services

## üöÄ Getting Started

### 1. Install Dependencies

#### Install Package Managers

```bash
# Install PNPM (if not already installed)
npm install -g pnpm

# Install UV (if not already installed)
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Install Project Dependencies

```bash
# Install all Node.js dependencies (monorepo)
pnpm install

# Install Python dependencies for AI Engine
cd apps/ai-engine
uv sync
cd ../..
```

### 2. Start Infrastructure Services

Start PostgreSQL and Redis using Docker Compose:

```bash
docker-compose up -d
```

This will start:
- **PostgreSQL** on `localhost:5432`
  - Database: `legal_ai_db`
  - User: `postgres`
  - Password: `password`
- **Redis** on `localhost:6379`

### 3. Environment Configuration

Create `.env` files for each application:

#### Backend (`apps/backend/.env`)
```env
DATABASE_URL=postgresql://postgres:password@localhost:5432/legal_ai_db
REDIS_URL=redis://localhost:6379
JWT_SECRET=your-secret-key-here
AI_ENGINE_URL=http://localhost:8000
```

#### AI Engine (`apps/ai-engine/.env`)
```env
# Add your AI provider API keys
OPENAI_API_KEY=your-openai-key
# or other AI provider credentials
```

#### Frontend (`apps/web/.env.local`)
```env
NEXT_PUBLIC_API_URL=http://localhost:3001/graphql
```

### 4. Database Setup

The database will be automatically set up when you run the backend for the first time. TypeORM will handle entity synchronization in development mode.

For production, you'll need to set up migrations. Add the following scripts to `apps/backend/package.json`:

```json
"typeorm": "typeorm-ts-node-commonjs",
"migration:generate": "npm run typeorm -- migration:generate",
"migration:run": "npm run typeorm -- migration:run",
"migration:revert": "npm run typeorm -- migration:revert"
```

## üèÉ Running the Project

### Development Mode

You can run all services simultaneously from the root or individually:

#### Run All Services (Recommended)

```bash
# From root directory
pnpm dev
```

#### Run Individual Services

**Frontend:**
```bash
cd apps/web
pnpm dev
# Runs on http://localhost:3000
```

**Backend:**
```bash
cd apps/backend
pnpm start:dev
# Runs on http://localhost:3001
# GraphQL Playground: http://localhost:3001/graphql
```

**AI Engine:**
```bash
cd apps/ai-engine
uv run uvicorn src.main:app --reload
# Runs on http://localhost:8000
# API Docs: http://localhost:8000/docs
```

### Production Mode

```bash
# Build all applications
pnpm build

# Start production servers individually:

# Frontend
cd apps/web
pnpm start

# Backend
cd apps/backend
pnpm start:prod

# AI Engine
cd apps/ai-engine
uv run uvicorn src.main:app --host 0.0.0.0 --port 8000
```

## üß™ Running Tests

### All Tests (Monorepo)

```bash
# Run all tests across all packages
pnpm test

# Run tests in watch mode
pnpm test:watch

# Run tests with coverage
pnpm test:cov
```

### Frontend Tests

```bash
cd apps/web
pnpm test
```

### Backend Tests

```bash
cd apps/backend

# Unit tests (all .spec.ts files)
pnpm test

# Run tests in watch mode
pnpm test:watch

# Integration tests
pnpm test:integration

# E2E tests
pnpm test:e2e

# Run with coverage
pnpm test:cov

# Debug tests
pnpm test:debug
```

### AI Engine Tests

```bash
cd apps/ai-engine

# Unit tests
uv run pytest tests/unit

# Integration tests
uv run pytest tests/integration

# E2E tests
uv run pytest tests/e2e

# All tests with coverage
uv run pytest --cov=src tests/
```

## üèóÔ∏è Building the Project

### Build All Applications

```bash
# From root directory
pnpm build
```

### Build Individual Applications

**Frontend:**
```bash
cd apps/web
pnpm build
# Output in .next/ directory
```

**Backend:**
```bash
cd apps/backend
pnpm build
# Output in dist/ directory
```

**AI Engine:**
```bash
cd apps/ai-engine
uv build
```

### Docker Build

```bash
# Build Docker images for production
docker build -t legal-ai-web -f apps/web/Dockerfile .
docker build -t legal-ai-backend -f apps/backend/Dockerfile .
docker build -t legal-ai-engine -f apps/ai-engine/Dockerfile .
```

## üîç Linting & Code Quality

### Run Linters

**All Projects:**
```bash
# From root directory (runs lint on all apps via Turbo)
pnpm lint
```

**Frontend:**
```bash
cd apps/web
pnpm lint
# Note: Frontend eslint doesn't have auto-fix configured
```

**Backend:**
```bash
cd apps/backend
pnpm lint
# Note: Backend lint command includes --fix flag automatically
```

**AI Engine:**
```bash
cd apps/ai-engine
# Install ruff if not already available
uv add --dev ruff

# Check for issues
uv run ruff check .

# Auto-fix issues
uv run ruff check --fix .

# Format code
uv run ruff format .
```

### Format Code

**All Projects:**
```bash
# From root directory (formats TypeScript files)
pnpm format
```

**Backend Only:**
```bash
cd apps/backend
pnpm format
```

**AI Engine:**
```bash
cd apps/ai-engine
uv run ruff format .
```

### Type Checking

**TypeScript Projects:**
```bash
# TypeScript compilation check
cd apps/backend
pnpm build  # This will check types during build

cd apps/web
pnpm build  # This will check types during build
```

**Python Project:**
```bash
cd apps/ai-engine
# Install mypy if not already available
uv add --dev mypy

# Run type checking
uv run mypy src/
```

## üìö Additional Commands

### Code Generation

**Generate GraphQL Types (Frontend):**
```bash
cd apps/web
# Note: GraphQL codegen needs to be configured first
# Install: pnpm add -D @graphql-codegen/cli @graphql-codegen/client-preset
# Then configure codegen.yml and add script to package.json
pnpm codegen
```

**Export OpenAPI Schema (AI Engine):**
```bash
cd apps/ai-engine
uv run python src/export_openapi.py
```

### Database Management

```bash
cd apps/backend

# Note: Migration commands need to be added to package.json first
# See "Database Setup" section above for script configuration

# Generate migration (after setup)
pnpm migration:generate -- -n MigrationName

# Run migrations (after setup)
pnpm migration:run

# Revert last migration (after setup)
pnpm migration:revert
```

### View Queue Dashboard (Bull Board)

When the backend is running, visit:
```
http://localhost:3001/admin/queues
```

## üåç Internationalization

The platform supports multiple languages:
- English (default)
- Polish
- German

Locale files are located in `apps/web/public/locales/`.

## üìñ Documentation

- **Constitution**: `.specify/memory/constitution.md` - Core principles and constraints
- **Specifications**: `specs/` - Feature specifications and implementation plans
- **API Documentation**:
  - GraphQL Playground: `http://localhost:3001/graphql` (Backend)
  - OpenAPI Docs: `http://localhost:8000/docs` (AI Engine)

## ü§ù Contributing

### Commit Convention

This project follows [Conventional Commits](https://www.conventionalcommits.org/):

```bash
feat: add new feature
fix: bug fix
docs: documentation changes
chore: maintenance tasks
test: add or update tests
refactor: code refactoring
```

### Workflow

1. **Specification** ‚Üí 2. **Planning** ‚Üí 3. **Implementation** ‚Üí 4. **Verification**

All features must follow the SpecKit workflow defined in `.specify/`.

## üìù License

[Add your license here]

## üÜò Troubleshooting

### Database Connection Issues

```bash
# Check if PostgreSQL is running
docker ps | grep legal-ai-db

# Restart database
docker-compose restart postgres
```

### Port Already in Use

If you get port conflicts, check and kill processes:
```bash
# Check what's using port 3000 (frontend)
lsof -i :3000

# Check what's using port 3001 (backend)
lsof -i :3001

# Check what's using port 8000 (AI engine)
lsof -i :8000
```

### Clear All Data and Restart

```bash
# Stop all services
docker-compose down -v

# Remove node_modules and reinstall
rm -rf node_modules apps/*/node_modules packages/*/node_modules
pnpm install

# Restart infrastructure
docker-compose up -d
```

## üìû Support

For questions or issues, please refer to the project documentation in the `specs/` directory or open an issue in the repository.

