<?xml version="1.0" encoding="UTF-8"?>
<project_specification>
  <project_name>Legal AI Platform</project_name>

  <overview>
    A comprehensive AI-powered legal assistance platform designed to help lawyers and regular users with legal document generation, legal Q&amp;A with citations, case law search, and legal grounds identification. Built following Domain-Driven Design principles with a Modular Monolith architecture, the platform uses AI agents powered by LangGraph and PydanticAI to draft precise, professional legal documents in Polish. The system emphasizes strong typing, code-first API schemas, event-driven inter-module communication, and strict architectural boundaries. Targeting the Polish legal market, it supports multi-language interfaces with Polish-language AI prompts for authentic legal terminology.
  </overview>

  <technology_stack>
    <technology>Turborepo - Monorepo orchestration</technology>
    <technology>PNPM - Node.js package management</technology>
    <technology>UV - Python package management</technology>
    <technology>Refine.dev backed up with Next.js - Data framework for admin/CRUD operations</technology>
    <technology>Tailwind CSS - Utility-first styling</technology>
    <technology>shadcn/ui - UI component library</technology>
    <technology>next-intl - Internationalization (i18n) support</technology>
    <technology>NestJS 11 - Backend framework</technology>
    <technology>GraphQL with Apollo Server - Primary API layer</technology>
    <technology>@ptc-org/nestjs-query - Auto-generated CRUD resolvers</technology>
    <technology>TypeORM - Database ORM</technology>
    <technology>PostgreSQL - Primary database</technology>
    <technology>Passport.js + JWT - Authentication</technology>
    <technology>EventEmitter2 - Event-driven module communication</technology>
    <technology>Bull + Redis - Asynchronous job queues</technology>
    <technology>Python 3.11+ - AI Engine runtime</technology>
    <technology>FastAPI - AI service HTTP framework</technology>
    <technology>PydanticAI - Structured AI responses</technology>
    <technology>LangGraph - Agent orchestration workflows</technology>
    <technology>OpenAI API - LLM provider</technology>
    <technology>Pydantic Settings - Configuration management</technology>
    <technology>Ruff - Python linting</technology>
    <technology>ESLint + Prettier - TypeScript/JavaScript linting</technology>
    <technology>Jest - Backend testing</technology>
    <technology>pytest - AI Engine testing</technology>
  </technology_stack>

  <core_capabilities>
    <capability>AI-powered legal document generation from natural language descriptions</capability>
    <capability>Drafting complaints, lawsuits, and other legal pleadings in Polish</capability>
    <capability>Legal Q&amp;A assistant with RAG (Retrieval Augmented Generation) and citations</capability>
    <capability>Case law and court ruling search functionality</capability>
    <capability>Legal grounds identification from situation descriptions</capability>
    <capability>Multi-language UI support (English, German, Polish)</capability>
    <capability>Event-driven modular backend architecture</capability>
    <capability>GraphQL-first frontend-backend communication</capability>
    <capability>REST-based Backend-AI Engine service communication</capability>
    <capability>Asynchronous document generation with status tracking</capability>
    <capability>User session management and authentication</capability>
    <capability>PDF document export (planned)</capability>
  </core_capabilities>

  <implemented_features>
    <feature>
      <name>Turborepo Monorepo Structure</name>
      <description>Complete monorepo setup with apps/web, apps/backend, apps/ai-engine directories and shared packages for UI components and types</description>
      <file_locations>
        <location>package.json</location>
        <location>turbo.json</location>
        <location>packages/ui/</location>
        <location>packages/types/</location>
      </file_locations>
    </feature>
    <feature>
      <name>Next.js Frontend with Refine</name>
      <description>Frontend application with Next.js 15, React 19, Refine.dev data framework, Tailwind CSS styling, and shadcn/ui components. Includes routing, layout system, and theme support</description>
      <file_locations>
        <location>apps/web/src/app/</location>
        <location>apps/web/src/providers/</location>
        <location>apps/web/src/components/</location>
      </file_locations>
    </feature>
    <feature>
      <name>NestJS Modular Monolith Backend</name>
      <description>Backend with NestJS featuring GraphQL API (Apollo Server), TypeORM database integration, modular architecture with Users, Documents, and Auth modules</description>
      <file_locations>
        <location>apps/backend/src/app.module.ts</location>
        <location>apps/backend/src/modules/</location>
      </file_locations>
    </feature>
    <feature>
      <name>GraphQL Data Provider</name>
      <description>Custom GraphQL data provider for Refine frontend connecting to NestJS backend with queries and mutations for document operations</description>
      <file_locations>
        <location>apps/web/src/providers/data-provider/index.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>LegalDocument Entity and GraphQL Schema</name>
      <description>Complete legal document domain model with TypeORM entity, GraphQL types, enums (LAWSUIT, COMPLAINT, CONTRACT, OTHER), status tracking (DRAFT, GENERATING, COMPLETED, FAILED), and metadata support</description>
      <file_locations>
        <location>apps/backend/src/modules/documents/entities/legal-document.entity.ts</location>
        <location>apps/backend/src/modules/documents/dto/document.types.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Documents GraphQL Resolver</name>
      <description>GraphQL resolver with queries (documents, document, documentsBySession) and mutations (generateDocument, updateDocument, deleteDocument) for document operations</description>
      <file_locations>
        <location>apps/backend/src/modules/documents/documents.resolver.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Document Generation Form</name>
      <description>React form component for creating legal documents with title, type selection, and metadata fields (plaintiff/defendant names, claim amount, currency)</description>
      <file_locations>
        <location>apps/web/src/app/documents/create/page.tsx</location>
      </file_locations>
    </feature>
    <feature>
      <name>User and Session Entities</name>
      <description>User entity with email, profile fields, disclaimer acceptance tracking, and related UserSession entity for session management</description>
      <file_locations>
        <location>apps/backend/src/modules/users/entities/user.entity.ts</location>
        <location>apps/backend/src/modules/users/entities/user-session.entity.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Event-Driven Architecture Foundation</name>
      <description>EventEmitter2 integration with base event classes, naming conventions (domain.entity.action), and example event implementations for inter-module communication</description>
      <file_locations>
        <location>apps/backend/src/shared/events/base/</location>
        <location>apps/backend/src/shared/events/examples/</location>
      </file_locations>
    </feature>
    <feature>
      <name>Bull Queue Infrastructure</name>
      <description>Redis-backed Bull queue setup with queue names for document generation, PDF export, email notifications, and AI processing tasks</description>
      <file_locations>
        <location>apps/backend/src/shared/queues/</location>
        <location>apps/backend/src/app.module.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>AI Engine FastAPI Service</name>
      <description>Python FastAPI service with REST endpoints for document generation, Q&amp;A, and ruling search. Includes OpenAPI documentation and health check</description>
      <file_locations>
        <location>apps/ai-engine/src/main.py</location>
        <location>apps/ai-engine/src/models/</location>
      </file_locations>
    </feature>
    <feature>
      <name>LangGraph Drafting Workflow</name>
      <description>LangGraph StateGraph implementation for document drafting with typed state, generate_draft_node, and async execution</description>
      <file_locations>
        <location>apps/ai-engine/src/graphs/drafting_graph.py</location>
      </file_locations>
    </feature>
    <feature>
      <name>PydanticAI Drafting Agent</name>
      <description>PydanticAI agent configured as expert Polish lawyer (Radca Prawny) for drafting legal documents with structured output (DraftResult model)</description>
      <file_locations>
        <location>apps/ai-engine/src/agents/drafting_agent.py</location>
      </file_locations>
    </feature>
    <feature>
      <name>AI Client Service</name>
      <description>NestJS service for Backend-AI Engine communication via REST with typed methods for document generation, Q&amp;A, and ruling search</description>
      <file_locations>
        <location>apps/backend/src/shared/ai-client/ai-client.service.ts</location>
        <location>apps/backend/src/shared/ai-client/ai-client.types.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Internationalization (i18n) Structure</name>
      <description>next-intl configuration with support for English, German, and Polish locales, locale switching, and translation integration with Refine i18nProvider</description>
      <file_locations>
        <location>apps/web/src/i18n/config.ts</location>
        <location>apps/web/src/i18n/index.ts</location>
        <location>apps/web/src/app/_refine_context.tsx</location>
      </file_locations>
    </feature>
    <feature>
      <name>Authentication Module (Partial)</name>
      <description>Basic auth module with Passport.js, JWT strategy, and REST controller. Note: Requires rework to GraphQL mutations per constitution</description>
      <file_locations>
        <location>apps/backend/src/modules/auth/auth.module.ts</location>
        <location>apps/backend/src/modules/auth/jwt.strategy.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Mock Auth Provider</name>
      <description>Client-side mock authentication provider for development with cookie-based session storage</description>
      <file_locations>
        <location>apps/web/src/providers/auth-provider/auth-provider.client.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Document Completion Email Notification</name>
      <description>Send email notification when document generation completes successfully. Include document title, download link, and next steps.</description>
    </feature>
    <feature>
      <name>Domain Events Infrastructure</name>
      <description>Implement domain event system for inter-aggregate communication. Create event bus, event handlers, and integrate with message queue for async processing and eventual consistency.</description>
    </feature>
    <feature>
      <name>Classifier FastAPI Endpoint</name>
      <description>Add POST /api/v1/classify endpoint to AI Engine. Accept case description text, return array of identified legal grounds with articles and confidence.</description>
    </feature>
    <feature>
      <name>Legal Grounds Classifier Agent</name>
      <description>Create PydanticAI agent to analyze case descriptions and identify applicable legal grounds. Return structured classification with confidence scores.</description>
    </feature>
    <feature>
      <name>Analyze Case Page</name>
      <description>Create page for case analysis with textarea for description input. Display identified legal grounds as cards with article references and explanations.</description>
    </feature>
    <feature>
      <name>Classifier Backend Integration</name>
      <description>Extend AI Client Service with classifyCase method. Create GraphQL mutation for case analysis and store results in new LegalAnalysis entity.</description>
    </feature>
    <feature>
      <name>RAG Vector Store Setup</name>
      <description>Implement vector database (Pinecone, Weaviate, or pgvector) for storing legal document embeddings. Set up indexing pipeline for Polish legal texts.</description>
    </feature>
    <feature>
      <name>RAG Retrieval Logic</name>
      <description>Implement semantic search over vector store to retrieve relevant legal context. Integrate retrieval results into Q&amp;A agent prompts for grounded responses.</description>
    </feature>
    <feature>
      <name>Q&amp;A LangGraph Workflow</name>
      <description>Create LangGraph StateGraph for Q&amp;A flow with nodes for query analysis, context retrieval, answer generation, and citation formatting. Please take some ideas from a langchain graph in Flowise.ai</description>
    </feature>
    <feature>
      <name>Configure Husky for Git Hooks</name>
      <description>Install and configure Husky to manage Git hooks automatically. Set up .husky directory structure and initialize git hooks in the repository. Enable automatic hook execution on git operations.</description>
    </feature>
    <feature>
      <name>Configure lint-staged for File Filtering</name>
      <description>Install and configure lint-staged to run commands only on staged files. Set up configuration to match TypeScript, JavaScript, and Python files. Prevents running linters on the entire codebase unnecessarily.</description>
    </feature>
    <feature>
      <name>Commit Message Conventional Commits Validation</name>
      <description>Add commit-msg Git hook to validate commit messages follow Conventional Commits specification. Use commitlint to enforce format (feat:, fix:, docs:, etc.). Block non-compliant commit messages.</description>
    </feature>
    <feature>
      <name>Q&amp;A FastAPI Endpoint</name>
      <description>Add POST /api/v1/qa endpoint to AI Engine. Accept question text, return structured response with answer and citation array.</description>
    </feature>
    <feature>
      <name>Fix Pagination Implementation Across All List Views</name>
      <description>Investigate and fix pagination issues in Refine-based list views. Verify pagination is working correctly for audit logs, documents, legal queries, and other resources. Ensure nestjs-query resolvers are properly configured with paging options and frontend is correctly passing cursor/pagination parameters.</description>
    </feature>
    <feature>
      <name>Pre-commit Type Check Hook</name>
      <description>Create pre-commit Git hook that runs TypeScript type checking (tsc --noEmit) for backend and frontend. Block commits if type errors are detected. Ensures type safety before code enters the repository.</description>
    </feature>
    <feature>
      <name>Pre-commit Lint Hook</name>
      <description>Create pre-commit Git hook that runs ESLint for TypeScript/JavaScript files and Ruff/Black for Python files. Block commits if linting errors are found. Configure lint-staged to run appropriate linters based on file extensions.</description>
    </feature>
    <feature>
      <name>Q&amp;A Backend Integration</name>
      <description>Extend AI Client Service with askQuestion method. Implement GraphQL mutation in backend to trigger Q&amp;A workflow and store results.</description>
    </feature>
    <feature>
      <name>Optimize Docker layer caching with reordered Dockerfile instructions</name>
      <description>Optimize Dockerfiles for Layer Caching

Restructure Dockerfile COPY instructions to maximize Docker layer cache efficiency by separating dependency installation from source code changes.

Technical Implementation:
- Reorder Dockerfile instructions to copy dependency manifests first (package.json, requirements.txt, go.mod, Gemfile, etc.)
- Run dependency installation commands (npm install, pip install, go mod download, bundle install)
- Copy remaining application source code last
- Ensure .dockerignore excludes build artifacts, node_modules, and development files

Pattern to Apply:
```
# Before: Cache-busting pattern
COPY . /app
RUN npm install

# After: Cache-optimized pattern
COPY package*.json /app/
RUN npm install
COPY . /app/
```

Files to Modify:
- All Dockerfiles in repository (./Dockerfile, services/*/Dockerfile, etc.)
- Update .dockerignore if missing (exclude node_modules, .git, dist/, build/, __pycache__)

Language-Specific Considerations:
- Node.js: Copy package.json + package-lock.json before npm ci/install
- Python: Copy requirements.txt/Pipfile before pip install
- Go: Copy go.mod + go.sum before go mod download
- Java/Maven: Copy pom.xml before mvn dependency:resolve
- Ruby: Copy Gemfile + Gemfile.lock before bundle install

Additional Optimizations:
- Use multi-stage builds to separate build dependencies from runtime
- Combine RUN commands to reduce layers where appropriate
- Consider BuildKit cache mounts for further optimization
- Add --no-cache flags for production builds in CI/CD

Validation:
- Test builds with and without cache to verify layer reuse
- Measure build time improvement (expect 50-90% reduction on cached builds)
- Ensure application functionality unchanged after restructuring</description>
    </feature>
    <feature>
      <name>Chat Interface Component</name>
      <description>Create chat UI component with message history, input field, and streaming support. Display user questions and AI responses with citations.</description>
    </feature>
    <feature>
      <name>Ruling Search Service</name>
      <description>Create search service aggregating results from SAOS, ISAP, and local database. Implement ranking algorithm prioritizing relevance and recency.</description>
    </feature>
    <feature>
      <name>Ruling Search GraphQL Query</name>
      <description>Implement custom GraphQL query for searching rulings with filters for date range, court type, and keywords. Return paginated results with highlights.</description>
    </feature>
    <feature>
      <name>Legal Q&amp;A Chat Page</name>
      <description>Implement dedicated Q&amp;A page with chat interface. Include session management, conversation history, and mode toggle for Pro/Simple chat modes.</description>
    </feature>
    <feature>
      <name>Ruling Detail Page</name>
      <description>Implement detail view for individual court rulings. Display full text, metadata, related rulings, and export options.</description>
    </feature>
    <feature>
      <name>Verify GraphQL Pagination Arguments</name>
      <description>Verify all nestjs-query resolvers have proper paging argument types configured. Check that @OffsetPaging or @CursorPaging decorators are applied correctly. Ensure GraphQL schema includes paging fields (forward, backward, limit, offset). Test pagination queries for each entity type.</description>
    </feature>
    <feature>
      <name>Case Law Search Page</name>
      <description>Create search page with advanced filters and result list. Include search input, filter sidebar, and result cards with ruling summaries.</description>
    </feature>
    <feature>
      <name>Verify Refine Paginator Configuration</name>
      <description>Check that Refine data provider is correctly mapping pagination parameters to GraphQL queries. Verify useTable hook pagination mode matches backend implementation (offset vs cursor). Ensure pagination metadata (total, pageCount) is being properly extracted from GraphQL responses.</description>
    </feature>
    <feature>
      <name>Citation Rendering Component</name>
      <description>Create component to display legal citations with proper formatting. Support links to source documents and hover previews of cited text.</description>
    </feature>
    <feature>
      <name>Error Tracking Integration</name>
      <description>Integrate Sentry or similar error tracking service. Capture exceptions from frontend, backend, and AI engine with context.</description>
    </feature>
    <feature>
      <name>Shared Kernel Package</name>
      <description>Create shared kernel package in monorepo containing common value objects, base classes, interfaces, and utilities used across bounded contexts. Minimize sharing to maintain context independence.</description>
    </feature>
    <feature>
      <name>Update Mock Credentials Configuration</name>
      <description>Synchronize mock credentials between frontend and backend. Either update auth.service.ts to accept admin@refine.dev/123456 or update frontend login-content.tsx to use admin/password. Ensure consistency for demo/development authentication.</description>
    </feature>
    <feature>
      <name>Complete German Translations</name>
      <description>Add comprehensive German translations for all UI strings. Support German-speaking users accessing the platform.</description>
    </feature>
    <feature>
      <name>Anti-Corruption Layer for External APIs</name>
      <description>Implement anti-corruption layers for external integrations (SAOS, ISAP, AI Engine). Translate external models to domain models and isolate domain from external API changes.</description>
    </feature>
    <feature>
      <name>ISAP API Integration</name>
      <description>Implement integration with ISAP (Internetowy System Akt√≥w Prawnych) for legal act search. Create service layer for fetching Polish legislation.</description>
    </feature>
    <feature>
      <name>Health Check Endpoints</name>
      <description>Implement comprehensive health check endpoints for all services. Check database connectivity, Redis, AI Engine, and external APIs.</description>
    </feature>
    <feature>
      <name>Legal Grounds Suggestion Component</name>
      <description>Create reusable component displaying suggested legal grounds with confidence indicators. Support inline usage in document creation form.</description>
    </feature>
    <feature>
      <name>Structured Logging Infrastructure</name>
      <description>Implement structured logging with Winston or Pino. Use consistent log format with correlation IDs across services.</description>
    </feature>
    <feature>
      <name>Notification Entity</name>
      <description>Create Notification entity for in-app notifications. Store notification type, message, read status, action link, and timestamp.</description>
    </feature>
    <feature>
      <name>Locale Switcher Component</name>
      <description>Create dropdown component for switching between English, Polish, and German. Store preference in user settings and URL param.</description>
    </feature>
    <feature>
      <name>Notification Service</name>
      <description>Implement service for creating and managing notifications. Support different notification types with templates and delivery rules.</description>
    </feature>
    <feature>
      <name>Application Monitoring</name>
      <description>Set up APM monitoring with Datadog or New Relic. Track request latency, database queries, and AI API performance.</description>
    </feature>
    <feature>
      <name>Notification GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to Notification entity. Implement subscription for real-time notifications and mutation to mark as read.</description>
    </feature>
    <feature>
      <name>Notification Bell Component</name>
      <description>Create notification bell icon in header with unread count badge. Show dropdown with recent notifications on click.</description>
    </feature>
    <feature>
      <name>PDF Export Queue Processor</name>
      <description>Create Bull queue consumer for asynchronous PDF generation. Handle large documents, template rendering, and file storage integration.</description>
    </feature>
    <feature>
      <name>PDF Download GraphQL Field</name>
      <description>Add pdfUrl field to LegalDocument GraphQL type. Implement resolver that triggers PDF generation if needed and returns signed download URL.</description>
    </feature>
    <feature>
      <name>Pre-commit Format Check</name>
      <description>Create pre-commit hook to verify code formatting using Prettier for TypeScript/JavaScript and Black for Python. Either block commits on formatting issues or auto-format files using lint-staged --autofix capability.</description>
    </feature>
    <feature>
      <name>Document Permission Guards</name>
      <description>Implement NestJS guards checking document access permissions on all resolvers. Enforce read/write access control based on user roles.</description>
    </feature>
    <feature>
      <name>Ruling Indexing Background Job</name>
      <description>Create Bull queue processor for periodically fetching and indexing new rulings from external sources. Schedule daily sync jobs.</description>
    </feature>
    <feature>
      <name>Global Search Bar</name>
      <description>Create omnisearch component in header with autocomplete. Show mixed results from documents, rulings, and templates with type indicators.</description>
    </feature>
    <feature>
      <name>Global Search Service</name>
      <description>Implement full-text search across documents, rulings, and queries using PostgreSQL full-text search or Elasticsearch. Support fuzzy matching and ranking.</description>
    </feature>
    <feature>
      <name>Share Document Dialog</name>
      <description>Create modal for sharing documents with user selection, role assignment, and link generation. Display list of current collaborators.</description>
    </feature>
    <feature>
      <name>Document Template Entity</name>
      <description>Create DocumentTemplate entity for storing reusable templates. Include template name, type, content with variables, and metadata schema.</description>
    </feature>
    <feature>
      <name>Template GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to DocumentTemplate entity. Implement custom mutations for template rendering with variable substitution.</description>
    </feature>
    <feature>
      <name>Template Library Page</name>
      <description>Create page displaying available document templates. Support filtering by type, preview, and &apos;Use Template&apos; action to start document creation.</description>
    </feature>
    <feature>
      <name>Usage Tracking Service</name>
      <description>Implement service tracking AI API usage per user. Store token counts, request counts, and costs for billing purposes.</description>
    </feature>
    <feature>
      <name>Usage Records Entity</name>
      <description>Create UsageRecord entity storing per-request AI usage. Include user ID, operation type, tokens used, cost, and timestamp.</description>
    </feature>
    <feature>
      <name>Usage Quota Enforcement</name>
      <description>Implement quota checking before AI operations. Block requests exceeding user&apos;s plan limits with clear error messages.</description>
    </feature>
    <feature>
      <name>User Preferences Entity</name>
      <description>Create UserPreferences entity for storing user settings. Include notification preferences, default locale, theme preference, and AI model selection.</description>
    </feature>
    <feature>
      <name>User Settings Page</name>
      <description>Create settings page with tabs for profile, preferences, security, and notifications. Support updating email, password, and all preference fields.</description>
    </feature>
    <feature>
      <name>User Preferences GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to UserPreferences entity. Implement mutations for updating preferences.</description>
    </feature>
    <feature>
      <name>Admin Panel Layout</name>
      <description>Create separate admin area with navigation and role-based access. Use Refine admin templates for CRUD operations.</description>
    </feature>
    <feature>
      <name>Analytics Dashboard</name>
      <description>Create admin dashboard with platform analytics. Show user growth, document generation metrics, and system health indicators.</description>
    </feature>
    <feature>
      <name>API Keys Entity</name>
      <description>Create ApiKey entity for programmatic access. Store hashed keys, scopes, rate limits, and expiration dates.</description>
    </feature>
    <feature>
      <name>Advanced Search Page</name>
      <description>Create dedicated search page with advanced filters. Support boolean operators, date ranges, document type filters, and field-specific search.</description>
    </feature>
    <feature>
      <name>API Key Authentication</name>
      <description>Implement API key authentication strategy for GraphQL API. Support both JWT and API key auth methods.</description>
    </feature>
    <feature>
      <name>Database Backup Strategy</name>
      <description>Implement automated database backup with point-in-time recovery. Store backups in secure cloud storage with retention policy.</description>
    </feature>
    <feature>
      <name>API Key Management Interface</name>
      <description>Create settings page section for managing API keys. Support creating, revoking, and viewing key usage statistics.</description>
    </feature>
    <feature>
      <name>Document Collaboration System</name>
      <description>Implement real-time collaborative editing using WebSockets or CRDTs. Support multiple users editing documents simultaneously with conflict resolution.</description>
    </feature>
    <feature>
      <name>Document Comments Entity</name>
      <description>Create DocumentComment entity for inline document feedback. Store comment text, position/anchor, author, timestamp, and resolution status.</description>
    </feature>
    <feature>
      <name>Disaster Recovery Procedures</name>
      <description>Document and test disaster recovery procedures. Include database restoration, service failover, and data integrity verification.</description>
    </feature>
    <feature>
      <name>Comment System UI</name>
      <description>Create commenting interface with inline annotations. Display comment threads, reply chains, and resolve/unresolve actions.</description>
    </feature>
    <feature>
      <name>Notification Center Page</name>
      <description>Create dedicated page showing all notifications with filtering. Support bulk mark as read and notification preferences.</description>
    </feature>
    <feature>
      <name>Document Moderation Interface</name>
      <description>Create admin interface for reviewing flagged documents. Support approval, rejection, and user notification workflows.</description>
    </feature>
    <feature>
      <name>Subscription Plans Entity</name>
      <description>Create SubscriptionPlan and UserSubscription entities. Define plan tiers with feature flags, quotas, and pricing.</description>
    </feature>
    <feature>
      <name>Subscription Management Service</name>
      <description>Implement service for managing user subscriptions. Handle plan upgrades, downgrades, and feature access control.</description>
    </feature>
    <feature>
      <name>Payment Gateway Integration</name>
      <description>Integrate Stripe or similar payment provider. Handle subscription payments, webhooks, and invoice generation.</description>
    </feature>
    <feature>
      <name>Billing and Subscription Page</name>
      <description>Create page for viewing subscription status and payment history. Support plan changes and payment method updates.</description>
    </feature>
    <feature>
      <name>System Settings Admin Panel</name>
      <description>Create interface for configuring system-wide settings. Include AI model selection, feature flags, and maintenance mode.</description>
    </feature>
    <feature>
      <name>Template Editor Interface</name>
      <description>Create admin interface for creating and editing templates. Include rich text editor with variable insertion and preview mode.</description>
    </feature>
    <feature>
      <name>Usage Dashboard</name>
      <description>Create page showing user&apos;s AI usage statistics. Display charts for daily usage, remaining quota, and cost breakdown.</description>
    </feature>
    <feature>
      <name>Admin User Management</name>
      <description>Create admin interface for managing users. Support viewing, editing, suspending accounts, and resetting passwords.</description>
    </feature>
    <feature>
      <name>Webhook Delivery Queue</name>
      <description>Create Bull queue processor for delivering webhooks with retry logic. Log delivery attempts and handle failures gracefully.</description>
    </feature>
    <feature>
      <name>Webhook Configuration Entity</name>
      <description>Create WebhookConfig entity storing endpoint URLs, event subscriptions, authentication headers, and status.</description>
    </feature>
    <feature>
      <name>Webhook System</name>
      <description>Implement webhook delivery system for external integrations. Support subscribing to events like document.completed and query.answered.</description>
    </feature>
    <feature>
      <name>Fix Backend-Specific Build Errors</name>
      <description>Address TypeScript compilation errors, missing imports, incorrect type definitions, or decorator usage issues in NestJS backend. Verify all @nestjs-query decorators are properly configured and GraphQL schema generation works. Fix any circular dependency issues between modules.</description>
    </feature>
    <feature>
      <name>AI Streaming Response Handler</name>
      <description>Implement server-sent events or GraphQL subscriptions for real-time document generation progress. Stream partial results from AI Engine to frontend for improved UX.</description>
    </feature>
    <feature>
      <name>Audit Log Entity</name>
      <description>Create AuditLog entity for tracking all user actions. Store action type, resource ID, user ID, timestamp, IP address, and change details.</description>
    </feature>
    <feature>
      <name>Refine Audit Log Provider</name>
      <description>Implement Refine auditLogProvider to display action history in UI. Show &apos;who did what when&apos; across all resources.</description>
    </feature>
    <feature>
      <name>Audit Logging Interceptor</name>
      <description>Create NestJS interceptor in presentation layer to capture GraphQL mutations. Implement application service for audit log creation following use case pattern. Publish domain events for audit tracking and store in AuditLog entity through repository, maintaining layered architecture separation.</description>
    </feature>
    <feature>
      <name>Frontend GraphQL Auth Provider</name>
      <description>Replace mock auth provider with real GraphQL-based authentication. Implement login, logout, register, and session management using GraphQL mutations and queries.</description>
    </feature>
    <feature>
      <name>CSRF Protection</name>
      <description>Implement CSRF token validation for state-changing GraphQL mutations. Use double-submit cookie pattern with SameSite flag.</description>
    </feature>
    <feature>
      <name>User Dashboard</name>
      <description>Create dashboard page with overview widgets. Show recent documents, pending analyses, statistics, and quick action buttons.</description>
    </feature>
    <feature>
      <name>Dashboard Widget Components</name>
      <description>Create reusable widget components for dashboard. Include document count cards, activity timeline, and notification bell.</description>
    </feature>
    <feature>
      <name>Document Detail View</name>
      <description>Create document detail page showing full document content, metadata, generation history, and action buttons. Support editing for DRAFT status documents.</description>
    </feature>
    <feature>
      <name>Document Edit Form</name>
      <description>Implement form for editing existing documents with validation. Support updating title, type, metadata fields, and content for documents in DRAFT status.</description>
    </feature>
    <feature>
      <name>Document Generation Queue Processor</name>
      <description>Implement Bull queue consumer in infrastructure layer for asynchronous document generation jobs. Create application service use case to orchestrate document generation workflow. Handle job status updates, error recovery, and AI service communication through domain events and queue system following layered architecture.</description>
    </feature>
    <feature>
      <name>Document List View with Refine</name>
      <description>Implement document listing page using Refine&apos;s useTable hook with GraphQL data provider. Include filtering, sorting, pagination, and status badges.</description>
    </feature>
    <feature>
      <name>Document Permissions Entity</name>
      <description>Create DocumentPermission entity linking users to documents with access levels. Support owner, editor, viewer, and commenter roles.</description>
    </feature>
    <feature>
      <name>Document Sharing System</name>
      <description>Implement secure document sharing with granular permissions. Generate shareable links with view-only or edit access and expiration dates.</description>
    </feature>
    <feature>
      <name>Real-time Document Status Updates</name>
      <description>Implement GraphQL subscriptions for document status changes. Emit events when document transitions between DRAFT, GENERATING, COMPLETED, and FAILED states.</description>
    </feature>
    <feature>
      <name>Document Template System</name>
      <description>Create template engine for common legal document types. Support variable interpolation, conditional sections, and Polish legal formatting standards.</description>
    </feature>
    <feature>
      <name>Document Version Entity</name>
      <description>Create DocumentVersion entity to track document revision history. Store content snapshots, timestamps, and author information for audit trail.</description>
    </feature>
    <feature>
      <name>Document Versioning Logic</name>
      <description>Implement version creation on document updates. Maintain version history with diff calculation and rollback capability.</description>
    </feature>
    <feature>
      <name>Email Notification Service</name>
      <description>Implement email service using SendGrid or similar provider. Support templated emails for document completion, account actions, and system notifications.</description>
    </feature>
    <feature>
      <name>Email Queue Processor</name>
      <description>Create Bull queue consumer for sending emails asynchronously. Handle retry logic, bounce tracking, and delivery status updates.</description>
    </feature>
    <feature>
      <name>DDD Domain Model Design</name>
      <description>Establish Domain-Driven Design structure with bounded contexts for Legal Documents, User Management, AI Operations, and Billing domains. Define aggregates, entities, value objects, and domain events for each context.</description>
    </feature>
    <feature>
      <name>Monorepo Structure Setup</name>
      <description>Configure monorepo using Nx or Turborepo with separate packages for backend, frontend, AI engine, and shared libraries. Establish workspace dependencies, build orchestration, and shared tooling configuration.</description>
    </feature>
    <feature>
      <name>Layered Architecture Implementation</name>
      <description>Implement strict layered architecture with Presentation (Controllers/Resolvers), Application (Use Cases/Services), Domain (Business Logic), and Infrastructure (Repositories/External APIs) layers. Enforce dependency rules and establish clear boundaries.</description>
    </feature>
    <feature>
      <name>Domain Repository Interfaces</name>
      <description>Create repository interfaces in domain layer for each aggregate root (LegalDocument, User, LegalAnalysis, etc.). Implement repository pattern to abstract data persistence from domain logic.</description>
    </feature>
    <feature>
      <name>Application Service Layer</name>
      <description>Create application service layer implementing use cases as orchestrators. Services coordinate between domain models, repositories, and external services without containing business logic.</description>
    </feature>
    <feature>
      <name>Validate User Credentials Flow</name>
      <description>Verify password hashing, comparison logic, and user lookup in database during login. Ensure bcrypt or similar library is configured correctly and user entity is properly queried.</description>
    </feature>
    <feature>
      <name>Fix CORS and Cookie Configuration</name>
      <description>Ensure CORS is configured to allow frontend origin, credentials are enabled, and authentication cookies/headers are properly set and readable. Verify SameSite, Secure, and HttpOnly flags.</description>
    </feature>
    <feature>
      <name>Debug Backend Auth Errors</name>
      <description>Investigate 404 errors in login flow. Verify data provider configuration, check if authentication should route through server-side components or directly to backend. Analyze request routing and GraphQL vs REST endpoint usage.</description>
    </feature>
    <feature>
      <name>Import AuthModule in app.module.ts</name>
      <description>Add AuthModule import to main application module. Include &apos;import { AuthModule } from &apos;./modules/auth/auth.module&apos;;&apos; and add AuthModule to the imports array. This registers the /auth/login endpoint in the backend.</description>
    </feature>
    <feature>
      <name>Enable CORS in main.ts</name>
      <description>Configure CORS in NestJS main.ts by adding app.enableCors() after app creation. Set origin to allow frontend URL, enable credentials for cookie and authentication header handling. Ensures frontend can communicate with backend auth endpoints.</description>
    </feature>
    <feature>
      <name>End-to-End Login Flow Verification</name>
      <description>Verify complete login flow functionality. Test backend endpoint with curl, verify CORS headers with OPTIONS request, test full browser-based login flow. Document working authentication flow and any remaining issues.</description>
    </feature>
    <feature>
      <name>Database Fixtures with Initial User</name>
      <description>Create database seeding system with fixtures for development and testing. Include initial admin user (admin@refine.dev / password) and sample data for all entities. Use TypeORM seeding or custom seed scripts to populate database with realistic test data.</description>
    </feature>
    <feature>
      <name>GraphQL Authentication Mutations</name>
      <description>Migrate authentication from REST to GraphQL with login, register, and refreshToken mutations. Implement JWT token management through GraphQL resolvers following project constitution requirements.</description>
    </feature>
    <feature>
      <name>Input Validation Decorators</name>
      <description>Add class-validator decorators to all DTOs and input types. Enforce maximum lengths, format validation, and sanitization rules.</description>
    </feature>
    <feature>
      <name>Legal Analysis Entity</name>
      <description>Create LegalAnalysis entity to store case classification results. Include input description, identified grounds, confidence scores, and related document links.</description>
    </feature>
    <feature>
      <name>Legal Analysis GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to LegalAnalysis entity. Implement auto-generated CRUD resolvers for viewing analysis history.</description>
    </feature>
    <feature>
      <name>Refactor LegalDocument to nestjs-query</name>
      <description>Add @QueryOptions, @FilterableField, and @Relation decorators to LegalDocument infrastructure entity. Implement repository interface in domain layer and concrete implementation in infrastructure layer using nestjs-query. Ensures type-safe GraphQL schema generation while maintaining DDD layering.</description>
    </feature>
    <feature>
      <name>Legal Query Entity</name>
      <description>Create LegalQuery entity for storing Q&amp;A conversations. Include query text, AI response, citations, user session linkage, and timestamp fields.</description>
    </feature>
    <feature>
      <name>Legal Query GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to LegalQuery entity for auto-generated CRUD resolvers. Implement custom mutations for submitting new queries.</description>
    </feature>
    <feature>
      <name>Legal Ruling Entity</name>
      <description>Create LegalRuling entity for storing case law and court decisions. Include fields for signature, date, court name, summary, and full text.</description>
    </feature>
    <feature>
      <name>Legal Ruling GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to LegalRuling entity. Implement auto-generated CRUD resolvers with filtering and full-text search capabilities.</description>
    </feature>
    <feature>
      <name>Migrate to @ptc-org/nestjs-query</name>
      <description>Upgrade all nestjs-query packages to @ptc-org scoped versions. Replace manual GraphQL resolvers with auto-generated CRUD resolvers using QueryService pattern. Refactor to align with DDD principles by separating infrastructure concerns from domain logic in layered architecture.</description>
    </feature>
    <feature>
      <name>PDF Export Service</name>
      <description>Implement PDF generation service using library like Puppeteer or PDFKit. Create professional legal document templates with proper formatting and Polish legal standards.</description>
    </feature>
    <feature>
      <name>Complete Polish Translations</name>
      <description>Add comprehensive Polish translations for all UI strings, error messages, and labels. Ensure legal terminology accuracy and professional tone.</description>
    </feature>
    <feature>
      <name>Rate Limiting Middleware</name>
      <description>Implement rate limiting on GraphQL endpoints using @nestjs/throttler. Protect against abuse with per-user and per-IP limits.</description>
    </feature>
    <feature>
      <name>Refactor User entity to nestjs-query</name>
      <description>Add nestjs-query decorators to User infrastructure entity for auto-generated resolvers. Implement User repository interface in domain layer and concrete implementation in infrastructure layer. Implement FilterableField for searchable properties and proper relation handling with UserSession following DDD patterns.</description>
    </feature>
    <feature>
      <name>XSS Protection Middleware</name>
      <description>Implement XSS protection by sanitizing user inputs and outputs. Use helmet.js for security headers and content security policy.</description>
    </feature>
    <feature>
      <name>Debug Build Process Failure</name>
      <description>Investigate why pnpm dlx turbo build fails. Check TypeScript compilation errors, dependency resolution issues, and build configuration. Review turbo.json configuration and package.json build scripts. Identify root cause of build failures across all packages (backend, web, ai-engine, shared).</description>
    </feature>
    <feature>
      <name>Fix logging interceptor request handling</name>
      <description>Fix login form:

[Nest] 49356  - 22.01.2026, 13:47:37   ERROR [ExceptionsHandler] TypeError: Cannot destructure property &apos;method&apos; of &apos;request&apos; as it is undefined.
    at LoggingInterceptor.intercept (/Users/piteer/workspace/radca-prawny/legal/apps/backend/src/shared/logger/logger.interceptor.ts:17:13)
    at nextFn (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/interceptors/interceptors-consumer.js:23:36)
    at /Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/interceptors/interceptors-consumer.js:21:88
    at AsyncResource.runInAsyncScope (node:async_hooks:213:14)
    at bound (node:async_hooks:244:16)
    at Observable._subscribe (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/observable/defer.ts:54:15)
    at Observable.Observable._trySubscribe (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/Observable.ts:235:19)
    at &lt;anonymous&gt; (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/Observable.ts:225:18)
    at Object.errorContext (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/util/errorContext.ts:29:5)
    at Observable.Observable.subscribe (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/Observable.ts:211:5)</description>
    </feature>
    <feature>
      <name>Fix login</name>
      <description>Fix login form - when trying to use credentials to log in into the service (through login form) backend is erroring:

[Nest] 49356  - 22.01.2026, 13:47:37   ERROR [ExceptionsHandler] TypeError: Cannot destructure property &apos;method&apos; of &apos;request&apos; as it is undefined.
    at LoggingInterceptor.intercept (/Users/piteer/workspace/radca-prawny/legal/apps/backend/src/shared/logger/logger.interceptor.ts:17:13)
    at nextFn (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/interceptors/interceptors-consumer.js:23:36)
    at /Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/interceptors/interceptors-consumer.js:21:88
    at AsyncResource.runInAsyncScope (node:async_hooks:213:14)
    at bound (node:async_hooks:244:16)
    at Observable._subscribe (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/observable/defer.ts:54:15)
    at Observable.Observable._trySubscribe (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/Observable.ts:235:19)
    at &lt;anonymous&gt; (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/Observable.ts:225:18)
    at Object.errorContext (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/util/errorContext.ts:29:5)
    at Observable.Observable.subscribe (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/rxjs@7.8.2/node_modules/rxjs/src/internal/Observable.ts:211:5)</description>
    </feature>
    <feature>
      <name>Redirect Logged-In Users to Dashboard Automatically</name>
      <description>Automatically redirect users to dashbord from login page if they are logged in</description>
    </feature>
    <feature>
      <name>Fix custom data provider implementation in billing page</name>
      <description>Fix billing page, when opening:

Runtime Error


Not implemented custom on data provider.

src/app/(authenticated)/billing/page.tsx (56:65) @ BillingPage


  54 |
  55 |   // Fetch billing info
&gt; 56 |   const { query: billingQuery, result: billingData } = useCustom&lt;BillingInfo&gt;({
     |                                                                 ^
  57 |     url: &apos;&apos;,
  58 |     method: &apos;get&apos;,
  59 |     config: {
Call Stack
14

Show 13 ignore-listed frame(s)
BillingPage
src/app/(authenticated)/billing/page.tsx (56:65)</description>
    </feature>
    <feature>
      <name>Fix Dockerfile Build Issues</name>
      <description>Fix Dockerfile issues identified during debugging. This may include correcting COPY instruction order for better layer caching (as per optimize-docker-layer-caching feature), fixing base image versions, correcting WORKDIR paths, resolving dependency installation failures, or fixing multi-stage build configuration.</description>
    </feature>
    <feature>
      <name>Debug Docker Compose Build Failure</name>
      <description>Investigate why docker compose up --build fails. Check Dockerfile syntax, base image availability, dependency installation during build, and multi-stage build configuration. Verify docker-compose.yml service configuration and volume mounts. Test building individual services to isolate the failing container.</description>
    </feature>
    <feature>
      <name>Fix language switcher navigation to preserve routes</name>
      <description>Fix Language Change Path Handling

The language switcher incorrectly causes the browser to navigate to `/pl` path, which the application does not support as a valid route.

Technical Implementation:
- Issue Analysis: Language change likely modifying window.location or using standard anchor navigation instead of programmatic locale switching
- Solution Approach: Implement client-side locale change without route navigation
- i18n Configuration: Update internationalization library (react-i18n, next-i18n, or similar) to change locale in-place
- State Management: Store selected language in localStorage/sessionStorage or URL query parameter (?lang=pl) instead of path segment
- Route Guard: Add middleware/route protection to handle legacy `/pl` paths (redirect to base path with locale parameter)

Implementation Details:
- Modify language selector component to use locale change API (e.g., i18n.changeLanguage(&apos;pl&apos;))
- Update i18n config to use query parameter or subdomain strategy instead of path-based routing
- If path-based routing is required: Configure supported locale paths in router configuration
- Prevent default behavior on language switch button/link (e.preventDefault())

Error Handling:
- Fallback to default language if unsupported locale requested
- Handle cases where locale file fails to load
- Preserve current route when switching languages

Files to Update:
- LanguageSwitcher component (remove href navigation)
- i18n configuration file (change localization strategy)
- Router configuration (add locale path support or redirect rules)
- Middleware/route guards (handle invalid paths)

Compatibility: Ensure language preference persists across page reloads and maintains current user context</description>
    </feature>
    <feature>
      <name>Fix Missing Translation Keys in i18n System</name>
      <description>Fix Missing Translation Keys in Internationalization System

Identify and resolve instances where translation keys are not being properly translated, resulting in untranslated text appearing in the user interface.

Requirements:
- Audit the codebase to locate all missing or untranslated keys
- Verify that translation keys exist in all required language files
- Ensure translation keys are correctly referenced in the code
- Check for typos or mismatches between key references and translation file entries
- Identify any keys that are missing translations in specific languages
- Add missing translation entries with appropriate translated text
- Verify that the i18n/translation system is properly initialized and loading language files
- Test all affected UI areas to confirm translations display correctly
- Document which languages were incomplete and what keys were added

Edge cases to consider:
- Dynamic keys that may be constructed at runtime
- Nested translation keys with incorrect paths
- Pluralization or context-specific translations
- Fallback language behavior when translations are missing</description>
    </feature>
    <feature>
      <name>Login Form Loading State</name>
      <description>Implement visual loading indicator on login form while authentication request is in progress. Add spinner or loading button state to show user that login is being processed. Disable form inputs and submit button during loading to prevent duplicate submissions.</description>
    </feature>
    <feature>
      <name>Configure Docker Compose for local development with hot reload</name>
      <description>Add Docker Compose Configuration for Local Development Environment

Configure Docker Compose to support local development workflow with hot-reloading and live code updates across all service containers.

Requirements:
- Mount project root directories as volumes for each code-containing service
- Configure appropriate .dockerignore files to exclude node_modules, build artifacts, and other performance-impacting directories from volume mounts
- Ensure mounted volume structure mirrors local directory structure for consistency
- Create development-specific Dockerfile stages (separate from production stages) if additional tooling or commands are needed
- Override CMD directives via docker-compose.yml when development stage doesn&apos;t require Dockerfile changes
- Target appropriate build stages in docker-compose.yml service definitions
- Configure services to support hot-reload/live-reload capabilities where applicable
- Add clear documentation indicating this is DEV ONLY configuration (production uses Kubernetes)

Technical Considerations:
- Verify file watching works correctly across all services with mounted volumes
- Test that changes to source code trigger automatic reloads/rebuilds
- Ensure database volumes persist data between container restarts
- Validate that excluded directories (node_modules, etc.) don&apos;t cause dependency issues
- Confirm development dependencies are available in dev stage but excluded from production stage
- Check cross-platform compatibility (Linux, macOS, Windows with WSL2)

Success Criteria:
- Code changes reflect immediately without rebuilding containers
- All services start successfully with docker-compose up
- No performance degradation from volume mounting strategy
- Clear separation between development and production configurations</description>
    </feature>
    <feature>
      <name>Fix navigation race condition null reference errors</name>
      <description>Fix Frontend Navigation Race Condition Causing Null Reference Errors

Resolve asynchronous timing issues that cause the application to fail during navigation events (particularly login and other form submissions) with &quot;Cannot read properties of null (reading &apos;username&apos;)&quot; errors. The errors occur on initial navigation but resolve after page refresh, indicating a race condition between component initialization and data access.

Requirements:
- Investigate the timing of username/user data initialization versus when it&apos;s being accessed
- Identify all navigation points where this error occurs (login flow and other form submissions)
- Implement proper null checks and defensive programming for user data access
- Add loading states or guards to prevent navigation until required data is available
- Consider using async/await patterns or Promises to ensure data is loaded before access
- Implement proper error boundaries to gracefully handle race conditions if they occur
- Verify that component lifecycle hooks are correctly waiting for async data
- Test navigation flows without browser refresh to confirm fix
- Ensure fix doesn&apos;t introduce delays in successful navigation scenarios

Edge Cases to Consider:
- First-time login versus returning user scenarios
- Slow network conditions that delay data fetching
- Browser autofill interactions triggering premature form submissions
- Multiple rapid navigation attempts
- Session restoration from stored tokens

Expected Outcome:
Navigation and form submissions work consistently on first attempt without requiring page refresh, with no null reference errors in browser console.


Current error:


VM31 bootstrap-autof‚Ä¶tifications.js:6099 Uncaught TypeError: Cannot read properties of null (reading &apos;username&apos;)
    at AutofillOverlayContentService.getFormFieldData (VM31 bootstrap-autof‚Ä¶ications.js:6099:55)
    at AutofillOverlayContentService.handleFormFieldSubmitEvent (VM31 bootstrap-autof‚Ä¶ications.js:6080:71)
    at AutofillOverlayContentService.handleSubmitButtonInteraction (VM31 bootstrap-autof‚Ä¶ications.js:6074:18)
    at HTMLDocument.&lt;anonymous&gt; (VM31 bootstrap-autof‚Ä¶ications.js:4169:22)
VM31 bootstrap-autof‚Ä¶tifications.js:6099 Uncaught TypeError: Cannot read properties of null (reading &apos;username&apos;)
    at AutofillOverlayContentService.getFormFieldData (VM31 bootstrap-autof‚Ä¶ications.js:6099:55)
    at AutofillOverlayContentService.handleFormFieldSubmitEvent (VM31 bootstrap-autof‚Ä¶ications.js:6080:71)</description>
    </feature>
    <feature>
      <name>Fix missing sentry_sdk Span type import</name>
      <description>Fix error:

legal-ai-engine  | INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
legal-ai-engine  | INFO:     Started reloader process [10] using StatReload
legal-ai-engine  | Process SpawnProcess-1:
legal-ai-engine  | Traceback (most recent call last):
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/multiprocessing/process.py&quot;, line 313, in _bootstrap
legal-ai-engine  |     self.run()
legal-ai-engine  |     ~~~~~~~~^^
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/multiprocessing/process.py&quot;, line 108, in run
legal-ai-engine  |     self._target(*self._args, **self._kwargs)
legal-ai-engine  |     ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/_subprocess.py&quot;, line 80, in subprocess_started
legal-ai-engine  |     target(sockets=sockets)
legal-ai-engine  |     ~~~~~~^^^^^^^^^^^^^^^^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/server.py&quot;, line 67, in run
legal-ai-engine  |     return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/asyncio/runners.py&quot;, line 195, in run
legal-ai-engine  |     return runner.run(main)
legal-ai-engine  |            ~~~~~~~~~~^^^^^^
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/asyncio/runners.py&quot;, line 118, in run
legal-ai-engine  |     return self._loop.run_until_complete(task)
legal-ai-engine  |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/asyncio/base_events.py&quot;, line 725, in run_until_complete
legal-ai-engine  |     return future.result()
legal-ai-engine  |            ~~~~~~~~~~~~~^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/server.py&quot;, line 71, in serve
legal-ai-engine  |     await self._serve(sockets)
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/server.py&quot;, line 78, in _serve
legal-ai-engine  |     config.load()
legal-ai-engine  |     ~~~~~~~~~~~^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/config.py&quot;, line 439, in load
legal-ai-engine  |     self.loaded_app = import_from_string(self.app)
legal-ai-engine  |                       ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/importer.py&quot;, line 19, in import_from_string
legal-ai-engine  |     module = importlib.import_module(module_str)
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/importlib/__init__.py&quot;, line 88, in import_module
legal-ai-engine  |     return _bootstrap._gcd_import(name[level:], package, level)
legal-ai-engine  |            ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1387, in _gcd_import
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1023, in exec_module
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 488, in _call_with_frames_removed
legal-ai-engine  |   File &quot;/app/src/main.py&quot;, line 17, in &lt;module&gt;
legal-ai-engine  |     from .sentry_init import init_sentry, start_ai_span, set_transaction_name
legal-ai-engine  |   File &quot;/app/src/sentry_init.py&quot;, line 195, in &lt;module&gt;
legal-ai-engine  |     def start_ai_span(operation: str, **kwargs) -&gt; Optional[sentry_sdk.Span]:
legal-ai-engine  |                                                             ^^^^^^^^^^^^^^^
legal-ai-engine  | AttributeError: module &apos;sentry_sdk&apos; has no attribute &apos;Span&apos;</description>
    </feature>
    <feature>
      <name>Login Form Error Display</name>
      <description>Implement error message display on login form for invalid credentials and other authentication failures. Parse error responses from backend GraphQL mutations and display user-friendly error messages. Handle network errors, timeout errors, and invalid credential errors with appropriate messaging.</description>
    </feature>
    <feature>
      <name>Optimize Docker build caching for pnpm install</name>
      <description>Optimize docker build caching. Make sure that not ALL cod is copied BEFORE pnpm install, or it invalidates that step  completely. Make sure that we COPY only the necessary files, for example packages before pnpm install. For backend we do not need backend to be available beffore pnpm install. we also don&apos;t neeed at all ai-engine or web for that neither. Maybe even not for build (needs verification)</description>
    </feature>
    <feature>
      <name>Fix Docker caching to restore dependency installation</name>
      <description>After recent changes in docker caching, it stopped working, please fix it:

legal-ai-backend  | 
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-backend  | src/app.module.ts:10:44 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import { APP_GUARD, APP_INTERCEPTOR } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                                               ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/performance.interceptor.ts:10:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.interceptor.ts:10:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:2:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 2 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                           ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:3:42 - error TS2307: Cannot find module &apos;@sentry/profiling-node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import { nodeProfilingIntegration } from &apos;@sentry/profiling-node&apos;;
legal-ai-backend  |                                            ~~~~~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:6:33 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 6 import { APP_INTERCEPTOR } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                                   ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:47:20 - error TS7006: Parameter &apos;event&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 47         beforeSend(event, hint) {
legal-ai-backend  |                       ~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:47:27 - error TS7006: Parameter &apos;hint&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 47         beforeSend(event, hint) {
legal-ai-backend  |                              ~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:54:31 - error TS7006: Parameter &apos;event&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 54         beforeSendTransaction(event, hint) {
legal-ai-backend  |                                  ~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:54:38 - error TS7006: Parameter &apos;hint&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 54         beforeSendTransaction(event, hint) {
legal-ai-backend  |                                         ~~~~
legal-ai-backend  | 
legal-ai-backend  | src/main.ts:1:29 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 1 import { NestFactory } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                               ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/main.ts:5:26 - error TS7016: Could not find a declaration file for module &apos;cookie-parser&apos;. &apos;/app/node_modules/.pnpm/cookie-parser@1.4.7/node_modules/cookie-parser/index.js&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  |   Try `npm i --save-dev @types/cookie-parser` if it exists or add a new declaration (.d.ts) file containing `declare module &apos;cookie-parser&apos;;`
legal-ai-backend  | 
legal-ai-backend  | 5 import cookieParser from &apos;cookie-parser&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/main.ts:6:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 6 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                           ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/auth/guards/admin.guard.ts:8:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 8 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/auth/guards/document-permission.guard.ts:9:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 9 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/auth/strategies/api-key.strategy.ts:3:26 - error TS2307: Cannot find module &apos;passport-http-bearer&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import { Strategy } from &apos;passport-http-bearer&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/backup/services/s3-storage.service.ts:10:8 - error TS2307: Cannot find module &apos;@aws-sdk/client-s3&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 } from &apos;@aws-sdk/client-s3&apos;;
legal-ai-backend  |           ~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/billing/guards/quota.guard.ts:10:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                              ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/collaboration/gateways/collaboration.gateway.ts:9:8 - error TS2307: Cannot find module &apos;@nestjs/websockets&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 9 } from &apos;@nestjs/websockets&apos;;
legal-ai-backend  |          ~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/collaboration/gateways/collaboration.gateway.ts:10:32 - error TS2307: Cannot find module &apos;socket.io&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import { Server, Socket } from &apos;socket.io&apos;;
legal-ai-backend  |                                   ~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/subscriptions/guards/feature-access.guard.ts:9:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 9 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/seeds/seed.command.ts:1:29 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 1 import { NestFactory } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                               ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/ai-client/ai-client.service.ts:5:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 5 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                           ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/csrf/csrf.guard.ts:8:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 8 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/csrf/csrf.module.ts:3:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import { APP_GUARD } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:3:26 - error TS2307: Cannot find module &apos;winston&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import * as winston from &apos;winston&apos;;
legal-ai-backend  |                            ~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:22 - error TS7031: Binding element &apos;timestamp&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                         ~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:33 - error TS7031: Binding element &apos;level&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                                    ~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:40 - error TS7031: Binding element &apos;message&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                                           ~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:49 - error TS7031: Binding element &apos;context&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                                                    ~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | [7:40:02 AM] Found 30 errors. Watching for file changes.
legal-ai-backend  | 
legal-ai-backend  | node:internal/modules/cjs/loader:1210
legal-ai-backend  |   throw err;
legal-ai-backend  |   ^
legal-ai-backend  | 
legal-ai-backend  | Error: Cannot find module &apos;@nestjs/core&apos;
legal-ai-backend  | Require stack:
legal-ai-backend  | - /app/apps/backend/dist/src/main.js
legal-ai-backend  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1207:15)
legal-ai-backend  |     at Module._load (node:internal/modules/cjs/loader:1038:27)
legal-ai-backend  |     at Module.require (node:internal/modules/cjs/loader:1289:19)
legal-ai-backend  |     at require (node:internal/modules/helpers:182:18)
legal-ai-backend  |     at Object.&lt;anonymous&gt; (/app/apps/backend/src/main.ts:1:1)
legal-ai-backend  |     at Module._compile (node:internal/modules/cjs/loader:1521:14)
legal-ai-backend  |     at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
legal-ai-backend  |     at Module.load (node:internal/modules/cjs/loader:1266:32)
legal-ai-backend  |     at Module._load (node:internal/modules/cjs/loader:1091:12)
legal-ai-backend  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12) {
legal-ai-backend  |   code: &apos;MODULE_NOT_FOUND&apos;,
legal-ai-backend  |   requireStack: [ &apos;/app/apps/backend/dist/src/main.js&apos; ]
legal-ai-backend  | }
legal-ai-backend  | 
legal-ai-backend  | Node.js v20.20.0
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0</description>
    </feature>
    <feature>
      <name>Fix missing OpenAI API key configuration</name>
      <description>Fix legal ai errors:

legal-ai-engine  | Process SpawnProcess-1:
legal-ai-engine  | Traceback (most recent call last):
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/multiprocessing/process.py&quot;, line 313, in _bootstrap
legal-ai-engine  |     self.run()
legal-ai-engine  |     ~~~~~~~~^^
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/multiprocessing/process.py&quot;, line 108, in run
legal-ai-engine  |     self._target(*self._args, **self._kwargs)
legal-ai-engine  |     ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/_subprocess.py&quot;, line 80, in subprocess_started
legal-ai-engine  |     target(sockets=sockets)
legal-ai-engine  |     ~~~~~~^^^^^^^^^^^^^^^^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/server.py&quot;, line 67, in run
legal-ai-engine  |     return asyncio_run(self.serve(sockets=sockets), loop_factory=self.config.get_loop_factory())
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/asyncio/runners.py&quot;, line 195, in run
legal-ai-engine  |     return runner.run(main)
legal-ai-engine  |            ~~~~~~~~~~^^^^^^
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/asyncio/runners.py&quot;, line 118, in run
legal-ai-engine  |     return self._loop.run_until_complete(task)
legal-ai-engine  |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/asyncio/base_events.py&quot;, line 725, in run_until_complete
legal-ai-engine  |     return future.result()
legal-ai-engine  |            ~~~~~~~~~~~~~^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/server.py&quot;, line 71, in serve
legal-ai-engine  |     await self._serve(sockets)
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/server.py&quot;, line 78, in _serve
legal-ai-engine  |     config.load()
legal-ai-engine  |     ~~~~~~~~~~~^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/config.py&quot;, line 439, in load
legal-ai-engine  |     self.loaded_app = import_from_string(self.app)
legal-ai-engine  |                       ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/uvicorn/importer.py&quot;, line 19, in import_from_string
legal-ai-engine  |     module = importlib.import_module(module_str)
legal-ai-engine  |   File &quot;/usr/local/lib/python3.13/importlib/__init__.py&quot;, line 88, in import_module
legal-ai-engine  |     return _bootstrap._gcd_import(name[level:], package, level)
legal-ai-engine  |            ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1387, in _gcd_import
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1360, in _find_and_load
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 1331, in _find_and_load_unlocked
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 935, in _load_unlocked
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;, line 1023, in exec_module
legal-ai-engine  |   File &quot;&lt;frozen importlib._bootstrap&gt;&quot;, line 488, in _call_with_frames_removed
legal-ai-engine  |   File &quot;/app/src/main.py&quot;, line 21, in &lt;module&gt;
legal-ai-engine  |     from .agents.classifier_agent import classifier_agent
legal-ai-engine  |   File &quot;/app/src/agents/classifier_agent.py&quot;, line 12, in &lt;module&gt;
legal-ai-engine  |     settings = get_settings()
legal-ai-engine  |   File &quot;/app/src/config.py&quot;, line 25, in get_settings
legal-ai-engine  |     return Settings()
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/pydantic_settings/main.py&quot;, line 194, in __init__
legal-ai-engine  |     super().__init__(
legal-ai-engine  |     ~~~~~~~~~~~~~~~~^
legal-ai-engine  |         **__pydantic_self__._settings_build_values(
legal-ai-engine  |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
legal-ai-engine  |     ...&lt;27 lines&gt;...
legal-ai-engine  |         )
legal-ai-engine  |         ^
legal-ai-engine  |     )
legal-ai-engine  |     ^
legal-ai-engine  |   File &quot;/app/.venv/lib/python3.13/site-packages/pydantic/main.py&quot;, line 250, in __init__
legal-ai-engine  |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
legal-ai-engine  | pydantic_core._pydantic_core.ValidationError: 1 validation error for Settings
legal-ai-engine  | OPENAI_API_KEY
legal-ai-engine  |   Field required [type=missing, input_value={}, input_type=dict]
legal-ai-engine  |     For further information visit https://errors.pydantic.dev/2.12/v/missing</description>
    </feature>
    <feature>
      <name>Fix Docker build and missing libraries</name>
      <description>After recent changes in docker caching, it stopped working, please fix it:

legal-ai-backend  | 
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-backend  | src/app.module.ts:10:44 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import { APP_GUARD, APP_INTERCEPTOR } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                                               ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/performance.interceptor.ts:10:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.interceptor.ts:10:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:2:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 2 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                           ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:3:42 - error TS2307: Cannot find module &apos;@sentry/profiling-node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import { nodeProfilingIntegration } from &apos;@sentry/profiling-node&apos;;
legal-ai-backend  |                                            ~~~~~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:6:33 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 6 import { APP_INTERCEPTOR } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                                   ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:47:20 - error TS7006: Parameter &apos;event&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 47         beforeSend(event, hint) {
legal-ai-backend  |                       ~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:47:27 - error TS7006: Parameter &apos;hint&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 47         beforeSend(event, hint) {
legal-ai-backend  |                              ~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:54:31 - error TS7006: Parameter &apos;event&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 54         beforeSendTransaction(event, hint) {
legal-ai-backend  |                                  ~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/common/sentry/sentry.module.ts:54:38 - error TS7006: Parameter &apos;hint&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 54         beforeSendTransaction(event, hint) {
legal-ai-backend  |                                         ~~~~
legal-ai-backend  | 
legal-ai-backend  | src/main.ts:1:29 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 1 import { NestFactory } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                               ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/main.ts:5:26 - error TS7016: Could not find a declaration file for module &apos;cookie-parser&apos;. &apos;/app/node_modules/.pnpm/cookie-parser@1.4.7/node_modules/cookie-parser/index.js&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  |   Try `npm i --save-dev @types/cookie-parser` if it exists or add a new declaration (.d.ts) file containing `declare module &apos;cookie-parser&apos;;`
legal-ai-backend  | 
legal-ai-backend  | 5 import cookieParser from &apos;cookie-parser&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/main.ts:6:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 6 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                           ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/auth/guards/admin.guard.ts:8:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 8 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/auth/guards/document-permission.guard.ts:9:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 9 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/auth/strategies/api-key.strategy.ts:3:26 - error TS2307: Cannot find module &apos;passport-http-bearer&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import { Strategy } from &apos;passport-http-bearer&apos;;
legal-ai-backend  |                            ~~~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/backup/services/s3-storage.service.ts:10:8 - error TS2307: Cannot find module &apos;@aws-sdk/client-s3&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 } from &apos;@aws-sdk/client-s3&apos;;
legal-ai-backend  |           ~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/billing/guards/quota.guard.ts:10:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                              ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/collaboration/gateways/collaboration.gateway.ts:9:8 - error TS2307: Cannot find module &apos;@nestjs/websockets&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 9 } from &apos;@nestjs/websockets&apos;;
legal-ai-backend  |          ~~~~~~~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/collaboration/gateways/collaboration.gateway.ts:10:32 - error TS2307: Cannot find module &apos;socket.io&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 10 import { Server, Socket } from &apos;socket.io&apos;;
legal-ai-backend  |                                   ~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/modules/subscriptions/guards/feature-access.guard.ts:9:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 9 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/seeds/seed.command.ts:1:29 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 1 import { NestFactory } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                               ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/ai-client/ai-client.service.ts:5:25 - error TS2307: Cannot find module &apos;@sentry/node&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 5 import * as Sentry from &apos;@sentry/node&apos;;
legal-ai-backend  |                           ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/csrf/csrf.guard.ts:8:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 8 import { Reflector } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/csrf/csrf.module.ts:3:27 - error TS2307: Cannot find module &apos;@nestjs/core&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import { APP_GUARD } from &apos;@nestjs/core&apos;;
legal-ai-backend  |                             ~~~~~~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:3:26 - error TS2307: Cannot find module &apos;winston&apos; or its corresponding type declarations.
legal-ai-backend  | 
legal-ai-backend  | 3 import * as winston from &apos;winston&apos;;
legal-ai-backend  |                            ~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:22 - error TS7031: Binding element &apos;timestamp&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                         ~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:33 - error TS7031: Binding element &apos;level&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                                    ~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:40 - error TS7031: Binding element &apos;message&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                                           ~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | src/shared/logger/logger.service.ts:66:49 - error TS7031: Binding element &apos;context&apos; implicitly has an &apos;any&apos; type.
legal-ai-backend  | 
legal-ai-backend  | 66                   ({ timestamp, level, message, context, ...metadata }) =&gt; {
legal-ai-backend  |                                                    ~~~~~~~
legal-ai-backend  | 
legal-ai-backend  | [7:40:02 AM] Found 30 errors. Watching for file changes.
legal-ai-backend  | 
legal-ai-backend  | node:internal/modules/cjs/loader:1210
legal-ai-backend  |   throw err;
legal-ai-backend  |   ^
legal-ai-backend  | 
legal-ai-backend  | Error: Cannot find module &apos;@nestjs/core&apos;
legal-ai-backend  | Require stack:
legal-ai-backend  | - /app/apps/backend/dist/src/main.js
legal-ai-backend  |     at Module._resolveFilename (node:internal/modules/cjs/loader:1207:15)
legal-ai-backend  |     at Module._load (node:internal/modules/cjs/loader:1038:27)
legal-ai-backend  |     at Module.require (node:internal/modules/cjs/loader:1289:19)
legal-ai-backend  |     at require (node:internal/modules/helpers:182:18)
legal-ai-backend  |     at Object.&lt;anonymous&gt; (/app/apps/backend/src/main.ts:1:1)
legal-ai-backend  |     at Module._compile (node:internal/modules/cjs/loader:1521:14)
legal-ai-backend  |     at Module._extensions..js (node:internal/modules/cjs/loader:1623:10)
legal-ai-backend  |     at Module.load (node:internal/modules/cjs/loader:1266:32)
legal-ai-backend  |     at Module._load (node:internal/modules/cjs/loader:1091:12)
legal-ai-backend  |     at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:164:12) {
legal-ai-backend  |   code: &apos;MODULE_NOT_FOUND&apos;,
legal-ai-backend  |   requireStack: [ &apos;/app/apps/backend/dist/src/main.js&apos; ]
legal-ai-backend  | }
legal-ai-backend  | 
legal-ai-backend  | Node.js v20.20.0
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0
legal-ai-web exited with code 1 (restarting)
legal-ai-web      |  ‚®Ø Failed to load next.config.mjs, see more info here https://nextjs.org/docs/messages/next-config-error
legal-ai-web      | node:internal/modules/esm/resolve:873
legal-ai-web      |   throw new ERR_MODULE_NOT_FOUND(packageName, fileURLToPath(base), null);
legal-ai-web      |         ^
legal-ai-web      | 
legal-ai-web      | Error [ERR_MODULE_NOT_FOUND]: Cannot find package &apos;@sentry/nextjs&apos; imported from /app/apps/web/next.config.mjs
legal-ai-web      |     at packageResolve (node:internal/modules/esm/resolve:873:9)
legal-ai-web      |     at moduleResolve (node:internal/modules/esm/resolve:946:18)
legal-ai-web      |     at defaultResolve (node:internal/modules/esm/resolve:1188:11)
legal-ai-web      |     at ModuleLoader.defaultResolve (node:internal/modules/esm/loader:708:12)
legal-ai-web      |     at #cachedDefaultResolve (node:internal/modules/esm/loader:657:25)
legal-ai-web      |     at ModuleLoader.resolve (node:internal/modules/esm/loader:640:38)
legal-ai-web      |     at ModuleLoader.getModuleJobForImport (node:internal/modules/esm/loader:264:38)
legal-ai-web      |     at ModuleJob._link (node:internal/modules/esm/module_job:168:49) {
legal-ai-web      |   code: &apos;ERR_MODULE_NOT_FOUND&apos;
legal-ai-web      | }
legal-ai-web      | 
legal-ai-web      | Node.js v20.20.0


This issue might be linked to each dockerfiles or docker compose</description>
    </feature>
    <feature>
      <name>Fix broken pagination data loading</name>
      <description>Investigate and Fix Non-Functional Pagination System

The pagination component is not working correctly - clicking pagination controls updates the URL in the browser but does not load new data or change the displayed page. The issue is suspected to be on the backend side.

Requirements:
- Verify that pagination controls correctly update URL query parameters (e.g., ?page=2)
- Check if frontend is making API requests with correct pagination parameters when page changes
- Investigate backend API endpoint to ensure it properly processes pagination parameters (page, limit, offset)
- Verify backend is returning correct data subset for requested page
- Confirm backend response includes necessary pagination metadata (total count, current page, total pages)
- Test edge cases: first page, last page, invalid page numbers, out-of-range pages
- Ensure proper error handling when pagination parameters are missing or invalid
- Validate that data updates in the UI after successful API response
- Test with different page sizes if configurable

Debugging checklist:
- Add logging to track pagination parameter flow from frontend to backend
- Verify database queries include correct LIMIT and OFFSET clauses
- Check for any caching that might return stale data
- Confirm state management properly triggers re-render on page change</description>
    </feature>
    <feature>
      <name>Build project and fix compilation errors</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix broken pagination data loading

**Description:** Investigate and Fix Non-Functional Pagination System

The pagination component is not working correctly - clicking pagination controls updates the URL in the browser but does not load new data or change the displayed page. The issue is suspected to be on the backend side.

Requirements:
- Verify that pagination controls correctly update URL query parameters (e.g., ?page=2)
- Check if frontend is making API requests with correct pagination parameters when page changes
- Investigate backend API endpoint to ensure it properly processes pagination parameters (page, limit, offset)
- Verify backend is returning correct data subset for requested page
- Confirm backend response includes necessary pagination metadata (total count, current page, total pages)
- Test edge cases: first page, last page, invalid page numbers, out-of-range pages
- Ensure proper error handling when pagination parameters are missing or invalid
- Validate that data updates in the UI after successful API response
- Test with different page sizes if configurable

Debugging checklist:
- Add logging to track pagination parameter flow from frontend to backend
- Verify database queries include correct LIMIT and OFFSET clauses
- Check for any caching that might return stale data
- Confirm state management properly triggers re-render on page change

---

## Task Description

After changes project doe snot build</description>
    </feature>
    <feature>
      <name>Fix invalid locale redirect routing issue</name>
      <description>Invalid hadnling of intl - changing locale, redirects browsers to /pl (or other locale) but no such address exists.</description>
    </feature>
    <feature>
      <name>Fix locale redirect routing to prevent 404 errors</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix invalid locale redirect routing issue

**Description:** Invalid hadnling of intl - changing locale, redirects browsers to /pl (or other locale) but no such address exists. 

---

## Task Description

After last changes all pages stopped working. These redirect to inexistent pages with locale prefix. Please make sure that pages still work.

Do not forget that this is refine.dev project and might differ from standard next.js</description>
    </feature>
    <feature>
      <name>Feature: feature-1769172615242-80g7bqtv3</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix locale redirect routing to prevent 404 errors

**Description:** ## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix invalid locale redirect routing issue

**Description:** Invalid hadnling of intl - changing locale, redirects browsers to /pl (or other locale) but no such address exists. 

---

## Task Description

After last changes all pages stopped working. These redirect to inexistent pages with locale prefix. Please make sure that pages still work.

Do not forget that this is refine.dev project and might differ from standard next.js

---

## Task Description

Frontend still returns 404 errors on all pages, for example on `/`</description>
    </feature>
    <feature>
      <name>Fix PublicLayout async Client Component error</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix locale redirect routing to prevent 404 errors

**Description:** ## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix invalid locale redirect routing issue

**Description:** Invalid hadnling of intl - changing locale, redirects browsers to /pl (or other locale) but no such address exists. 

---

## Task Description

After last changes all pages stopped working. These redirect to inexistent pages with locale prefix. Please make sure that pages still work.

Do not forget that this is refine.dev project and might differ from standard next.js

---

## Task Description

Right now main page fails with an error:

&lt;PublicLayout&gt; is an async Client Component. Only Server Components can be async at the moment. This error is often caused by accidentally adding `&apos;use client&apos;` to a module that was originally written for the server.

src/app/page.tsx (16:5) @ LandingContent</description>
    </feature>
    <feature>
      <name>Disable throttler middleware except login routes</name>
      <description>Disable throttler middleware in backend, besides log in or specific routes, because it leads to too many requests from dashboard</description>
    </feature>
    <feature>
      <name>Fix legalDocuments validation error in dashboard</name>
      <description>Fix errors on dashboard:

{
    &quot;errors&quot;: [
        {
            &quot;message&quot;: &quot;Bad Request Exception&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 3,
                    &quot;column&quot;: 11
                }
            ],
            &quot;path&quot;: [
                &quot;legalDocuments&quot;
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;BAD_REQUEST&quot;,
                &quot;stacktrace&quot;: [
                    &quot;BadRequestException: Bad Request Exception&quot;,
                    &quot;    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)&quot;,
                    &quot;    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,
                    &quot;    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)&quot;,
                    &quot;    at async Promise.all (index 2)&quot;,
                    &quot;    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)&quot;,
                    &quot;    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17&quot;
                ],
                &quot;originalError&quot;: {
                    &quot;message&quot;: [
                        &quot;Field paging.first max allowed value is `50`.&quot;
                    ],
                    &quot;error&quot;: &quot;Bad Request&quot;,
                    &quot;statusCode&quot;: 400
                }
            }
        }
    ],
    &quot;data&quot;: null
}</description>
    </feature>
    <feature>
      <name>Fix settings page loading and user data hydration</name>
      <description>Settings page does not load + hydrate currently logged in user data into forms</description>
    </feature>
    <feature>
      <name>Fix GraphQL notification query syntax error</name>
      <description>Please fix the error in notifications request:

{,‚Ä¶}
query
: 
&quot;\n        query GetRecentNotifications($userId: String!, $limit: Int) {\n          recentNotifications(userId: $userId, limit: $limit) {\n            id\n            userId\n            type\n            message\n            read\n            actionLink\n            actionLabel\n            metadata\n            createdAt\n          }\n          unreadNotificationCount(userId: $userId)\n        }\n      &quot;
variables
: 
{userId: &quot;e64f1e51-ea6d-4670-aa87-3c153db4f950&quot;, limit: 20}</description>
    </feature>
    <feature>
      <name>Remove non-existent blog posts page from menu</name>
      <description>Remove blog posts page from menu and references, this does not exist.</description>
    </feature>
    <feature>
      <name>Fix user settings save error with custom query configuration</name>
      <description>Saving user settings / preferences does end in `Custom query/mutation not configured properly` message on frontentd, needs fixing</description>
    </feature>
    <feature>
      <name>Remove test data from login form defaults</name>
      <description>Loginj form is filled with test data, please remove it from default form values</description>
    </feature>
    <feature>
      <name>Global Loading States for Forms</name>
      <description>Implement consistent loading state patterns across all forms in the application. Create reusable loading components and hooks for form submissions. Apply to document creation, settings updates, and all mutation-based forms.</description>
    </feature>
    <feature>
      <name>Fix custom query mutation configuration error</name>
      <description>Any mutation ends up with an error that they&apos;re not setup: Custom query/mutation not configured properly. Example URL http://localhost:3000/settings on preferences page</description>
    </feature>
    <feature>
      <name>Reorganize menu by usage frequency and category</name>
      <description>Organize menu - currently its mixed, some are user settings, some documents, etc. Please make sure that the first ones are mostly used by users, these will be probably q&amp;a and chat. Make secondary stuff like usage, biling, settings etc</description>
    </feature>
    <feature>
      <name>Fix audit logs pagination serialization errors</name>
      <description>When accessing audit logs  on subsequent pages, it&apos;s returing errors:, please fix these

{errors: [,‚Ä¶], data: {auditLogs: {totalCount: 36,‚Ä¶}}}
data
: 
{auditLogs: {totalCount: 36,‚Ä¶}}
errors
: 
[,‚Ä¶]
0
: 
{message: &quot;String cannot represent value: { isActive: true }&quot;, locations: [{line: 23, column: 19}],‚Ä¶}
1
: 
{message: &quot;String cannot represent value: { isActive: false }&quot;, locations: [{line: 24, column: 19}],‚Ä¶}
2
: 
{message: &quot;String cannot represent value: { status: &quot;DRAFT&quot; }&quot;, locations: [{line: 23, column: 19}],‚Ä¶}
3
: 
{message: &quot;String cannot represent value: { status: &quot;COMPLETED&quot; }&quot;,‚Ä¶}
4
: 
{,‚Ä¶}</description>
    </feature>
    <feature>
      <name>Create Custom 404 Error Page</name>
      <description>Create nicely looking 404 page</description>
    </feature>
    <feature>
      <name>Update default landing page after login</name>
      <description>Make first page after logging in to be the legal chat or dashboad, which one you deem better</description>
    </feature>
    <feature>
      <name>Add GraphQL error handling and display indicators</name>
      <description>Handle errors on frontend, there should be some indicatior that error occured and page cannot be displayed when Graphql returns errors, and example of errored response:

{errors: [,‚Ä¶], data: {auditLogs: {totalCount: 36,‚Ä¶}}}
data
: 
{auditLogs: {totalCount: 36,‚Ä¶}}
errors
: 
[,‚Ä¶]
0
: 
{message: &quot;String cannot represent value: { isActive: true }&quot;, locations: [{line: 23, column: 19}],‚Ä¶}
1
: 
{message: &quot;String cannot represent value: { isActive: false }&quot;, locations: [{line: 24, column: 19}],‚Ä¶}
2
: 
{message: &quot;String cannot represent value: { status: &quot;DRAFT&quot; }&quot;, locations: [{line: 23, column: 19}],‚Ä¶}
3
: 
{message: &quot;String cannot represent value: { status: &quot;COMPLETED&quot; }&quot;,‚Ä¶}
4
: 
{,‚Ä¶}</description>
    </feature>
    <feature>
      <name>Fix CSRF validation error on chat page</name>
      <description>Fix csrf validation failed on /chat page</description>
    </feature>
    <feature>
      <name>Optimize settings page loading performance</name>
      <description>Very slow loading on settings page, please analyze why it does take som uch time an dfix that</description>
    </feature>
    <feature>
      <name>Fix custom page mutations configuration error on save</name>
      <description>Fix saving mutations on custom pages, for example: http://localhost:3000/settings

When using form save button, this leads to an error that the custom mutation is not configred properly. Please verify if that&apos;s the only place where it happens</description>
    </feature>
    <feature>
      <name>Feature: feature-1769191925365-sjkar2lj8</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix CSRF validation error on chat page

**Description:** Fix csrf validation failed on /chat page

---

## Task Description

That is not fixed, still doesnt work, plese fix that validation.</description>
    </feature>
    <feature>
      <name>Fix audit logs GraphQL query validation error</name>
      <description>Get audit logs page does not work:

{
    &quot;errors&quot;: [
        {
            &quot;message&quot;: &quot;Field \&quot;changeDetails\&quot; must not have a selection since type \&quot;JSON\&quot; has no subfields.&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 22,
                    &quot;column&quot;: 31
                }
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;GRAPHQL_VALIDATION_FAILED&quot;,
                &quot;stacktrace&quot;: [
                    &quot;GraphQLError: Field \&quot;changeDetails\&quot; must not have a selection since type \&quot;JSON\&quot; has no subfields.&quot;,
                    &quot;    at Object.Field (/app/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/rules/ScalarLeafsRule.js:32:15)&quot;,
                    &quot;    at Object.enter (/app/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/language/visitor.js:298:32)&quot;,
                    &quot;    at Object.enter (/app/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/utilities/TypeInfo.js:391:27)&quot;,
                    &quot;    at visit (/app/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/language/visitor.js:194:21)&quot;,
                    &quot;    at validate (/app/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/validate.js:91:24)&quot;,
                    &quot;    at processGraphQLRequest (/app/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/requestPipeline.ts:263:38)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,
                    &quot;    at async internalExecuteOperation (/app/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/ApolloServer.ts:1362:12)&quot;,
                    &quot;    at async runHttpQuery (/app/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/runHttpQuery.ts:233:27)&quot;,
                    &quot;    at async runPotentiallyBatchedHttpQuery (/app/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/httpBatching.ts:85:12)&quot;
                ]
            }
        }
    ]
}

Please make necessary fixes</description>
    </feature>
    <feature>
      <name>Fix queryConfig const reassignment error</name>
      <description>Build does not pass with:

onventions/instrumentation-client
 ‚úì Compiled successfully in 6.0s
   Skipping linting
   Checking validity of types ...
Failed to compile.

./src/providers/data-provider/index.ts:1020:7
Type error: Cannot assign to &apos;queryConfig&apos; because it is a constant.

  1018 |     if (!queryConfig &amp;&amp; normalizedMethod === &apos;get&apos; &amp;&amp; url &amp;&amp; url.startsWith(&apos;/&apos;)) {
  1019 |       const operation = url.substring(1).replace(/^\//, &apos;&apos;);
&gt; 1020 |       queryConfig = {
       |       ^
  1021 |         operation,
  1022 |         fields: [], // Will be populated by caller if needed
  1023 |         args: undefined,
Next.js build worker exited with code: 1 and signal: null
‚ÄâELIFECYCLE‚Äâ Command failed with exit code 1.
command finished with error: command (/Users/piteer/workspace/radca-prawny/legal/apps/web) /opt/homebrew/bin/pnpm run build exited (1)
‚îî‚îÄ @legal/web#build ‚îÄ‚îÄ
@legal/web#build: command (/Users/piteer/workspace/radca-prawny/legal/apps/web) /opt/homebrew/bin/pnpm run build exited (1)

 Tasks:    4 successful, 5 total
Cached:    3 cached, 5 total
  Time:    16.917s 
Failed:    @legal/web#build</description>
    </feature>
    <feature>
      <name>Fix custom page mutation save error</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix custom page mutations configuration error on save

**Description:** Fix saving mutations on custom pages, for example: http://localhost:3000/settings

When using form save button, this leads to an error that the custom mutation is not configred properly. Please verify if that&apos;s the only place where it happens

---

## Task Description

This was not fixed, please come back to that task and use form to try to save in form at /settings page. Please fix that problem</description>
    </feature>
    <feature>
      <name>I need more information about the specific feature or fix you want me to create a title for. 

Based on the context provided, it seems like you want a title for the current sub-task. Is it one of these?

1. **Fix custom page mutations configuration error on save** - (the parent task that&apos;s already completed)
2. **A new sub-task related to fixing the mutations error** - (which you mention &quot;wasn&apos;t still fixed&quot;)
3. **Create e2e tests for custom page mutations** - (the validation/testing aspect)

Could you clarify which specific feature/fix you need a title for, or provide a brief description of what needs to be done?</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix custom page mutations configuration error on save

**Description:** Fix saving mutations on custom pages, for example: http://localhost:3000/settings

When using form save button, this leads to an error that the custom mutation is not configred properly. Please verify if that&apos;s the only place where it happens

---

## Task Description

This wasn&apos;t still fixd, please fix that error, then validate it through e2e tests. Make sure you also create tests for that problem</description>
    </feature>
    <feature>
      <name>Analyze CSRF Token Endpoint Configuration</name>
      <description>Investigate why CSRF token requests are hitting /api/api/csrf-token (double api prefix) instead of the correct endpoint. Examine the GraphQL client configuration, CSRF token fetching logic, and backend route registration. Identify where the duplicate /api/ prefix is being introduced in the request path.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Chat Interface</name>
      <description>Implement skeleton message bubbles in chat interface while AI response is being generated. Show pulsing skeleton for incoming message. Apply to both Legal Q&amp;A Chat and Pro chat modes. Ensure skeleton matches message bubble styling and positioning.</description>
    </feature>
    <feature>
      <name>Create Reusable Loading Skeleton Components</name>
      <description>Create a comprehensive library of loading skeleton components to replace inconsistent GIF-based loading states. Implement skeleton screens for: 1) Table rows with shimmer effect, 2) Card grids, 3) Form inputs, 4) Detail views, 5) Dashboard widgets. Use shadcn/ui Skeleton component or custom CSS animations with consistent styling. Ensure skeletons match the exact layout of content to prevent layout shift.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Audit Log List</name>
      <description>Implement skeleton placeholder rows in audit log table view. Match audit log table structure with columns for timestamp, action, user, resource, and details. Use consistent skeleton animation. Handle both initial load and pagination loading states.</description>
    </feature>
    <feature>
      <name>Fix chat endpoint validation for session ID</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Analyze CSRF Token Endpoint Configuration

**Description:** Investigate why CSRF token requests are hitting /api/api/csrf-token (double api prefix) instead of the correct endpoint. Examine the GraphQL client configuration, CSRF token fetching logic, and backend route registration. Identify where the duplicate /api/ prefix is being introduced in the request path.

---

## Task Description

After changes with csrf token, now the same chat endpoint returns bad request exception:

{
    &quot;errors&quot;: [
        {
            &quot;message&quot;: &quot;Bad Request Exception&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 3,
                    &quot;column&quot;: 13
                }
            ],
            &quot;path&quot;: [
                &quot;askLegalQuestion&quot;
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;BAD_REQUEST&quot;,
                &quot;stacktrace&quot;: [
                    &quot;BadRequestException: Bad Request Exception&quot;,
                    &quot;    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)&quot;,
                    &quot;    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,
                    &quot;    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)&quot;,
                    &quot;    at async Promise.all (index 0)&quot;,
                    &quot;    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)&quot;,
                    &quot;    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17&quot;
                ],
                &quot;originalError&quot;: {
                    &quot;message&quot;: [
                        &quot;Session ID must be a valid UUID v4&quot;
                    ],
                    &quot;error&quot;: &quot;Bad Request&quot;,
                    &quot;statusCode&quot;: 400
                }
            }
        }
    ],
    &quot;data&quot;: null
}</description>
    </feature>
    <feature>
      <name>Fix custom page mutations save configuration error</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix custom page mutations configuration error on save

**Description:** Fix saving mutations on custom pages, for example: http://localhost:3000/settings

When using form save button, this leads to an error that the custom mutation is not configred properly. Please verify if that&apos;s the only place where it happens. Please firstly FOCUS on the /settings page, not other ones. Screenshot shows the error. Please use playwright to validate if fix was successful

---

## Task Description

This is not fixed, fix that problem once and for all. You are not allowed to move htis task to complete until it&apos;s verified


Focus on frontend problems, this is not graphql problem it&apos;s probably a separate page problem located at authenticated/settings/page.tsx</description>
    </feature>
    <feature>
      <name>Fix settings page save data persistence</name>
      <description>Fix Settings Page Save Functionality - setup of data source in refine.dev invalid

Resolve the &quot;Custom query/mutation not configured properly&quot; error preventing data persistence on /settings page.

Technical Implementation:
- E2E Testing: Use Playwright to navigate to /settings and then to preferences and trigger save action
- Error Root Cause: Likely missing or misconfigured refined.dev data source or custom page
- Frontend: Check mutation query definition, variables mapping, refine.dev data sources/form settings

Investigation Steps:
1. Playwright Script:
   - Navigate to login page, authenticate with admin@refine.dev/password
   - Navigate to /settings or /settings then to preferences
   - Interact with form fields (change any preference value)
   - Click save button
   - Capture error from network tab, console, or UI toast/alert

2. Frontend Analysis:
   - Locate save button handler and GraphQL mutation call
   - Verify refine.dev custom mutation
   - Check if mutation is properly exported from graphql files
   - Review code based on https://refine.dev/core/docs/data/hooks/use-update/ and https://refine.dev/core/docs/data/hooks/use-custom-mutation/#basic-usage

3. Backend Analysis:
   - Find corresponding mutation resolver in schema/resolvers
   - Verify resolver function signature and return type
   - Check type definitions match between schema and resolvers
   - Ensure mutation is registered in GraphQL module/registry

Common Issues to Check:
- Mutation not exported in GraphQL schema file
- Resolver function name mismatch
- Missing @Mutation decorator (NestJS) or resolver mapping
- Incorrect input type or missing input validation
- Auth/permission middleware blocking request
- Apollo cache update policy causing silent failures

Error Handling:
- Check backend logs for resolver errors
- Verify frontend error boundary catches GraphQL errors
- Ensure proper error messages surface to user

Files to Investigate:
- Frontend: pages/settings/*.tsx, mutations/*.graphql, hooks/useSave*.ts
- Backend: schema.graphql, resolvers/settings.resolver.ts, services/settings.service.ts

Security: Verify mutation requires authentication and validates user permissions</description>
    </feature>
    <feature>
      <name>Fix session ID validation in legal-ai chat</name>
      <description>Fix error on legal-ai (chat) page:

{
    &quot;errors&quot;: [
        {
            &quot;message&quot;: &quot;Bad Request Exception&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 3,
                    &quot;column&quot;: 13
                }
            ],
            &quot;path&quot;: [
                &quot;askLegalQuestion&quot;
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;BAD_REQUEST&quot;,
                &quot;stacktrace&quot;: [
                    &quot;BadRequestException: Bad Request Exception&quot;,
                    &quot;    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)&quot;,
                    &quot;    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,
                    &quot;    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)&quot;,
                    &quot;    at async Promise.all (index 0)&quot;,
                    &quot;    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)&quot;,
                    &quot;    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17&quot;
                ],
                &quot;originalError&quot;: {
                    &quot;message&quot;: [
                        &quot;Session ID must be a valid UUID v4&quot;
                    ],
                    &quot;error&quot;: &quot;Bad Request&quot;,
                    &quot;statusCode&quot;: 400
                }
            }
        }
    ],
    &quot;data&quot;: null
}</description>
    </feature>
    <feature>
      <name>Fix UI package exports for utils import</name>
      <description>Fix:

Build Error

Module not found: Package path ./utils is not exported from package /app/apps/web/node_modules/@legal/ui (see exports field in /app/apps/web/node_modules/@legal/ui/package.json)

./src/components/settings/settings-api-keys.tsx (17:1)

Module not found: Package path ./utils is not exported from package /app/apps/web/node_modules/@legal/ui (see exports field in /app/apps/web/node_modules/@legal/ui/package.json)
  15 | } from &apos;lucide-react&apos;;
  16 | import { LoadingButton } from &apos;@legal/ui&apos;;
&gt; 17 | import { cn } from &apos;@legal/ui/utils&apos;;
     | ^
  18 |
  19 | interface ApiKey {
  20 |   id: string;

https://nextjs.org/docs/messages/module-not-found

Import trace for requested module:
./src/app/(authenticated)/settings/page.tsx</description>
    </feature>
    <feature>
      <name>Fix Settings Page E2E Test Failures</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix custom page mutations configuration error on save

**Description:** Fix saving mutations on custom pages, for example: http://localhost:3000/settings

When using form save button, this leads to an error that the custom mutation is not configred properly. Please verify if that&apos;s the only place where it happens

---

## Task Description

E2E Testing for Settings Page - Fix Failing Tests

Create and fix end-to-end tests specifically for the /settings page that are currently failing or non-existent. Screenshot shows the error

Requirements:
- Focus exclusively on the /settings page - do not modify or test other pages
- Identify why existing tests are failing or what test coverage is missing
- Write comprehensive e2e tests covering all functionality on the settings page including:
  - All form inputs and controls
  - Save/update operations
  - Validation rules and error states
  - Any toggles, dropdowns, or interactive elements
  - Page load and rendering
- Run the tests to verify they pass consistently
- Fix any underlying issues in the /settings page that cause test failures
- Ensure tests are stable and not flaky
- Document what was broken and how it was fixed

Success Criteria:
- All e2e tests for /settings page pass reliably
- Test coverage includes all major user interactions on the page
- No regressions introduced to the /settings page functionality</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Dashboard Widgets</name>
      <description>Implement skeleton placeholders for all dashboard widgets: document count cards, activity timeline, notification bell, and statistics charts. Show card-shaped skeletons with shimmer effect for widget containers. Ensure widgets load progressively as data becomes available.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Document List View</name>
      <description>Implement skeleton placeholder rows in the document list table while data is loading. Show 5-10 skeleton rows matching table column structure (title, status, date, actions). Apply shimmer animation effect. Ensure skeleton appears immediately on page load and smoothly transitions to actual data.</description>
    </feature>
    <feature>
      <name>Fix Session ID UUID validation error</name>
      <description>Fix {errors: [,‚Ä¶], data: null}
data
: 
null
errors
: 
[,‚Ä¶]
0
: 
{message: &quot;Bad Request Exception&quot;, locations: [{line: 3, column: 13}], path: [&quot;askLegalQuestion&quot;],‚Ä¶}
extensions
: 
{code: &quot;BAD_REQUEST&quot;, stacktrace: [&quot;BadRequestException: Bad Request Exception&quot;,‚Ä¶],‚Ä¶}
code
: 
&quot;BAD_REQUEST&quot;
originalError
: 
{message: [&quot;Session ID must be a valid UUID v4&quot;], error: &quot;Bad Request&quot;, statusCode: 400}
error
: 
&quot;Bad Request&quot;
message
: 
[&quot;Session ID must be a valid UUID v4&quot;]
statusCode
: 
400
stacktrace
: 
[&quot;BadRequestException: Bad Request Exception&quot;,‚Ä¶]
0
: 
&quot;BadRequestException: Bad Request Exception&quot;
1
: 
&quot;    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)&quot;
2
: 
&quot;    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)&quot;
3
: 
&quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;
4
: 
&quot;    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)&quot;
5
: 
&quot;    at async Promise.all (index 0)&quot;
6
: 
&quot;    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)&quot;
7
: 
&quot;    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17&quot;
locations
: 
[{line: 3, column: 13}]
0
: 
{line: 3, column: 13}
message
: 
&quot;Bad Request Exception&quot;
path
: 
[&quot;askLegalQuestion&quot;]
0
: 
&quot;askLegalQuestion&quot;</description>
    </feature>
    <feature>
      <name>Fix sessionId type validation in queries resolver</name>
      <description>Fix: legal-ai-backend  | src/modules/queries/queries.resolver.ts:166:7 - error TS2322: Type &apos;string | undefined&apos; is not assignable to type &apos;string&apos;.
legal-ai-backend  |   Type &apos;undefined&apos; is not assignable to type &apos;string&apos;.
legal-ai-backend  | 
legal-ai-backend  | 166       sessionId: input.sessionId,
legal-ai-backend  |           ~~~~~~~~~
legal-ai-backend  | 
legal-ai-backend  |   src/modules/queries/services/queries.service.ts:12:3
legal-ai-backend  |     12   sessionId: string;
legal-ai-backend  |          ~~~~~~~~~
legal-ai-backend  |     The expected type comes from property &apos;sessionId&apos; which is declared here on type &apos;SubmitQueryDto&apos;
legal-ai-backend  | 
legal-ai-backend  | [8:14:06 PM] Found 1 error. Watching for file changes.
legal-ai-backend  |</description>
    </feature>
    <feature>
      <name>Fix foreign key constraint violation in legal queries</name>
      <description>Fix {
    &quot;errors&quot;: [
        {
            &quot;message&quot;: &quot;insert or update on table \&quot;legal_queries\&quot; violates foreign key constraint \&quot;FK_c173b23bdeb8b4cefceb9ea8325\&quot;&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 3,
                    &quot;column&quot;: 13
                }
            ],
            &quot;path&quot;: [
                &quot;askLegalQuestion&quot;
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;INTERNAL_SERVER_ERROR&quot;,
                &quot;stacktrace&quot;: [
                    &quot;QueryFailedError: insert or update on table \&quot;legal_queries\&quot; violates foreign key constraint \&quot;FK_c173b23bdeb8b4cefceb9ea8325\&quot;&quot;,
                    &quot;    at PostgresQueryRunner.query (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/driver/src/driver/postgres/PostgresQueryRunner.ts:325:19)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;,
                    &quot;    at async InsertQueryBuilder.execute (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/query-builder/src/query-builder/InsertQueryBuilder.ts:164:33)&quot;,
                    &quot;    at async SubjectExecutor.executeInsertOperations (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/persistence/src/persistence/SubjectExecutor.ts:435:42)&quot;,
                    &quot;    at async SubjectExecutor.execute (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/persistence/src/persistence/SubjectExecutor.ts:137:9)&quot;,
                    &quot;    at async EntityPersistExecutor.execute (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/persistence/src/persistence/EntityPersistExecutor.ts:182:21)&quot;,
                    &quot;    at async QueriesService.askQuestion (/app/apps/backend/src/modules/queries/services/queries.service.ts:333:24)&quot;
                ]
            }
        }
    ],
    &quot;data&quot;: null
}</description>
    </feature>
    <feature>
      <name>Fix legal AI page errors with Playwright tests</name>
      <description>## Parent Task Context (Already Completed)

&gt; **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.

### Fix Session ID UUID validation error

**Description:** Fix {errors: [,‚Ä¶], data: null}
data
: 
null
errors
: 
[,‚Ä¶]
0
: 
{message: &quot;Bad Request Exception&quot;, locations: [{line: 3, column: 13}], path: [&quot;askLegalQuestion&quot;],‚Ä¶}
extensions
: 
{code: &quot;BAD_REQUEST&quot;, stacktrace: [&quot;BadRequestException: Bad Request Exception&quot;,‚Ä¶],‚Ä¶}
code
: 
&quot;BAD_REQUEST&quot;
originalError
: 
{message: [&quot;Session ID must be a valid UUID v4&quot;], error: &quot;Bad Request&quot;, statusCode: 400}
error
: 
&quot;Bad Request&quot;
message
: 
[&quot;Session ID must be a valid UUID v4&quot;]
statusCode
: 
400
stacktrace
: 
[&quot;BadRequestException: Bad Request Exception&quot;,‚Ä¶]
0
: 
&quot;BadRequestException: Bad Request Exception&quot;
1
: 
&quot;    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)&quot;
2
: 
&quot;    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)&quot;
3
: 
&quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;
4
: 
&quot;    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)&quot;
5
: 
&quot;    at async Promise.all (index 0)&quot;
6
: 
&quot;    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)&quot;
7
: 
&quot;    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17&quot;
locations
: 
[{line: 3, column: 13}]
0
: 
{line: 3, column: 13}
message
: 
&quot;Bad Request Exception&quot;
path
: 
[&quot;askLegalQuestion&quot;]
0
: 
&quot;askLegalQuestion&quot;

---

## Task Description

Fix additional errors on legal ai page. Make sure to fix other ones that could happen, Use playwright for testing, make sure to create also e2e tests. Add documdntation about runnign e2e tests. Assume that the docker compose was run and all services are up and running under http://localhost:3000

{errors: [{,‚Ä¶}], data: null}
data
: 
null
errors
: 
[{,‚Ä¶}]
0
: 
{,‚Ä¶}
extensions
: 
{code: &quot;INTERNAL_SERVER_ERROR&quot;, stacktrace: [,‚Ä¶]}
code
: 
&quot;INTERNAL_SERVER_ERROR&quot;
stacktrace
: 
[,‚Ä¶]
0
: 
&quot;QueryFailedError: insert or update on table \&quot;legal_queries\&quot; violates foreign key constraint \&quot;FK_c173b23bdeb8b4cefceb9ea8325\&quot;&quot;
1
: 
&quot;    at PostgresQueryRunner.query (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/driver/src/driver/postgres/PostgresQueryRunner.ts:325:19)&quot;
2
: 
&quot;    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)&quot;
3
: 
&quot;    at async InsertQueryBuilder.execute (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/query-builder/src/query-builder/InsertQueryBuilder.ts:164:33)&quot;
4
: 
&quot;    at async SubjectExecutor.executeInsertOperations (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/persistence/src/persistence/SubjectExecutor.ts:435:42)&quot;
5
: 
&quot;    at async SubjectExecutor.execute (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/persistence/src/persistence/SubjectExecutor.ts:137:9)&quot;
6
: 
&quot;    at async EntityPersistExecutor.execute (/app/node_modules/.pnpm/typeorm@0.3.28_ioredis@5.8.2_pg@8.16.3_ts-node@10.9.2_@types+node@22.19.3_typescript@5.9.3_/node_modules/typeorm/persistence/src/persistence/EntityPersistExecutor.ts:182:21)&quot;
7
: 
&quot;    at async QueriesService.askQuestion (/app/apps/backend/src/modules/queries/services/queries.service.ts:333:24)&quot;
locations
: 
[{line: 3, column: 13}]
message
: 
&quot;insert or update on table \&quot;legal_queries\&quot; violates foreign key constraint \&quot;FK_c173b23bdeb8b4cefceb9ea8325\&quot;&quot;
path
: 
[&quot;askLegalQuestion&quot;]</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Analytics Dashboard</name>
      <description>Implement skeleton placeholders for analytics dashboard charts and metrics. Show chart-shaped skeletons for graphs and counter skeletons for statistics. Ensure smooth transition when analytics data loads.</description>
    </feature>
    <feature>
      <name>Create Generic Table Loading Skeleton Wrapper</name>
      <description>Create a reusable wrapper for Refine useTable hooks that automatically shows skeleton rows while data is loading. Integrate with data provider to detect loading state and generate appropriate number of skeleton rows based on page size.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Billing Page</name>
      <description>Implement skeleton placeholders for billing information display. Show card-shaped skeletons for subscription status, payment history, and plan details. Apply shimmer effect while billing data is being fetched.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Notification Center</name>
      <description>Implement skeleton notification items in notification center and dropdown. Show skeleton bell icon, notification list items with shimmer effect. Match notification item layout including icon, message, timestamp, and action buttons.</description>
    </feature>
    <feature>
      <name>Remove Inconsistent GIF Loading Animations</name>
      <description>Audit all pages to identify GIF-based loading animations and replace them with skeleton components. Search for spinning loaders, GIF images, and old loading indicators. Replace with appropriate skeleton components from the new library. Ensure consistent loading experience across entire application.</description>
    </feature>
    <feature>
      <name>Create Generic Form Loading Skeleton Wrapper</name>
      <description>Create a reusable HOC or wrapper component that automatically shows skeleton placeholders for any form while data is loading. Detect form field structure and generate matching skeleton elements. Support React Hook Form and Refine form integrations.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Settings Page</name>
      <description>Implement skeleton placeholders for settings page form inputs and tabs. Show skeleton fields for profile settings, preferences, security options, and notification settings. Match form field layout with proper spacing and label placeholders.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Search Results</name>
      <description>Implement skeleton placeholders for global search results. Show result cards matching the layout of document, ruling, and template search results. Apply to both header search bar and advanced search page.</description>
    </feature>
    <feature>
      <name>Add Skeleton Loading to Case Law Search</name>
      <description>Implement skeleton placeholders for ruling search results page. Match ruling card layout with skeleton placeholders for court name, date, summary, and action buttons. Handle both initial search and pagination loading states.</description>
    </feature>
    <feature>
      <name>Add E2E Tests for Loading Skeleton States</name>
      <description>Create Playwright E2E tests verifying skeleton components appear correctly during data loading. Test that: 1) Skeletons show immediately on page load, 2) Skeletons smoothly transition to real data, 3) No layout shift occurs, 4) Skeletons disappear when data loads, 5) Error states handle properly. Test all major pages: dashboard, documents, audit logs, settings, chat.</description>
    </feature>
    <feature>
      <name>Fix GraphQL enum validation for preference mutations</name>
      <description>Fix the backend error when saving prerefences:

{
    &quot;errors&quot;: [
        {
            &quot;message&quot;: &quot;Enum \&quot;ThemePreference\&quot; cannot represent non-enum value: \&quot;SYSTEM\&quot;. Did you mean the enum value \&quot;SYSTEM\&quot;?&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 3,
                    &quot;column&quot;: 63
                }
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;GRAPHQL_VALIDATION_FAILED&quot;,
                &quot;stacktrace&quot;: [
                    &quot;GraphQLError: Enum \&quot;ThemePreference\&quot; cannot represent non-enum value: \&quot;SYSTEM\&quot;. Did you mean the enum value \&quot;SYSTEM\&quot;?&quot;,
                    &quot;    at GraphQLEnumType.parseLiteral (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/type/definition.js:1158:13)&quot;,
                    &quot;    at isValidValueNode (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/rules/ValuesOfCorrectTypeRule.js:171:30)&quot;,
                    &quot;    at Object.StringValue (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/rules/ValuesOfCorrectTypeRule.js:135:28)&quot;,
                    &quot;    at Object.enter (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/language/visitor.js:298:32)&quot;,
                    &quot;    at Object.enter (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/utilities/TypeInfo.js:391:27)&quot;,
                    &quot;    at visit (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/language/visitor.js:194:21)&quot;,
                    &quot;    at validate (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/validate.js:91:24)&quot;,
                    &quot;    at processGraphQLRequest (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/requestPipeline.ts:263:38)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)&quot;,
                    &quot;    at async internalExecuteOperation (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/ApolloServer.ts:1362:12)&quot;
                ]
            }
        },
        {
            &quot;message&quot;: &quot;Enum \&quot;AiModelType\&quot; cannot represent non-enum value: \&quot;GPT_4_TURBO\&quot;. Did you mean the enum value \&quot;GPT_4_TURBO\&quot; or \&quot;GPT_3_5_TURBO\&quot;?&quot;,
            &quot;locations&quot;: [
                {
                    &quot;line&quot;: 3,
                    &quot;column&quot;: 82
                }
            ],
            &quot;extensions&quot;: {
                &quot;code&quot;: &quot;GRAPHQL_VALIDATION_FAILED&quot;,
                &quot;stacktrace&quot;: [
                    &quot;GraphQLError: Enum \&quot;AiModelType\&quot; cannot represent non-enum value: \&quot;GPT_4_TURBO\&quot;. Did you mean the enum value \&quot;GPT_4_TURBO\&quot; or \&quot;GPT_3_5_TURBO\&quot;?&quot;,
                    &quot;    at GraphQLEnumType.parseLiteral (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/type/definition.js:1158:13)&quot;,
                    &quot;    at isValidValueNode (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/rules/ValuesOfCorrectTypeRule.js:171:30)&quot;,
                    &quot;    at Object.StringValue (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/rules/ValuesOfCorrectTypeRule.js:135:28)&quot;,
                    &quot;    at Object.enter (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/language/visitor.js:298:32)&quot;,
                    &quot;    at Object.enter (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/utilities/TypeInfo.js:391:27)&quot;,
                    &quot;    at visit (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/language/visitor.js:194:21)&quot;,
                    &quot;    at validate (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/graphql@16.12.0/node_modules/graphql/validation/validate.js:91:24)&quot;,
                    &quot;    at processGraphQLRequest (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/requestPipeline.ts:263:38)&quot;,
                    &quot;    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)&quot;,
                    &quot;    at async internalExecuteOperation (/Users/piteer/workspace/radca-prawny/legal/node_modules/.pnpm/@apollo+server@5.2.0_graphql@16.12.0/node_modules/@apollo/server/src/ApolloServer.ts:1362:12)&quot;
                ]
            }
        }
    ]
}</description>
    </feature>
    <feature>
      <name>Session Expiry HTTP Interceptor</name>
      <description>Create an HTTP interceptor in the frontend to catch 401 Unauthorized and 403 Forbidden responses from the backend. When session expiry is detected, automatically trigger logout flow and redirect to login page. Show user-friendly toast notification indicating session has expired.</description>
    </feature>
    <feature>
      <name>Backend Authentication Error Responses</name>
      <description>Ensure backend GraphQL authentication layer returns proper HTTP status codes (401 for expired/invalid tokens, 403 for forbidden access) instead of generic errors. Update JWT guard and authentication strategy to throw appropriate exceptions with correct status codes. Verify GraphQL error responses include clear expiry indicators.</description>
    </feature>
    <feature>
      <name>Admin Layout and Routing Structure</name>
      <description>Create dedicated admin section under /admin path with separate layout component. Implement AdminLayout component with admin-specific navigation, sidebar, and header. Configure Next.js middleware to redirect non-admin users away from /admin routes. Add admin route group in app directory structure. Separate admin concerns from regular user-facing pages.</description>
    </feature>
    <feature>
      <name>Session Expiry E2E Tests</name>
      <description>Create Playwright E2E tests to verify session expiry handling. Test scenarios: 1) Manual JWT token expiration manipulation, 2) Waiting for token timeout, 3) Backend session invalidation, 4) Verify automatic logout and redirect to login page, 5) Verify user-friendly error message is displayed. Use test utilities to simulate expired tokens and backend responses.</description>
    </feature>
    <feature>
      <name>User-Role Relationship Entity</name>
      <description>Create many-to-many relationship between User and Role entities in infrastructure layer. Implement UserRole entity with timestamps and audit trail. Add repository interface in domain layer and concrete implementation using nestjs-query. Support multiple roles per user with role priority ordering.</description>
    </feature>
    <feature>
      <name>Group Admin Actions in Dedicated Resolvers</name>
      <description>Refactor GraphQL resolvers to group admin-specific mutations and queries in dedicated Admin resolvers. Apply @Roles(ADMIN) decorator to all admin resolver methods. Separate admin mutations (userCreate, roleAssign, systemUpdate) from regular user operations. Ensure admin actions require both authentication AND admin role through guard combination.</description>
    </feature>
    <feature>
      <name>Admin and Non-Admin Seed Data</name>
      <description>Update database seed files to include users with different roles: admin user (admin@refine.dev with ADMIN role), lawyer user (lawyer@example.com with LAWYER role), and regular user (user@example.com with USER role). Add Role seed data with all role definitions. Create UserRole seed relationships. Ensure seeds properly populate RBAC tables for development and testing.</description>
    </feature>
    <feature>
      <name>Admin Role and RBAC Entity Design</name>
      <description>Design Role entity following DDD principles with bounded context for Authorization. Define Role aggregate with enum-based roles (ADMIN, LAWYER, USER) and permission system. Create value objects for Permission with granular access control (READ, WRITE, DELETE, MANAGE) per resource type. Establish domain events for role changes. Implement role hierarchy and permission inheritance in domain layer.</description>
    </feature>
    <feature>
      <name>Admin Role Guard Implementation</name>
      <description>Create NestJS guard decorated with @UseGuards that checks user roles before allowing access to admin routes. Implement RoleGuard that reads user roles from JWT/context and validates against required roles using metadata from @Roles decorator. Support role hierarchy (ADMIN can access USER routes). Apply to all admin resolvers and routes.</description>
    </feature>
    <feature>
      <name>Admin System Overview Dashboard</name>
      <description>Create comprehensive admin dashboard at /admin/dashboard displaying system-wide statistics and real-time metrics. Show total document count, documents currently generating (by status), completed vs failed document ratios, total users count, active sessions, estimated token usage (daily/monthly), AI query volume, and system health indicators. Implement auto-refresh every 30 seconds for real-time data. Create dedicated GraphQL queries aggregating statistics across all entities (LegalDocument, User, LegalQuery, UsageRecord). Display charts for token usage trends, document generation throughput, and user activity over time.</description>
    </feature>
    <feature>
      <name>Admin Usage Statistics Aggregation Service</name>
      <description>Create application service in backend for aggregating usage statistics across all users. Implement GraphQL queries for: getTotalDocumentCount (grouped by status), getActiveUsersCount (users active in last 24h/7d/30d), getTotalTokenUsage (daily/monthly breakdown), getQueryVolume (queries per day chart), getDocumentGenerationMetrics (average generation time, success rate), getUserGrowthStats (new users per period). Create StatsResolver with @Admin guard. Implement efficient database queries using aggregation functions and materialized views if needed. Cache results with TTL for performance. Support date range filtering for all statistics.</description>
    </feature>
    <feature>
      <name>Admin User Management CRUD Operations</name>
      <description>Implement full CRUD operations for user management in admin section using nestjs-query auto-generated resolvers. Add mutations for creating users, updating user roles, suspending accounts, and resetting passwords. Apply RoleGuard to ensure only admins can access. Create admin UI page at /admin/users with table view, search, filters, and bulk actions.</description>
    </feature>
    <feature>
      <name>Admin User Management CRUD Page</name>
      <description>Implement comprehensive user management interface at /admin/users using Refine&apos;s useTable hook with GraphQL data provider. Display user list with columns: email, username, roles, status (active/inactive), created date, last login. Implement filtering by role and status, sorting by all columns, and pagination. Add row actions: view details, edit user, suspend/activate account, reset password, delete user (with confirmation). Create UserListDialog component for inline actions. Apply RoleGuard to ensure only admins can access. Integrate with existing User, Role, and UserRole entities.</description>
    </feature>
    <feature>
      <name>GraphQL Code Generator Setup and Configuration</name>
      <description>Install and configure GraphQL Code Generator (@graphql-codegen/cli) to auto-generate TypeScript types from GraphQL schema. Set up codegen.yml configuration file with TypeScript, TypeScript Operations, and TypeScript React Query plugins. Configure document loading patterns for .graphql files in apps/web. Add npm scripts for generating types (codegen, codegen:watch). Integrate with existing GraphQL schema from backend.</description>
    </feature>
    <feature>
      <name>Frontend Role-Based Route Protection</name>
      <description>Implement frontend route protection that checks user role before navigating to protected routes. Create useUserRole hook to fetch user roles from GraphQL. Add ProtectedRoute wrapper component that redirects unauthorized users. Integrate with Refine&apos;s authProvider to include role information in identity context. Show 403 page for insufficient permissions.</description>
    </feature>
    <feature>
      <name>Migrate Audit Logs Queries to GraphQL Codegen</name>
      <description>Extract audit log operations (auditLogs query, filtering, pagination) from inline strings to apps/web/src/graphql/audit-logs.graphql. Create AuditLogFragment excluding changeDetails JSON field from sub-selections. Generate types resolving JSON serialization errors. Update audit log list view to use generated types with proper pagination typing.</description>
    </feature>
    <feature>
      <name>Migrate Auth Queries to GraphQL Codegen</name>
      <description>Move authentication GraphQL operations (login, register, refreshToken, logout) from inline strings to .graphql files in apps/web/src/graphql/queries/auth.graphql and apps/web/src/graphql/mutations/auth.graphql. Generate TypeScript types using codegen. Update auth provider to use generated types (AuthLoginMutation, AuthRegisterMutation, etc.). Replace manual type definitions with codegen-generated types.</description>
    </feature>
    <feature>
      <name>Migrate Legal Q&amp;A Chat Queries to GraphQL Codegen</name>
      <description>Extract chat operations (askLegalQuestion mutation, legalQueries query, session history) from inline strings to apps/web/src/graphql/chat.graphql. Use LegalQueryFragment for consistent fields. Generate types for AskLegalQuestionMutationVariables, LegalQuery. Update chat components and hooks to use generated types. Ensure session ID typing matches backend UUID validation.</description>
    </feature>
    <feature>
      <name>Extract GraphQL Fragments to Separate Files</name>
      <description>Audit all existing GraphQL queries/mutations embedded in TSX files and extract reusable fragments into separate .graphql files. Create fragments for common entities: UserFragment, LegalDocumentFragment, NotificationFragment, AuditLogFragment, LegalQueryFragment. Store fragments in apps/web/src/graphql/fragments/ directory. Ensure fragments include all fields currently used in inline queries.</description>
    </feature>
    <feature>
      <name>Migrate Settings/Preferences Queries to GraphQL Codegen</name>
      <description>Extract settings operations (userPreferences query, updateUserPreferences mutation) from inline strings to apps/web/src/graphql/settings.graphql. Create UserPreferencesFragment. Generate types resolving enum validation issues (ThemePreference, AiModelType enums should use enum values not strings). Update settings page to use generated types with proper enum handling.</description>
    </feature>
    <feature>
      <name>E2E Tests for Role-Based Access Control</name>
      <description>Create Playwright E2E tests validating RBAC implementation. Test scenarios: 1) Regular user cannot access /admin routes, 2) Admin can access user management, 3) Role-based menu shows correct items, 4) Non-admin gets 403 when attempting admin mutations, 5) Seed users have correct roles. Test with admin@refine.dev and user@example.com credentials. Verify guards work on both frontend and backend.</description>
    </feature>
    <feature>
      <name>Dynamic Menu System Based on User Role</name>
      <description>Implement dynamic menu rendering that shows different navigation options based on user&apos;s role. Admin users see full admin menu (user management, system settings, audit logs, analytics). Regular users see simplified menu (documents, chat, settings). Create menu configuration registry mapping roles to menu items. Update Refine menu provider to check user permissions before rendering menu items.</description>
    </feature>
    <feature>
      <name>Migrate Document Queries to GraphQL Codegen</name>
      <description>Extract all document-related GraphQL operations (legalDocuments query, documentCreate mutation, documentUpdate mutation, documentDetail query) from inline strings to apps/web/src/graphql/documents.graphql. Use LegalDocumentFragment for consistent field selection. Generate types and update components (DocumentList, DocumentDetail, DocumentEdit) to use generated DocumentQueries and DocumentMutations types.</description>
    </feature>
    <feature>
      <name>Admin Real-Time Document Status Monitoring</name>
      <description>Implement real-time monitoring of document generation status across all users. Create GraphQL subscription &apos;documentStatusChanged&apos; emitting events when documents transition between DRAFT, GENERATING, COMPLETED, FAILED states. Display live count of documents currently in GENERATING status on admin dashboard. Add document status queue visualization showing pending, processing, completed, and failed document counts. Implement auto-refresh every 10 seconds for document queue metrics. Create recent activity feed showing latest document completions and failures. Integrate with existing DocumentStatusTracking feature.</description>
    </feature>
    <feature>
      <name>Admin User Creation Form</name>
      <description>Create user creation modal/page at /admin/users/new accessible from admin user management. Implement form with fields: email, username, password (with generate option), roles (multi-select), status (active/inactive), optional profile fields. Include email validation checking for existing users. Send welcome email upon creation with temporary password if auto-generated. Apply RoleGuard for admin-only access. On success, redirect to user detail view or back to user list. Handle errors (duplicate email, validation failures) with user-friendly messages.</description>
    </feature>
    <feature>
      <name>Admin System Health Indicators</name>
      <description>Add system health monitoring section to admin dashboard. Display service status: database connectivity (PostgreSQL), cache status (Redis), AI Engine availability, external API status (SAOS, ISAP). Show response times for critical services. Implement health check GraphQL queries calling each service&apos;s /health endpoint. Add color-coded status indicators (green=healthy, yellow=degraded, red=down). Display error counts and recent errors from error tracking (Sentry). Show queue sizes: document generation queue depth, email queue depth, webhook delivery queue depth. Implement auto-refresh every 30 seconds.</description>
    </feature>
    <feature>
      <name>Admin Token Usage Analytics</name>
      <description>Create comprehensive token usage analytics page at /admin/analytics/tokens. Display aggregate token consumption metrics: total tokens used (all time, this month, today), average tokens per query, per-user token usage leaderboard, token usage trends over time (line chart), breakdown by operation type (document generation, Q&amp;A, classification). Implement filtering by date range and user. Show cost estimation based on token pricing. Create export functionality for usage reports (CSV/PDF). Add alerts for unusual usage patterns (spikes, high-consuming users). Integrate with existing UsageRecord entity.</description>
    </feature>
    <feature>
      <name>Admin User Detail View</name>
      <description>Create detailed user view page at /admin/users/:id showing comprehensive user profile information. Display user details (email, username, roles, status, timestamps), activity timeline (recent logins, actions taken, documents created), usage statistics (total documents, queries submitted, tokens consumed), and session history. Add tabs for: Documents (list of all user&apos;s documents), Queries (Q&amp;A history), Settings (user preferences and roles), Audit Log (user actions). Implement role assignment with multi-select dropdown. Support account suspension with reason field. Include password reset functionality sending email to user.</description>
    </feature>
    <feature>
      <name>Migrate Analytics Dashboard Queries to GraphQL Codegen</name>
      <description>Extract analytics operations (usageStats, tokenUsage, documentMetrics, userActivity) from inline strings to apps/web/src/graphql/analytics.graphql. Generate types for analytics responses with proper chart data typing. Update analytics dashboard to use generated types. Ensure aggregated statistics are properly typed.</description>
    </feature>
    <feature>
      <name>Integrate GraphQL Codegen into CI/CD Pipeline</name>
      <description>Add GraphQL Codegen type generation step to CI pipeline. Fail build if codegen detects breaking changes or type mismatches. Run codegen before TypeScript compilation. Add pre-commit hook to generate types when .graphql files change. Ensure type generation works in Docker build environment.</description>
    </feature>
    <feature>
      <name>Document GraphQL Codegen Usage Patterns</name>
      <description>Create documentation for using GraphQL Codegen in the project. Include examples of defining queries in .graphql files, using generated types, and working with generated React Query hooks. Document fragment composition, type generation workflow, and best practices. Add troubleshooting guide for common codegen issues.</description>
    </feature>
    <feature>
      <name>Migrate Admin Dashboard Queries to GraphQL Codegen</name>
      <description>Extract admin operations (adminStats, userManagement, bulkUserOperations, systemHealth) from inline strings to apps/web/src/graphql/admin.graphql. Create fragments for admin-specific entities. Generate types for all admin dashboard queries and mutations. Update admin components to use generated types with proper role-based access typing.</description>
    </feature>
    <feature>
      <name>Migrate Notification Queries to GraphQL Codegen</name>
      <description>Extract notification operations (recentNotifications query, markAsRead mutation, unreadNotificationCount query) from inline strings to apps/web/src/graphql/notifications.graphql. Use NotificationFragment. Generate types and update notification center and bell components to use generated types. Ensure subscription types are generated for real-time notifications.</description>
    </feature>
    <feature>
      <name>Migrate Billing/Subscription Queries to GraphQL Codegen</name>
      <description>Extract billing operations (billingInfo query, updateSubscription mutation, paymentHistory query) from inline strings to apps/web/src/graphql/billing.graphql. Create fragments for billing entities. Generate types and update billing page to use generated types. Resolve any custom query configuration issues with proper type generation.</description>
    </feature>
    <feature>
      <name>Update Project Documentation for RBAC and Seed Users</name>
      <description>Update .claude/CLAUDE.md, .speckit, and .automaker documentation to include RBAC architecture overview, role definitions, and permission matrix. Document all seed user credentials with their roles: admin@refine.dev (Admin role), lawyer@example.com (Lawyer role), user@example.com (User role). Include examples of accessing admin routes, role-based guards, and testing RBAC functionality. Add testing guide for role-based access control.</description>
    </feature>
    <feature>
      <name>Generate React Query Hooks with GraphQL Codegen</name>
      <description>Configure GraphQL Codegen to auto-generate React Query hooks (useQuery, useMutation) from GraphQL operations. Use @graphql-codegen/typescript-react-query plugin. Replace manual useCustom and data provider calls with generated hooks. Update all components to use generated hooks for type-safe data fetching and mutations.</description>
    </feature>
    <feature>
      <name>Migrate Search Queries to GraphQL Codegen</name>
      <description>Extract search operations (globalSearch, rulingSearch, advancedSearch) from inline strings to apps/web/src/graphql/search.graphql. Create fragments for search results. Generate types with proper search filter and result typing. Update search components and global search bar to use generated types.</description>
    </feature>
    <feature>
      <name>Admin User Bulk Operations</name>
      <description>Implement bulk operations on admin user management page. Add checkboxes for selecting multiple users. Support bulk actions: suspend accounts (with reason), activate accounts, assign roles (add/remove), export selected users (CSV), delete users (with confirmation and warning). Implement BulkUserMutation GraphQL resolver with proper authorization. Show confirmation dialogs before executing bulk operations. Display progress indicators for operations. Audit log all bulk actions with admin user ID and affected users.</description>
    </feature>
    <feature>
      <name>Implement Persisted Queries with GraphQL Codegen</name>
      <description>Configure GraphQL Codegen to generate persisted query documents and manifest. Set up automatic query hashing and persisted query support in backend. Replace runtime query parsing with pre-registered query IDs. Improves performance and security by eliminating ad-hoc queries.</description>
    </feature>
    <feature>
      <name>Configure AI Engine Hot-Reload in Dev Mode</name>
      <description>Ensure AI Engine runs with auto-reload enabled in development mode. Verify uvicorn configuration includes --reload flag for development. Configure file watching for Python source code changes in apps/ai-engine/src. Test that code changes trigger automatic server restart. Document hot-reload behavior and any limitations compared to Node.js HMR.</description>
    </feature>
    <feature>
      <name>Add AI Engine Process Manager to Monorepo</name>
      <description>Create process manager configuration for AI Engine service in development mode. Add npm script in root package.json to start AI Engine using `uv run dev` from apps/ai-engine directory. Configure concurrent process execution with proper logging and hot-reload support. Ensure process health checks and graceful shutdown handling. Update turbo.json tasks to include ai-engine:dev task with proper caching disabled and persistent process configuration.</description>
    </feature>
    <feature>
      <name>Integrate AI Engine into Turbo Dev Command</name>
      <description>Configure turbo.json to include AI Engine (Python/FastAPI) in the dev pipeline. Update turbo dev command to spawn Python uvicorn server alongside Node.js services. Ensure proper process management and port configuration for local development environment. The AI Engine should automatically start when `pnpm dev` or `pnpm dlx turbo dev` is executed, running concurrently with backend and web services.</description>
    </feature>
    <feature>
      <name>Configure Service Startup Order in Dev Mode</name>
      <description>Define proper startup sequence for development services: Database (PostgreSQL) -&gt; Backend (NestJS) -&gt; AI Engine (FastAPI) -&gt; Frontend (Next.js). Update turbo.json or package.json scripts to enforce dependency ordering. Add environment variable checks to ensure backend waits for AI Engine health check before starting dependent features. Document service startup order and interdependencies.</description>
    </feature>
  </implemented_features>

  <additional_requirements>
    <requirement>PostgreSQL database required for persistence</requirement>
    <requirement>Redis required for Bull queue job processing</requirement>
    <requirement>OpenAI API key required for AI document generation</requirement>
    <requirement>Node.js &gt;= 18 for backend and frontend</requirement>
    <requirement>Python &gt;= 3.11 for AI Engine</requirement>
    <requirement>Environment variables: DB_HOST, DB_PORT, DB_USERNAME, DB_PASSWORD, DB_DATABASE, JWT_SECRET, AI_ENGINE_URL, OPENAI_API_KEY, OPENAI_MODEL, REDIS_HOST, REDIS_PORT</requirement>
    <requirement>Architecture tests in CI to enforce module boundaries</requirement>
    <requirement>All features require legal disclaimer acceptance before use</requirement>
    <requirement>AI prompts must generate documents in Polish legal terminology</requirement>
    <requirement>Frontend must support Polish language localization for end users</requirement>
  </additional_requirements>

  <development_guidelines>
    <guideline>Domain-Driven Design (DDD): Software model must deeply reflect the legal business domain with clear aggregate roots and invariants</guideline>
    <guideline>Modular Monolith: Strict module boundaries - no direct imports between module domains; use events for inter-module communication</guideline>
    <guideline>GraphQL-Only Frontend API: All frontend-backend communication must use GraphQL; REST endpoints for frontend are forbidden</guideline>
    <guideline>REST for Service Communication: Backend-AI Engine uses REST with auto-generated OpenAPI clients</guideline>
    <guideline>Code-First Schema: API schemas (GraphQL, OpenAPI) must be generated from code definitions; manual schema files forbidden</guideline>
    <guideline>Strong Typing: Avoid &apos;any&apos; (TypeScript) and untyped Dict/Any (Python); aim for sound type system</guideline>
    <guideline>nestjs-query for CRUD: Use @ptc-org/nestjs-query-* for auto-generated resolvers; raw @nestjs/graphql only for custom business logic</guideline>
    <guideline>Event-Driven Communication: Inter-module communication via asynchronous events using EventEmitter2</guideline>
    <guideline>Package Managers: PNPM for Node.js, UV for Python - NPM, Yarn, and PIP are forbidden</guideline>
    <guideline>English-First: All code, comments, documentation, and commits must be in English</guideline>
    <guideline>Conventional Commits: Commit messages must follow Conventional Commits spec (feat:, fix:, docs:)</guideline>
    <guideline>Semantic Release: Automated versioning via semantic-release from commit types</guideline>
    <guideline>YAGNI Principle: Implement only what&apos;s necessary; avoid over-engineering</guideline>
    <guideline>Environment Variables: Only source for secrets and deployment config; code for defaults</guideline>
    <guideline>Testing: Backend tests via &apos;npm run test&apos;, AI Engine via &apos;uv run pytest&apos;</guideline>
  </development_guidelines>

  <implementation_roadmap>
    <phase>
      <name>Phase 1: Setup (Monorepo Infrastructure)</name>
      <status>completed</status>
      <description>Turborepo monorepo structure with apps/web, apps/backend, apps/ai-engine. Shared packages for UI and types. Global linting configuration (ESLint, Prettier, Ruff). Jest configured for unit, integration, and e2e tests.</description>
    </phase>
    <phase>
      <name>Phase 2: Foundational (Core Infrastructure)</name>
      <status>in_progress</status>
      <description>PostgreSQL + TypeORM setup, nestjs-query upgrade to @ptc-org packages, EventEmitter2 for events, Bull+Redis for queues, i18n structure. Auth framework needs rework from REST to GraphQL. Multiple data providers configuration pending.</description>
    </phase>
    <phase>
      <name>Phase 3: User Story 1 - AI Document Generation (MVP)</name>
      <status>in_progress</status>
      <description>LegalDocument entity and GraphQL schema (needs nestjs-query decorators), Documents module with CRUD (needs nestjs-query refactor), AI drafting graph implemented, document creation form implemented. Pending: Streaming response handler, PDF export service.</description>
    </phase>
    <phase>
      <name>Phase 4: User Story 2 - Legal Q&amp;A Assistant</name>
      <status>pending</status>
      <description>LegalQuery entity, Q&amp;A Agent with RAG, external legal search integration (SAOS, ISAP), Chat controller and interface, session mode toggle (Pro/Simple).</description>
    </phase>
    <phase>
      <name>Phase 5: User Story 3 - Case Law Search</name>
      <status>pending</status>
      <description>LegalRuling entity, search service with external integration, search page UI, ruling detail view.</description>
    </phase>
    <phase>
      <name>Phase 6: User Story 4 - Legal Grounds Identification</name>
      <status>pending</status>
      <description>Classifier AI agent, &apos;Analyze Case&apos; flow, legal basis suggestions display.</description>
    </phase>
    <phase>
      <name>Phase 7: Polish &amp; Cross-Cutting Concerns</name>
      <status>pending</status>
      <description>Legal disclaimers (modal + footer), Polish AI prompts verification, security hardening (input validation, rate limiting), documentation updates, audit logging with Refine AuditLogProvider.</description>
    </phase>
  </implementation_roadmap>
</project_specification>