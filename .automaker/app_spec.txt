<?xml version="1.0" encoding="UTF-8"?>
<project_specification>
  <project_name>Legal AI Platform</project_name>

  <overview>
    A comprehensive AI-powered legal assistance platform designed to help lawyers and regular users with legal document generation, legal Q&amp;A with citations, case law search, and legal grounds identification. Built following Domain-Driven Design principles with a Modular Monolith architecture, the platform uses AI agents powered by LangGraph and PydanticAI to draft precise, professional legal documents in Polish. The system emphasizes strong typing, code-first API schemas, event-driven inter-module communication, and strict architectural boundaries. Targeting the Polish legal market, it supports multi-language interfaces with Polish-language AI prompts for authentic legal terminology.
  </overview>

  <technology_stack>
    <technology>Turborepo - Monorepo orchestration</technology>
    <technology>PNPM - Node.js package management</technology>
    <technology>UV - Python package management</technology>
    <technology>Next.js 15 - Frontend framework with React 19</technology>
    <technology>Refine.dev - Data framework for admin/CRUD operations</technology>
    <technology>Tailwind CSS - Utility-first styling</technology>
    <technology>shadcn/ui - UI component library</technology>
    <technology>next-intl - Internationalization (i18n) support</technology>
    <technology>NestJS 11 - Backend framework</technology>
    <technology>GraphQL with Apollo Server - Primary API layer</technology>
    <technology>@ptc-org/nestjs-query - Auto-generated CRUD resolvers</technology>
    <technology>TypeORM - Database ORM</technology>
    <technology>PostgreSQL - Primary database</technology>
    <technology>Passport.js + JWT - Authentication</technology>
    <technology>EventEmitter2 - Event-driven module communication</technology>
    <technology>Bull + Redis - Asynchronous job queues</technology>
    <technology>Python 3.11+ - AI Engine runtime</technology>
    <technology>FastAPI - AI service HTTP framework</technology>
    <technology>PydanticAI - Structured AI responses</technology>
    <technology>LangGraph - Agent orchestration workflows</technology>
    <technology>OpenAI API - LLM provider</technology>
    <technology>Pydantic Settings - Configuration management</technology>
    <technology>Ruff - Python linting</technology>
    <technology>ESLint + Prettier - TypeScript/JavaScript linting</technology>
    <technology>Jest - Backend testing</technology>
    <technology>pytest - AI Engine testing</technology>
  </technology_stack>

  <core_capabilities>
    <capability>AI-powered legal document generation from natural language descriptions</capability>
    <capability>Drafting complaints, lawsuits, and other legal pleadings in Polish</capability>
    <capability>Legal Q&amp;A assistant with RAG (Retrieval Augmented Generation) and citations</capability>
    <capability>Case law and court ruling search functionality</capability>
    <capability>Legal grounds identification from situation descriptions</capability>
    <capability>Multi-language UI support (English, German, Polish)</capability>
    <capability>Event-driven modular backend architecture</capability>
    <capability>GraphQL-first frontend-backend communication</capability>
    <capability>REST-based Backend-AI Engine service communication</capability>
    <capability>Asynchronous document generation with status tracking</capability>
    <capability>User session management and authentication</capability>
    <capability>PDF document export (planned)</capability>
  </core_capabilities>

  <implemented_features>
    <feature>
      <name>Turborepo Monorepo Structure</name>
      <description>Complete monorepo setup with apps/web, apps/backend, apps/ai-engine directories and shared packages for UI components and types</description>
      <file_locations>
        <location>package.json</location>
        <location>turbo.json</location>
        <location>packages/ui/</location>
        <location>packages/types/</location>
      </file_locations>
    </feature>
    <feature>
      <name>Next.js Frontend with Refine</name>
      <description>Frontend application with Next.js 15, React 19, Refine.dev data framework, Tailwind CSS styling, and shadcn/ui components. Includes routing, layout system, and theme support</description>
      <file_locations>
        <location>apps/web/src/app/</location>
        <location>apps/web/src/providers/</location>
        <location>apps/web/src/components/</location>
      </file_locations>
    </feature>
    <feature>
      <name>NestJS Modular Monolith Backend</name>
      <description>Backend with NestJS featuring GraphQL API (Apollo Server), TypeORM database integration, modular architecture with Users, Documents, and Auth modules</description>
      <file_locations>
        <location>apps/backend/src/app.module.ts</location>
        <location>apps/backend/src/modules/</location>
      </file_locations>
    </feature>
    <feature>
      <name>GraphQL Data Provider</name>
      <description>Custom GraphQL data provider for Refine frontend connecting to NestJS backend with queries and mutations for document operations</description>
      <file_locations>
        <location>apps/web/src/providers/data-provider/index.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>LegalDocument Entity and GraphQL Schema</name>
      <description>Complete legal document domain model with TypeORM entity, GraphQL types, enums (LAWSUIT, COMPLAINT, CONTRACT, OTHER), status tracking (DRAFT, GENERATING, COMPLETED, FAILED), and metadata support</description>
      <file_locations>
        <location>apps/backend/src/modules/documents/entities/legal-document.entity.ts</location>
        <location>apps/backend/src/modules/documents/dto/document.types.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Documents GraphQL Resolver</name>
      <description>GraphQL resolver with queries (documents, document, documentsBySession) and mutations (generateDocument, updateDocument, deleteDocument) for document operations</description>
      <file_locations>
        <location>apps/backend/src/modules/documents/documents.resolver.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Document Generation Form</name>
      <description>React form component for creating legal documents with title, type selection, and metadata fields (plaintiff/defendant names, claim amount, currency)</description>
      <file_locations>
        <location>apps/web/src/app/documents/create/page.tsx</location>
      </file_locations>
    </feature>
    <feature>
      <name>User and Session Entities</name>
      <description>User entity with email, profile fields, disclaimer acceptance tracking, and related UserSession entity for session management</description>
      <file_locations>
        <location>apps/backend/src/modules/users/entities/user.entity.ts</location>
        <location>apps/backend/src/modules/users/entities/user-session.entity.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Event-Driven Architecture Foundation</name>
      <description>EventEmitter2 integration with base event classes, naming conventions (domain.entity.action), and example event implementations for inter-module communication</description>
      <file_locations>
        <location>apps/backend/src/shared/events/base/</location>
        <location>apps/backend/src/shared/events/examples/</location>
      </file_locations>
    </feature>
    <feature>
      <name>Bull Queue Infrastructure</name>
      <description>Redis-backed Bull queue setup with queue names for document generation, PDF export, email notifications, and AI processing tasks</description>
      <file_locations>
        <location>apps/backend/src/shared/queues/</location>
        <location>apps/backend/src/app.module.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>AI Engine FastAPI Service</name>
      <description>Python FastAPI service with REST endpoints for document generation, Q&amp;A, and ruling search. Includes OpenAPI documentation and health check</description>
      <file_locations>
        <location>apps/ai-engine/src/main.py</location>
        <location>apps/ai-engine/src/models/</location>
      </file_locations>
    </feature>
    <feature>
      <name>LangGraph Drafting Workflow</name>
      <description>LangGraph StateGraph implementation for document drafting with typed state, generate_draft_node, and async execution</description>
      <file_locations>
        <location>apps/ai-engine/src/graphs/drafting_graph.py</location>
      </file_locations>
    </feature>
    <feature>
      <name>PydanticAI Drafting Agent</name>
      <description>PydanticAI agent configured as expert Polish lawyer (Radca Prawny) for drafting legal documents with structured output (DraftResult model)</description>
      <file_locations>
        <location>apps/ai-engine/src/agents/drafting_agent.py</location>
      </file_locations>
    </feature>
    <feature>
      <name>AI Client Service</name>
      <description>NestJS service for Backend-AI Engine communication via REST with typed methods for document generation, Q&amp;A, and ruling search</description>
      <file_locations>
        <location>apps/backend/src/shared/ai-client/ai-client.service.ts</location>
        <location>apps/backend/src/shared/ai-client/ai-client.types.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Internationalization (i18n) Structure</name>
      <description>next-intl configuration with support for English, German, and Polish locales, locale switching, and translation integration with Refine i18nProvider</description>
      <file_locations>
        <location>apps/web/src/i18n/config.ts</location>
        <location>apps/web/src/i18n/index.ts</location>
        <location>apps/web/src/app/_refine_context.tsx</location>
      </file_locations>
    </feature>
    <feature>
      <name>Authentication Module (Partial)</name>
      <description>Basic auth module with Passport.js, JWT strategy, and REST controller. Note: Requires rework to GraphQL mutations per constitution</description>
      <file_locations>
        <location>apps/backend/src/modules/auth/auth.module.ts</location>
        <location>apps/backend/src/modules/auth/jwt.strategy.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Mock Auth Provider</name>
      <description>Client-side mock authentication provider for development with cookie-based session storage</description>
      <file_locations>
        <location>apps/web/src/providers/auth-provider/auth-provider.client.ts</location>
      </file_locations>
    </feature>
    <feature>
      <name>Document Completion Email Notification</name>
      <description>Send email notification when document generation completes successfully. Include document title, download link, and next steps.</description>
    </feature>
    <feature>
      <name>Domain Events Infrastructure</name>
      <description>Implement domain event system for inter-aggregate communication. Create event bus, event handlers, and integrate with message queue for async processing and eventual consistency.</description>
    </feature>
    <feature>
      <name>Classifier FastAPI Endpoint</name>
      <description>Add POST /api/v1/classify endpoint to AI Engine. Accept case description text, return array of identified legal grounds with articles and confidence.</description>
    </feature>
    <feature>
      <name>Legal Grounds Classifier Agent</name>
      <description>Create PydanticAI agent to analyze case descriptions and identify applicable legal grounds. Return structured classification with confidence scores.</description>
    </feature>
    <feature>
      <name>Analyze Case Page</name>
      <description>Create page for case analysis with textarea for description input. Display identified legal grounds as cards with article references and explanations.</description>
    </feature>
    <feature>
      <name>Classifier Backend Integration</name>
      <description>Extend AI Client Service with classifyCase method. Create GraphQL mutation for case analysis and store results in new LegalAnalysis entity.</description>
    </feature>
    <feature>
      <name>RAG Vector Store Setup</name>
      <description>Implement vector database (Pinecone, Weaviate, or pgvector) for storing legal document embeddings. Set up indexing pipeline for Polish legal texts.</description>
    </feature>
    <feature>
      <name>RAG Retrieval Logic</name>
      <description>Implement semantic search over vector store to retrieve relevant legal context. Integrate retrieval results into Q&amp;A agent prompts for grounded responses.</description>
    </feature>
    <feature>
      <name>Q&amp;A LangGraph Workflow</name>
      <description>Create LangGraph StateGraph for Q&amp;A flow with nodes for query analysis, context retrieval, answer generation, and citation formatting. Please take some ideas from a langchain graph in Flowise.ai</description>
    </feature>
    <feature>
      <name>Configure Husky for Git Hooks</name>
      <description>Install and configure Husky to manage Git hooks automatically. Set up .husky directory structure and initialize git hooks in the repository. Enable automatic hook execution on git operations.</description>
    </feature>
    <feature>
      <name>Configure lint-staged for File Filtering</name>
      <description>Install and configure lint-staged to run commands only on staged files. Set up configuration to match TypeScript, JavaScript, and Python files. Prevents running linters on the entire codebase unnecessarily.</description>
    </feature>
    <feature>
      <name>Commit Message Conventional Commits Validation</name>
      <description>Add commit-msg Git hook to validate commit messages follow Conventional Commits specification. Use commitlint to enforce format (feat:, fix:, docs:, etc.). Block non-compliant commit messages.</description>
    </feature>
    <feature>
      <name>Q&amp;A FastAPI Endpoint</name>
      <description>Add POST /api/v1/qa endpoint to AI Engine. Accept question text, return structured response with answer and citation array.</description>
    </feature>
    <feature>
      <name>Fix Pagination Implementation Across All List Views</name>
      <description>Investigate and fix pagination issues in Refine-based list views. Verify pagination is working correctly for audit logs, documents, legal queries, and other resources. Ensure nestjs-query resolvers are properly configured with paging options and frontend is correctly passing cursor/pagination parameters.</description>
    </feature>
    <feature>
      <name>Pre-commit Type Check Hook</name>
      <description>Create pre-commit Git hook that runs TypeScript type checking (tsc --noEmit) for backend and frontend. Block commits if type errors are detected. Ensures type safety before code enters the repository.</description>
    </feature>
    <feature>
      <name>Pre-commit Lint Hook</name>
      <description>Create pre-commit Git hook that runs ESLint for TypeScript/JavaScript files and Ruff/Black for Python files. Block commits if linting errors are found. Configure lint-staged to run appropriate linters based on file extensions.</description>
    </feature>
    <feature>
      <name>Q&amp;A Backend Integration</name>
      <description>Extend AI Client Service with askQuestion method. Implement GraphQL mutation in backend to trigger Q&amp;A workflow and store results.</description>
    </feature>
    <feature>
      <name>Optimize Docker layer caching with reordered Dockerfile instructions</name>
      <description>Optimize Dockerfiles for Layer Caching

Restructure Dockerfile COPY instructions to maximize Docker layer cache efficiency by separating dependency installation from source code changes.

Technical Implementation:
- Reorder Dockerfile instructions to copy dependency manifests first (package.json, requirements.txt, go.mod, Gemfile, etc.)
- Run dependency installation commands (npm install, pip install, go mod download, bundle install)
- Copy remaining application source code last
- Ensure .dockerignore excludes build artifacts, node_modules, and development files

Pattern to Apply:
```
# Before: Cache-busting pattern
COPY . /app
RUN npm install

# After: Cache-optimized pattern
COPY package*.json /app/
RUN npm install
COPY . /app/
```

Files to Modify:
- All Dockerfiles in repository (./Dockerfile, services/*/Dockerfile, etc.)
- Update .dockerignore if missing (exclude node_modules, .git, dist/, build/, __pycache__)

Language-Specific Considerations:
- Node.js: Copy package.json + package-lock.json before npm ci/install
- Python: Copy requirements.txt/Pipfile before pip install
- Go: Copy go.mod + go.sum before go mod download
- Java/Maven: Copy pom.xml before mvn dependency:resolve
- Ruby: Copy Gemfile + Gemfile.lock before bundle install

Additional Optimizations:
- Use multi-stage builds to separate build dependencies from runtime
- Combine RUN commands to reduce layers where appropriate
- Consider BuildKit cache mounts for further optimization
- Add --no-cache flags for production builds in CI/CD

Validation:
- Test builds with and without cache to verify layer reuse
- Measure build time improvement (expect 50-90% reduction on cached builds)
- Ensure application functionality unchanged after restructuring</description>
    </feature>
    <feature>
      <name>Chat Interface Component</name>
      <description>Create chat UI component with message history, input field, and streaming support. Display user questions and AI responses with citations.</description>
    </feature>
    <feature>
      <name>Ruling Search Service</name>
      <description>Create search service aggregating results from SAOS, ISAP, and local database. Implement ranking algorithm prioritizing relevance and recency.</description>
    </feature>
    <feature>
      <name>Ruling Search GraphQL Query</name>
      <description>Implement custom GraphQL query for searching rulings with filters for date range, court type, and keywords. Return paginated results with highlights.</description>
    </feature>
    <feature>
      <name>Legal Q&amp;A Chat Page</name>
      <description>Implement dedicated Q&amp;A page with chat interface. Include session management, conversation history, and mode toggle for Pro/Simple chat modes.</description>
    </feature>
    <feature>
      <name>Ruling Detail Page</name>
      <description>Implement detail view for individual court rulings. Display full text, metadata, related rulings, and export options.</description>
    </feature>
    <feature>
      <name>Verify GraphQL Pagination Arguments</name>
      <description>Verify all nestjs-query resolvers have proper paging argument types configured. Check that @OffsetPaging or @CursorPaging decorators are applied correctly. Ensure GraphQL schema includes paging fields (forward, backward, limit, offset). Test pagination queries for each entity type.</description>
    </feature>
    <feature>
      <name>Case Law Search Page</name>
      <description>Create search page with advanced filters and result list. Include search input, filter sidebar, and result cards with ruling summaries.</description>
    </feature>
    <feature>
      <name>Verify Refine Paginator Configuration</name>
      <description>Check that Refine data provider is correctly mapping pagination parameters to GraphQL queries. Verify useTable hook pagination mode matches backend implementation (offset vs cursor). Ensure pagination metadata (total, pageCount) is being properly extracted from GraphQL responses.</description>
    </feature>
    <feature>
      <name>Citation Rendering Component</name>
      <description>Create component to display legal citations with proper formatting. Support links to source documents and hover previews of cited text.</description>
    </feature>
    <feature>
      <name>Error Tracking Integration</name>
      <description>Integrate Sentry or similar error tracking service. Capture exceptions from frontend, backend, and AI engine with context.</description>
    </feature>
    <feature>
      <name>Shared Kernel Package</name>
      <description>Create shared kernel package in monorepo containing common value objects, base classes, interfaces, and utilities used across bounded contexts. Minimize sharing to maintain context independence.</description>
    </feature>
    <feature>
      <name>Update Mock Credentials Configuration</name>
      <description>Synchronize mock credentials between frontend and backend. Either update auth.service.ts to accept admin@refine.dev/123456 or update frontend login-content.tsx to use admin/password. Ensure consistency for demo/development authentication.</description>
    </feature>
    <feature>
      <name>Complete German Translations</name>
      <description>Add comprehensive German translations for all UI strings. Support German-speaking users accessing the platform.</description>
    </feature>
    <feature>
      <name>Anti-Corruption Layer for External APIs</name>
      <description>Implement anti-corruption layers for external integrations (SAOS, ISAP, AI Engine). Translate external models to domain models and isolate domain from external API changes.</description>
    </feature>
    <feature>
      <name>ISAP API Integration</name>
      <description>Implement integration with ISAP (Internetowy System Akt√≥w Prawnych) for legal act search. Create service layer for fetching Polish legislation.</description>
    </feature>
    <feature>
      <name>Health Check Endpoints</name>
      <description>Implement comprehensive health check endpoints for all services. Check database connectivity, Redis, AI Engine, and external APIs.</description>
    </feature>
    <feature>
      <name>Legal Grounds Suggestion Component</name>
      <description>Create reusable component displaying suggested legal grounds with confidence indicators. Support inline usage in document creation form.</description>
    </feature>
    <feature>
      <name>Structured Logging Infrastructure</name>
      <description>Implement structured logging with Winston or Pino. Use consistent log format with correlation IDs across services.</description>
    </feature>
    <feature>
      <name>Notification Entity</name>
      <description>Create Notification entity for in-app notifications. Store notification type, message, read status, action link, and timestamp.</description>
    </feature>
    <feature>
      <name>Locale Switcher Component</name>
      <description>Create dropdown component for switching between English, Polish, and German. Store preference in user settings and URL param.</description>
    </feature>
    <feature>
      <name>Notification Service</name>
      <description>Implement service for creating and managing notifications. Support different notification types with templates and delivery rules.</description>
    </feature>
    <feature>
      <name>Application Monitoring</name>
      <description>Set up APM monitoring with Datadog or New Relic. Track request latency, database queries, and AI API performance.</description>
    </feature>
    <feature>
      <name>Notification GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to Notification entity. Implement subscription for real-time notifications and mutation to mark as read.</description>
    </feature>
    <feature>
      <name>Notification Bell Component</name>
      <description>Create notification bell icon in header with unread count badge. Show dropdown with recent notifications on click.</description>
    </feature>
    <feature>
      <name>PDF Export Queue Processor</name>
      <description>Create Bull queue consumer for asynchronous PDF generation. Handle large documents, template rendering, and file storage integration.</description>
    </feature>
    <feature>
      <name>PDF Download GraphQL Field</name>
      <description>Add pdfUrl field to LegalDocument GraphQL type. Implement resolver that triggers PDF generation if needed and returns signed download URL.</description>
    </feature>
    <feature>
      <name>Pre-commit Format Check</name>
      <description>Create pre-commit hook to verify code formatting using Prettier for TypeScript/JavaScript and Black for Python. Either block commits on formatting issues or auto-format files using lint-staged --autofix capability.</description>
    </feature>
    <feature>
      <name>Document Permission Guards</name>
      <description>Implement NestJS guards checking document access permissions on all resolvers. Enforce read/write access control based on user roles.</description>
    </feature>
    <feature>
      <name>Ruling Indexing Background Job</name>
      <description>Create Bull queue processor for periodically fetching and indexing new rulings from external sources. Schedule daily sync jobs.</description>
    </feature>
    <feature>
      <name>Global Search Bar</name>
      <description>Create omnisearch component in header with autocomplete. Show mixed results from documents, rulings, and templates with type indicators.</description>
    </feature>
    <feature>
      <name>Global Search Service</name>
      <description>Implement full-text search across documents, rulings, and queries using PostgreSQL full-text search or Elasticsearch. Support fuzzy matching and ranking.</description>
    </feature>
    <feature>
      <name>Share Document Dialog</name>
      <description>Create modal for sharing documents with user selection, role assignment, and link generation. Display list of current collaborators.</description>
    </feature>
    <feature>
      <name>Document Template Entity</name>
      <description>Create DocumentTemplate entity for storing reusable templates. Include template name, type, content with variables, and metadata schema.</description>
    </feature>
    <feature>
      <name>Template GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to DocumentTemplate entity. Implement custom mutations for template rendering with variable substitution.</description>
    </feature>
    <feature>
      <name>Template Library Page</name>
      <description>Create page displaying available document templates. Support filtering by type, preview, and &apos;Use Template&apos; action to start document creation.</description>
    </feature>
    <feature>
      <name>Usage Tracking Service</name>
      <description>Implement service tracking AI API usage per user. Store token counts, request counts, and costs for billing purposes.</description>
    </feature>
    <feature>
      <name>Usage Records Entity</name>
      <description>Create UsageRecord entity storing per-request AI usage. Include user ID, operation type, tokens used, cost, and timestamp.</description>
    </feature>
    <feature>
      <name>Usage Quota Enforcement</name>
      <description>Implement quota checking before AI operations. Block requests exceeding user&apos;s plan limits with clear error messages.</description>
    </feature>
    <feature>
      <name>User Preferences Entity</name>
      <description>Create UserPreferences entity for storing user settings. Include notification preferences, default locale, theme preference, and AI model selection.</description>
    </feature>
    <feature>
      <name>User Settings Page</name>
      <description>Create settings page with tabs for profile, preferences, security, and notifications. Support updating email, password, and all preference fields.</description>
    </feature>
    <feature>
      <name>User Preferences GraphQL Resolvers</name>
      <description>Add nestjs-query decorators to UserPreferences entity. Implement mutations for updating preferences.</description>
    </feature>
    <feature>
      <name>Admin Panel Layout</name>
      <description>Create separate admin area with navigation and role-based access. Use Refine admin templates for CRUD operations.</description>
    </feature>
    <feature>
      <name>Analytics Dashboard</name>
      <description>Create admin dashboard with platform analytics. Show user growth, document generation metrics, and system health indicators.</description>
    </feature>
    <feature>
      <name>API Keys Entity</name>
      <description>Create ApiKey entity for programmatic access. Store hashed keys, scopes, rate limits, and expiration dates.</description>
    </feature>
    <feature>
      <name>Advanced Search Page</name>
      <description>Create dedicated search page with advanced filters. Support boolean operators, date ranges, document type filters, and field-specific search.</description>
    </feature>
    <feature>
      <name>API Key Authentication</name>
      <description>Implement API key authentication strategy for GraphQL API. Support both JWT and API key auth methods.</description>
    </feature>
    <feature>
      <name>Database Backup Strategy</name>
      <description>Implement automated database backup with point-in-time recovery. Store backups in secure cloud storage with retention policy.</description>
    </feature>
    <feature>
      <name>API Key Management Interface</name>
      <description>Create settings page section for managing API keys. Support creating, revoking, and viewing key usage statistics.</description>
    </feature>
    <feature>
      <name>Document Collaboration System</name>
      <description>Implement real-time collaborative editing using WebSockets or CRDTs. Support multiple users editing documents simultaneously with conflict resolution.</description>
    </feature>
    <feature>
      <name>Document Comments Entity</name>
      <description>Create DocumentComment entity for inline document feedback. Store comment text, position/anchor, author, timestamp, and resolution status.</description>
    </feature>
    <feature>
      <name>Disaster Recovery Procedures</name>
      <description>Document and test disaster recovery procedures. Include database restoration, service failover, and data integrity verification.</description>
    </feature>
    <feature>
      <name>Comment System UI</name>
      <description>Create commenting interface with inline annotations. Display comment threads, reply chains, and resolve/unresolve actions.</description>
    </feature>
    <feature>
      <name>Notification Center Page</name>
      <description>Create dedicated page showing all notifications with filtering. Support bulk mark as read and notification preferences.</description>
    </feature>
    <feature>
      <name>Document Moderation Interface</name>
      <description>Create admin interface for reviewing flagged documents. Support approval, rejection, and user notification workflows.</description>
    </feature>
    <feature>
      <name>Subscription Plans Entity</name>
      <description>Create SubscriptionPlan and UserSubscription entities. Define plan tiers with feature flags, quotas, and pricing.</description>
    </feature>
    <feature>
      <name>Subscription Management Service</name>
      <description>Implement service for managing user subscriptions. Handle plan upgrades, downgrades, and feature access control.</description>
    </feature>
    <feature>
      <name>Payment Gateway Integration</name>
      <description>Integrate Stripe or similar payment provider. Handle subscription payments, webhooks, and invoice generation.</description>
    </feature>
    <feature>
      <name>Billing and Subscription Page</name>
      <description>Create page for viewing subscription status and payment history. Support plan changes and payment method updates.</description>
    </feature>
    <feature>
      <name>System Settings Admin Panel</name>
      <description>Create interface for configuring system-wide settings. Include AI model selection, feature flags, and maintenance mode.</description>
    </feature>
    <feature>
      <name>Template Editor Interface</name>
      <description>Create admin interface for creating and editing templates. Include rich text editor with variable insertion and preview mode.</description>
    </feature>
    <feature>
      <name>Usage Dashboard</name>
      <description>Create page showing user&apos;s AI usage statistics. Display charts for daily usage, remaining quota, and cost breakdown.</description>
    </feature>
    <feature>
      <name>Admin User Management</name>
      <description>Create admin interface for managing users. Support viewing, editing, suspending accounts, and resetting passwords.</description>
    </feature>
    <feature>
      <name>Webhook Delivery Queue</name>
      <description>Create Bull queue processor for delivering webhooks with retry logic. Log delivery attempts and handle failures gracefully.</description>
    </feature>
    <feature>
      <name>Webhook Configuration Entity</name>
      <description>Create WebhookConfig entity storing endpoint URLs, event subscriptions, authentication headers, and status.</description>
    </feature>
    <feature>
      <name>Webhook System</name>
      <description>Implement webhook delivery system for external integrations. Support subscribing to events like document.completed and query.answered.</description>
    </feature>
  </implemented_features>

  <additional_requirements>
    <requirement>PostgreSQL database required for persistence</requirement>
    <requirement>Redis required for Bull queue job processing</requirement>
    <requirement>OpenAI API key required for AI document generation</requirement>
    <requirement>Node.js &gt;= 18 for backend and frontend</requirement>
    <requirement>Python &gt;= 3.11 for AI Engine</requirement>
    <requirement>Environment variables: DB_HOST, DB_PORT, DB_USERNAME, DB_PASSWORD, DB_DATABASE, JWT_SECRET, AI_ENGINE_URL, OPENAI_API_KEY, OPENAI_MODEL, REDIS_HOST, REDIS_PORT</requirement>
    <requirement>Architecture tests in CI to enforce module boundaries</requirement>
    <requirement>All features require legal disclaimer acceptance before use</requirement>
    <requirement>AI prompts must generate documents in Polish legal terminology</requirement>
    <requirement>Frontend must support Polish language localization for end users</requirement>
  </additional_requirements>

  <development_guidelines>
    <guideline>Domain-Driven Design (DDD): Software model must deeply reflect the legal business domain with clear aggregate roots and invariants</guideline>
    <guideline>Modular Monolith: Strict module boundaries - no direct imports between module domains; use events for inter-module communication</guideline>
    <guideline>GraphQL-Only Frontend API: All frontend-backend communication must use GraphQL; REST endpoints for frontend are forbidden</guideline>
    <guideline>REST for Service Communication: Backend-AI Engine uses REST with auto-generated OpenAPI clients</guideline>
    <guideline>Code-First Schema: API schemas (GraphQL, OpenAPI) must be generated from code definitions; manual schema files forbidden</guideline>
    <guideline>Strong Typing: Avoid &apos;any&apos; (TypeScript) and untyped Dict/Any (Python); aim for sound type system</guideline>
    <guideline>nestjs-query for CRUD: Use @ptc-org/nestjs-query-* for auto-generated resolvers; raw @nestjs/graphql only for custom business logic</guideline>
    <guideline>Event-Driven Communication: Inter-module communication via asynchronous events using EventEmitter2</guideline>
    <guideline>Package Managers: PNPM for Node.js, UV for Python - NPM, Yarn, and PIP are forbidden</guideline>
    <guideline>English-First: All code, comments, documentation, and commits must be in English</guideline>
    <guideline>Conventional Commits: Commit messages must follow Conventional Commits spec (feat:, fix:, docs:)</guideline>
    <guideline>Semantic Release: Automated versioning via semantic-release from commit types</guideline>
    <guideline>YAGNI Principle: Implement only what&apos;s necessary; avoid over-engineering</guideline>
    <guideline>Environment Variables: Only source for secrets and deployment config; code for defaults</guideline>
    <guideline>Testing: Backend tests via &apos;npm run test&apos;, AI Engine via &apos;uv run pytest&apos;</guideline>
  </development_guidelines>

  <implementation_roadmap>
    <phase>
      <name>Phase 1: Setup (Monorepo Infrastructure)</name>
      <status>completed</status>
      <description>Turborepo monorepo structure with apps/web, apps/backend, apps/ai-engine. Shared packages for UI and types. Global linting configuration (ESLint, Prettier, Ruff). Jest configured for unit, integration, and e2e tests.</description>
    </phase>
    <phase>
      <name>Phase 2: Foundational (Core Infrastructure)</name>
      <status>in_progress</status>
      <description>PostgreSQL + TypeORM setup, nestjs-query upgrade to @ptc-org packages, EventEmitter2 for events, Bull+Redis for queues, i18n structure. Auth framework needs rework from REST to GraphQL. Multiple data providers configuration pending.</description>
    </phase>
    <phase>
      <name>Phase 3: User Story 1 - AI Document Generation (MVP)</name>
      <status>in_progress</status>
      <description>LegalDocument entity and GraphQL schema (needs nestjs-query decorators), Documents module with CRUD (needs nestjs-query refactor), AI drafting graph implemented, document creation form implemented. Pending: Streaming response handler, PDF export service.</description>
    </phase>
    <phase>
      <name>Phase 4: User Story 2 - Legal Q&amp;A Assistant</name>
      <status>pending</status>
      <description>LegalQuery entity, Q&amp;A Agent with RAG, external legal search integration (SAOS, ISAP), Chat controller and interface, session mode toggle (Pro/Simple).</description>
    </phase>
    <phase>
      <name>Phase 5: User Story 3 - Case Law Search</name>
      <status>pending</status>
      <description>LegalRuling entity, search service with external integration, search page UI, ruling detail view.</description>
    </phase>
    <phase>
      <name>Phase 6: User Story 4 - Legal Grounds Identification</name>
      <status>pending</status>
      <description>Classifier AI agent, &apos;Analyze Case&apos; flow, legal basis suggestions display.</description>
    </phase>
    <phase>
      <name>Phase 7: Polish &amp; Cross-Cutting Concerns</name>
      <status>pending</status>
      <description>Legal disclaimers (modal + footer), Polish AI prompts verification, security hardening (input validation, rate limiting), documentation updates, audit logging with Refine AuditLogProvider.</description>
    </phase>
  </implementation_roadmap>
</project_specification>