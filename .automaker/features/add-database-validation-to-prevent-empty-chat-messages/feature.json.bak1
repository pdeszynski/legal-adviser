{
  "category": "bug",
  "description": "Add database-level constraints and backend validation to prevent ChatMessage records with empty content from being saved. Implementation: 1) Update ChatMessage entity to make content field NOT NULL in database schema, 2) Add CHECK constraint to ensure content is not empty string (ALTER TABLE chat_messages ADD CONSTRAINT check_content_not_empty CHECK (LENGTH(TRIM(content)) > 0)), 3) Add @IsNotEmpty() validation decorator to content field in ChatMessage DTO, 4) Add validation in QueriesService before saving: if (!message.content || message.content.trim().length === 0) throw BadRequestException, 5) Add database migration script to add constraints and clean up existing empty messages, 6) For clarification messages where content might legitimately be a JSON object, store it in content field as serialized JSON string, not empty, 7) Add error handling to surface validation failures with clear error messages to frontend. This prevents empty messages from being persisted and makes the issue visible immediately when it occurs.",
  "id": "add-database-validation-to-prevent-empty-chat-messages",
  "title": "Add Database Validation to Prevent Empty Chat Messages",
  "priority": 1,
  "status": "verified",
  "branchName": "store-chat",
  "descriptionHistory": [
    {
      "description": "Add database-level constraints and backend validation to prevent ChatMessage records with empty content from being saved. Implementation: 1) Update ChatMessage entity to make content field NOT NULL in database schema, 2) Add CHECK constraint to ensure content is not empty string (ALTER TABLE chat_messages ADD CONSTRAINT check_content_not_empty CHECK (LENGTH(TRIM(content)) > 0)), 3) Add @IsNotEmpty() validation decorator to content field in ChatMessage DTO, 4) Add validation in QueriesService before saving: if (!message.content || message.content.trim().length === 0) throw BadRequestException, 5) Add database migration script to add constraints and clean up existing empty messages, 6) For clarification messages where content might legitimately be a JSON object, store it in content field as serialized JSON string, not empty, 7) Add error handling to surface validation failures with clear error messages to frontend. This prevents empty messages from being persisted and makes the issue visible immediately when it occurs.",
      "timestamp": "2026-01-28T15:32:05.547Z",
      "source": "initial"
    }
  ],
  "updatedAt": "2026-01-28T15:36:48.738Z"
}