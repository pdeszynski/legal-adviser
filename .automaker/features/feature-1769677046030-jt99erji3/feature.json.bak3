{
  "category": "Uncategorized",
  "description": "Cannot start anymore ai-engine\n\nLANGFUSE-DEBUG] ============================================================\n\n╭─────────────────────────────────────────────────────────────────────────────────────────── Traceback (most recent call last) ────────────────────────────────────────────────────────────────────────────────────────────╮\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/cli.py:328 in dev                                                                                               │\n│                                                                                                                                                                                                                          │\n│   325 │                                                                                        ╭──────────────────── locals ────────────────────╮                                                                        │\n│   326 │   Otherwise, it uses the first [bold]FastAPI[/bold] app found in the imported module o │                 app = None                     │                                                                        │\n│   327 │   \"\"\"                                                                                  │          entrypoint = None                     │                                                                        │\n│ ❱ 328 │   _run(                                                                                │ forwarded_allow_ips = None                     │                                                                        │\n│   329 │   │   path=path,                                                                       │                host = '0.0.0.0'                │                                                                        │\n│   330 │   │   host=host,                                                                       │                path = PosixPath('src/main.py') │                                                                        │\n│   331 │   │   port=port,                                                                       │                port = 8000                     │                                                                        │\n│                                                                                                │       proxy_headers = True                     │                                                                        │\n│                                                                                                │              reload = True                     │                                                                        │\n│                                                                                                │          reload_dir = None                     │                                                                        │\n│                                                                                                │           root_path = ''                       │                                                                        │\n│                                                                                                ╰────────────────────────────────────────────────╯                                                                        │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/cli.py:152 in _run                                                                                              │\n│                                                                                                                                                                                                                          │\n│   149 │   │   try:                                                                             ╭──────────────────────────────────── locals ────────────────────────────────────╮                                        │\n│   150 │   │   │   # Resolve import data with priority: CLI path/app > config entrypoint > auto │                 app = None                                                     │                                        │\n│   151 │   │   │   if path or app:                                                              │             command = 'dev'                                                    │                                        │\n│ ❱ 152 │   │   │   │   import_data = get_import_data(path=path, app_name=app)                   │              config = FastAPIConfig(entrypoint=None)                           │                                        │\n│   153 │   │   │   elif config.entrypoint:                                                      │          entrypoint = None                                                     │                                        │\n│   154 │   │   │   │   import_data = get_import_data_from_import_string(config.entrypoint)      │ forwarded_allow_ips = None                                                     │                                        │\n│   155 │   │   │   else:                                                                        │                host = '0.0.0.0'                                                │                                        │\n│                                                                                                │                path = PosixPath('src/main.py')                                 │                                        │\n│                                                                                                │                port = 8000                                                     │                                        │\n│                                                                                                │       proxy_headers = True                                                     │                                        │\n│                                                                                                │              reload = True                                                     │                                        │\n│                                                                                                │         reload_dirs = None                                                     │                                        │\n│                                                                                                │           root_path = ''                                                       │                                        │\n│                                                                                                │         server_type = 'development'                                            │                                        │\n│                                                                                                │             toolkit = <rich_toolkit.toolkit.RichToolkit object at 0x109196a50> │                                        │\n│                                                                                                │             workers = None                                                     │                                        │\n│                                                                                                ╰────────────────────────────────────────────────────────────────────────────────╯                                        │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/discover.py:126 in get_import_data                                                                              │\n│                                                                                                                                                                                                                          │\n│   123 │   │   raise FastAPICLIException(f\"Path does not exist {path}\")                                                                                                                                                   │\n│   124 │   mod_data = get_module_data_from_path(path)                                                                                                                                                                     │\n│   125 │   sys.path.insert(0, str(mod_data.extra_sys_path))                                                                                                                                                               │\n│ ❱ 126 │   use_app_name = get_app_name(mod_data=mod_data, app_name=app_name)                                                                                                                                              │\n│   127 │                                                                                                                                                                                                                  │\n│   128 │   import_string = f\"{mod_data.module_import_str}:{use_app_name}\"                                                                                                                                                 │\n│   129                                                                                                                                                                                                                    │\n│                                                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────╮                         │\n│ │ app_name = None                                                                                                                                                                              │                         │\n│ │ mod_data = ModuleData(                                                                                                                                                                       │                         │\n│ │            │   module_import_str='src.main',                                                                                                                                                 │                         │\n│ │            │   extra_sys_path=PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine'),                                                                                        │                         │\n│ │            │   module_paths=[                                                                                                                                                                │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src'),                                                                                               │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py')                                                                                        │                         │\n│ │            │   ]                                                                                                                                                                             │                         │\n│ │            )                                                                                                                                                                                 │                         │\n│ │     path = PosixPath('src/main.py')                                                                                                                                                          │                         │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                         │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/discover.py:70 in get_app_name                                                                                  │\n│                                                                                                                                                                                                                          │\n│    67                                                                                                                                                                                                                    │\n│    68 def get_app_name(*, mod_data: ModuleData, app_name: Union[str, None] = None) -> str:                                                                                                                               │\n│    69 │   try:                                                                                                                                                                                                           │\n│ ❱  70 │   │   mod = importlib.import_module(mod_data.module_import_str)                                                                                                                                                  │\n│    71 │   except (ImportError, ValueError) as e:                                                                                                                                                                         │\n│    72 │   │   logger.error(f\"Import error: {e}\")                                                                                                                                                                         │\n│    73 │   │   logger.warning(                                                                                                                                                                                            │\n│                                                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────╮                         │\n│ │ app_name = None                                                                                                                                                                              │                         │\n│ │ mod_data = ModuleData(                                                                                                                                                                       │                         │\n│ │            │   module_import_str='src.main',                                                                                                                                                 │                         │\n│ │            │   extra_sys_path=PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine'),                                                                                        │                         │\n│ │            │   module_paths=[                                                                                                                                                                │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src'),                                                                                               │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py')                                                                                        │                         │\n│ │            │   ]                                                                                                                                                                             │                         │\n│ │            )                                                                                                                                                                                 │                         │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                         │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/importlib/__init__.py:88 in import_module                                                                                         │\n│                                                                                                                                                                                                                          │\n│    85 │   │   │   if character != '.':                                                         ╭─────── locals ───────╮                                                                                                  │\n│    86 │   │   │   │   break                                                                    │   level = 0          │                                                                                                  │\n│    87 │   │   │   level += 1                                                                   │    name = 'src.main' │                                                                                                  │\n│ ❱  88 │   return _bootstrap._gcd_import(name[level:], package, level)                          │ package = None       │                                                                                                  │\n│    89                                                                                          ╰──────────────────────╯                                                                                                  │\n│    90                                                                                                                                                                                                                    │\n│    91 _RELOADING = {}                                                                                                                                                                                                    │\n│ in _gcd_import:1387                                                                                                                                                                                                      │\n│ ╭─────── locals ───────╮                                                                                                                                                                                                 │\n│ │   level = 0          │                                                                                                                                                                                                 │\n│ │    name = 'src.main' │                                                                                                                                                                                                 │\n│ │ package = None       │                                                                                                                                                                                                 │\n│ ╰──────────────────────╯                                                                                                                                                                                                 │\n│ in _find_and_load:1360                                                                                                                                                                                                   │\n│ ╭──────────────── locals ─────────────────╮                                                                                                                                                                              │\n│ │ module = <object object at 0x100ab4050> │                                                                                                                                                                              │\n│ │   name = 'src.main'                     │                                                                                                                                                                              │\n│ ╰─────────────────────────────────────────╯                                                                                                                                                                              │\n│ in _find_and_load_unlocked:1331                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────────────────╮ │\n│ │         child = 'main'                                                                                                                                                                                               │ │\n│ │          name = 'src.main'                                                                                                                                                                                           │ │\n│ │        parent = 'src'                                                                                                                                                                                                │ │\n│ │ parent_module = <module 'src' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/__init__.py'>                                                                                                      │ │\n│ │   parent_spec = ModuleSpec(name='src', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e5850>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/__init__.py',               │ │\n│ │                 submodule_search_locations=['/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src'])                                                                                                        │ │\n│ │          path = ['/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src']                                                                                                                                    │ │\n│ │          spec = ModuleSpec(name='src.main', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py')              │ │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯ │\n│ in _load_unlocked:935                                                                                                                                                                                                    │\n│ ╭───────────────────────────────────────────────────────────────────────────────────────────── locals ─────────────────────────────────────────────────────────────────────────────────────────────╮                     │\n│ │ module = <module 'src.main' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py'>                                                                                        │                     │\n│ │   spec = ModuleSpec(name='src.main', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py') │                     │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                     │\n│ in exec_module:1023                                                                                                                                                                                                      │\n│ ╭─────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────╮                                                                                 │\n│ │   code = <code object <module> at 0xa435edc00, file \"/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py\", line 1> │                                                                                 │\n│ │ module = <module 'src.main' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py'>                            │                                                                                 │\n│ │   self = <_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>                                                         │                                                                                 │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                                                                                 │\n│ in _call_with_frames_removed:488                                                                                                                                                                                         │\n│ ╭────────────────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────────────────╮  │\n│ │ args = (                                                                                                                                                                                                            │  │\n│ │        │   <code object <module> at 0xa435edc00, file \"/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py\", line 1>,                                                                             │  │\n│ │        │   {                                                                                                                                                                                                        │  │\n│ │        │   │   '__name__': 'src.main',                                                                                                                                                                              │  │\n│ │        │   │   '__doc__': 'Legal AI Engine - FastAPI Service.\\n\\nThis service provides AI-powered legal assis'+185,                                                                                                 │  │\n│ │        │   │   '__package__': 'src',                                                                                                                                                                                │  │\n│ │        │   │   '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>,                                                                                                                   │  │\n│ │        │   │   '__spec__': ModuleSpec(name='src.main', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py'), │  │\n│ │        │   │   '__file__': '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py',                                                                                                                 │  │\n│ │        │   │   '__cached__': '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/__pycache__/main.c'+14,                                                                                                 │  │\n│ │        │   │   '__builtins__': {                                                                                                                                                                                    │  │\n│ │        │   │   │   '__name__': 'builtins',                                                                                                                                                                          │  │\n│ │        │   │   │   '__doc__': 'Built-in functions, types, exceptions, and other objects.\\n\\nThis module provides '+346,                                                                                             │  │\n│ │        │   │   │   '__package__': '',                                                                                                                                                                               │  │\n│ │        │   │   │   '__loader__': <class '_frozen_importlib.BuiltinImporter'>,                                                                                                                                       │  │\n│ │        │   │   │   '__spec__': ModuleSpec(name='builtins', loader=<class '_frozen_importlib.BuiltinImporter'>, origin='built-in'),                                                                                  │  │\n│ │        │   │   │   '__build_class__': <built-in function __build_class__>,                                                                                                                                          │  │\n│ │        │   │   │   '__import__': <built-in function __import__>,                                                                                                                                                    │  │\n│ │        │   │   │   'abs': <built-in function abs>,                                                                                                                                                                  │  │\n│ │        │   │   │   'all': <built-in function all>,                                                                                                                                                                  │  │\n│ │        │   │   │   'any': <built-in function any>,                                                                                                                                                                  │  │\n│ │        │   │   │   ... +149                                                                                                                                                                                         │  │\n│ │        │   │   },                                                                                                                                                                                                   │  │\n│ │        │   │   '__annotations__': {},                                                                                                                                                                               │  │\n│ │        │   │   'asyncio': <module 'asyncio' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/asyncio/__init__.py'>,                                                     │  │\n│ │        │   │   ... +27                                                                                                                                                                                              │  │\n│ │        │   }                                                                                                                                                                                                        │  │\n│ │        )                                                                                                                                                                                                            │  │\n│ │    f = <built-in function exec>                                                                                                                                                                                     │  │\n│ │ kwds = {}                                                                                                                                                                                                           │  │\n│ ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯  │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py:46 in <module>                                                                                                                                     │\n│                                                                                                                                                                                                                          │\n│     43 │   ValidationError,                                                                                                                                                                                              │\n│     44 )                                                                                                                                                                                                                 │\n│     45 from .langfuse_init import flush                                                                                                                                                                                  │\n│ ❱   46 from .models.requests import (                                                                                                                                                                                    │\n│     47 │   AskQuestionRequest,                                                                                                                                                                                           │\n│     48 │   ClassifyCaseRequest,                                                                                                                                                                                          │\n│     49 │   ClarificationAnswerRequest,                                                                                                                                                                                   │\n│                                                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────╮                                                 │\n│ │      _env_path = PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.env')                                                                         │                                                 │\n│ │ AsyncGenerator = typing.AsyncGenerator                                                                                                                               │                                                 │\n│ │        asyncio = <module 'asyncio' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/asyncio/__init__.py'>                │                                                 │\n│ │        logging = <module 'logging' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/logging/__init__.py'>                │                                                 │\n│ │     sentry_sdk = <module 'sentry_sdk' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/sentry_sdk/__init__.py'>    │                                                 │\n│ │         status = <module 'starlette.status' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/starlette/status.py'> │                                                 │\n│ │           time = <module 'time' (built-in)>                                                                                                                          │                                                 │\n│ │           uuid = <module 'uuid' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/uuid.py'>                               │                                                 │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                                                 │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/models/__init__.py:7 in <module>                                                                                                                           │\n│                                                                                                                                                                                                                          │\n│    4 \"\"\"                                                                                                                                                                                                                 │\n│    5                                                                                                                                                                                                                     │\n│    6 # Request models                                                                                                                                                                                                    │\n│ ❱  7 from .requests import (                                                                                                                                                                                             │\n│    8 │   AskQuestionRequest,                                                                                                                                                                                             │\n│    9 │   ClassifyCaseRequest,                                                                                                                                                                                            │\n│   10 │   ClarificationAnswer,                                                                                                                                                                                            │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/models/requests.py:106 in <module>                                                                                                                         │\n│                                                                                                                                                                                                                          │\n│   103 │   CLARIFICATION_QUESTION = \"CLARIFICATION_QUESTION\"  # Response contains clarification                                                                                                                           │\n│   104                                                                                                                                                                                                                    │\n│   105                                                                                                                                                                                                                    │\n│ ❱ 106 class AskQuestionRequest(BaseModel):                                                                                                                                                                               │\n│   107 │   \"\"\"Request to ask a legal question or submit clarification answers.                                                                                                                                            │\n│   108 │                                                                                                                                                                                                                  │\n│   109 │   This unified request model handles both:                                                                                                                                                                       │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/models/requests.py:129 in AskQuestionRequest                                                                                                               │\n│                                                                                                                                                                                                                          │\n│   126 │   │   default=None,                                                                                                                                                                                              │\n│   127 │   │   description=\"Original question that prompted clarification (required for CLARIFI                                                                                                                           │\n│   128 │   )                                                                                                                                                                                                              │\n│ ❱ 129 │   clarification_answers: list[ClarificationAnswer] | None = Field(                                                                                                                                               │\n│   130 │   │   default=None,                                                                                                                                                                                              │\n│   131 │   │   description=\"User's answers to clarification questions (required for CLARIFICATI                                                                                                                           │\n│   132 │   )                                                                                                                                                                                                              │\n│                                                                                                                                                                                                                          │\n│ ╭──────────────────────────────────────────────────────────────────────────────────────── locals ────────────────────────────────────────────────────────────────────────────────────────╮                               │\n│ │ clarification_answers = FieldInfo(annotation=NoneType, required=False, default=None, description=\"User's answers to clarification questions (required for CLARIFICATION_ANSWER)\")      │                               │\n│ │          message_type = FieldInfo(annotation=NoneType, required=False, default=<MessageType.QUESTION: 'QUESTION'>, description='Type of message: QUESTION or CLARIFICATION_ANSWER')    │                               │\n│ │                  mode = FieldInfo(annotation=NoneType, required=False, default='SIMPLE', description='Response mode: LAWYER (detailed) or SIMPLE (layperson)')                         │                               │\n│ │     original_question = FieldInfo(annotation=NoneType, required=False, default=None, description='Original question that prompted clarification (required for CLARIFICATION_ANSWER'+1) │                               │\n│ │              question = FieldInfo(annotation=NoneType, required=True, description='Legal question to answer', metadata=[MinLen(min_length=5)])                                         │                               │\n│ │            session_id = FieldInfo(annotation=NoneType, required=True, description='User session ID for tracking')                                                                      │                               │\n│ ╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                               │\n╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\nNameError: name 'ClarificationAnswer' is not defined\n ELIFECYCLE  Command failed with exit code 1.\n WARN   Local package.json exists, but node_modules missing, did you mean to install?\ncommand finished with error: command (/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine) /opt/homebrew/bin/pnpm run dev exited (1)\n└─ @legal/ai-engine#dev ──\n@legal/ai-engine#dev: command (/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine) /opt/homebrew/bin/pnpm run dev exited (1)\n",
  "title": "Fix undefined ClarificationAnswer import error",
  "images": [],
  "imagePaths": [],
  "textFilePaths": [],
  "skipTests": false,
  "model": "claude-opus",
  "thinkingLevel": "none",
  "reasoningEffort": "none",
  "branchName": "refactor-chat-messaging",
  "priority": 1,
  "planningMode": "skip",
  "requirePlanApproval": false,
  "dependencies": [],
  "workMode": "current",
  "titleGenerating": false,
  "status": "backlog",
  "id": "feature-1769677046030-jt99erji3",
  "descriptionHistory": [
    {
      "description": "Cannot start anymore ai-engine\n\nLANGFUSE-DEBUG] ============================================================\n\n╭─────────────────────────────────────────────────────────────────────────────────────────── Traceback (most recent call last) ────────────────────────────────────────────────────────────────────────────────────────────╮\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/cli.py:328 in dev                                                                                               │\n│                                                                                                                                                                                                                          │\n│   325 │                                                                                        ╭──────────────────── locals ────────────────────╮                                                                        │\n│   326 │   Otherwise, it uses the first [bold]FastAPI[/bold] app found in the imported module o │                 app = None                     │                                                                        │\n│   327 │   \"\"\"                                                                                  │          entrypoint = None                     │                                                                        │\n│ ❱ 328 │   _run(                                                                                │ forwarded_allow_ips = None                     │                                                                        │\n│   329 │   │   path=path,                                                                       │                host = '0.0.0.0'                │                                                                        │\n│   330 │   │   host=host,                                                                       │                path = PosixPath('src/main.py') │                                                                        │\n│   331 │   │   port=port,                                                                       │                port = 8000                     │                                                                        │\n│                                                                                                │       proxy_headers = True                     │                                                                        │\n│                                                                                                │              reload = True                     │                                                                        │\n│                                                                                                │          reload_dir = None                     │                                                                        │\n│                                                                                                │           root_path = ''                       │                                                                        │\n│                                                                                                ╰────────────────────────────────────────────────╯                                                                        │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/cli.py:152 in _run                                                                                              │\n│                                                                                                                                                                                                                          │\n│   149 │   │   try:                                                                             ╭──────────────────────────────────── locals ────────────────────────────────────╮                                        │\n│   150 │   │   │   # Resolve import data with priority: CLI path/app > config entrypoint > auto │                 app = None                                                     │                                        │\n│   151 │   │   │   if path or app:                                                              │             command = 'dev'                                                    │                                        │\n│ ❱ 152 │   │   │   │   import_data = get_import_data(path=path, app_name=app)                   │              config = FastAPIConfig(entrypoint=None)                           │                                        │\n│   153 │   │   │   elif config.entrypoint:                                                      │          entrypoint = None                                                     │                                        │\n│   154 │   │   │   │   import_data = get_import_data_from_import_string(config.entrypoint)      │ forwarded_allow_ips = None                                                     │                                        │\n│   155 │   │   │   else:                                                                        │                host = '0.0.0.0'                                                │                                        │\n│                                                                                                │                path = PosixPath('src/main.py')                                 │                                        │\n│                                                                                                │                port = 8000                                                     │                                        │\n│                                                                                                │       proxy_headers = True                                                     │                                        │\n│                                                                                                │              reload = True                                                     │                                        │\n│                                                                                                │         reload_dirs = None                                                     │                                        │\n│                                                                                                │           root_path = ''                                                       │                                        │\n│                                                                                                │         server_type = 'development'                                            │                                        │\n│                                                                                                │             toolkit = <rich_toolkit.toolkit.RichToolkit object at 0x109196a50> │                                        │\n│                                                                                                │             workers = None                                                     │                                        │\n│                                                                                                ╰────────────────────────────────────────────────────────────────────────────────╯                                        │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/discover.py:126 in get_import_data                                                                              │\n│                                                                                                                                                                                                                          │\n│   123 │   │   raise FastAPICLIException(f\"Path does not exist {path}\")                                                                                                                                                   │\n│   124 │   mod_data = get_module_data_from_path(path)                                                                                                                                                                     │\n│   125 │   sys.path.insert(0, str(mod_data.extra_sys_path))                                                                                                                                                               │\n│ ❱ 126 │   use_app_name = get_app_name(mod_data=mod_data, app_name=app_name)                                                                                                                                              │\n│   127 │                                                                                                                                                                                                                  │\n│   128 │   import_string = f\"{mod_data.module_import_str}:{use_app_name}\"                                                                                                                                                 │\n│   129                                                                                                                                                                                                                    │\n│                                                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────╮                         │\n│ │ app_name = None                                                                                                                                                                              │                         │\n│ │ mod_data = ModuleData(                                                                                                                                                                       │                         │\n│ │            │   module_import_str='src.main',                                                                                                                                                 │                         │\n│ │            │   extra_sys_path=PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine'),                                                                                        │                         │\n│ │            │   module_paths=[                                                                                                                                                                │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src'),                                                                                               │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py')                                                                                        │                         │\n│ │            │   ]                                                                                                                                                                             │                         │\n│ │            )                                                                                                                                                                                 │                         │\n│ │     path = PosixPath('src/main.py')                                                                                                                                                          │                         │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                         │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/fastapi_cli/discover.py:70 in get_app_name                                                                                  │\n│                                                                                                                                                                                                                          │\n│    67                                                                                                                                                                                                                    │\n│    68 def get_app_name(*, mod_data: ModuleData, app_name: Union[str, None] = None) -> str:                                                                                                                               │\n│    69 │   try:                                                                                                                                                                                                           │\n│ ❱  70 │   │   mod = importlib.import_module(mod_data.module_import_str)                                                                                                                                                  │\n│    71 │   except (ImportError, ValueError) as e:                                                                                                                                                                         │\n│    72 │   │   logger.error(f\"Import error: {e}\")                                                                                                                                                                         │\n│    73 │   │   logger.warning(                                                                                                                                                                                            │\n│                                                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────╮                         │\n│ │ app_name = None                                                                                                                                                                              │                         │\n│ │ mod_data = ModuleData(                                                                                                                                                                       │                         │\n│ │            │   module_import_str='src.main',                                                                                                                                                 │                         │\n│ │            │   extra_sys_path=PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine'),                                                                                        │                         │\n│ │            │   module_paths=[                                                                                                                                                                │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src'),                                                                                               │                         │\n│ │            │   │   PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py')                                                                                        │                         │\n│ │            │   ]                                                                                                                                                                             │                         │\n│ │            )                                                                                                                                                                                 │                         │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                         │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/importlib/__init__.py:88 in import_module                                                                                         │\n│                                                                                                                                                                                                                          │\n│    85 │   │   │   if character != '.':                                                         ╭─────── locals ───────╮                                                                                                  │\n│    86 │   │   │   │   break                                                                    │   level = 0          │                                                                                                  │\n│    87 │   │   │   level += 1                                                                   │    name = 'src.main' │                                                                                                  │\n│ ❱  88 │   return _bootstrap._gcd_import(name[level:], package, level)                          │ package = None       │                                                                                                  │\n│    89                                                                                          ╰──────────────────────╯                                                                                                  │\n│    90                                                                                                                                                                                                                    │\n│    91 _RELOADING = {}                                                                                                                                                                                                    │\n│ in _gcd_import:1387                                                                                                                                                                                                      │\n│ ╭─────── locals ───────╮                                                                                                                                                                                                 │\n│ │   level = 0          │                                                                                                                                                                                                 │\n│ │    name = 'src.main' │                                                                                                                                                                                                 │\n│ │ package = None       │                                                                                                                                                                                                 │\n│ ╰──────────────────────╯                                                                                                                                                                                                 │\n│ in _find_and_load:1360                                                                                                                                                                                                   │\n│ ╭──────────────── locals ─────────────────╮                                                                                                                                                                              │\n│ │ module = <object object at 0x100ab4050> │                                                                                                                                                                              │\n│ │   name = 'src.main'                     │                                                                                                                                                                              │\n│ ╰─────────────────────────────────────────╯                                                                                                                                                                              │\n│ in _find_and_load_unlocked:1331                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────────────────╮ │\n│ │         child = 'main'                                                                                                                                                                                               │ │\n│ │          name = 'src.main'                                                                                                                                                                                           │ │\n│ │        parent = 'src'                                                                                                                                                                                                │ │\n│ │ parent_module = <module 'src' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/__init__.py'>                                                                                                      │ │\n│ │   parent_spec = ModuleSpec(name='src', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e5850>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/__init__.py',               │ │\n│ │                 submodule_search_locations=['/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src'])                                                                                                        │ │\n│ │          path = ['/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src']                                                                                                                                    │ │\n│ │          spec = ModuleSpec(name='src.main', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py')              │ │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯ │\n│ in _load_unlocked:935                                                                                                                                                                                                    │\n│ ╭───────────────────────────────────────────────────────────────────────────────────────────── locals ─────────────────────────────────────────────────────────────────────────────────────────────╮                     │\n│ │ module = <module 'src.main' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py'>                                                                                        │                     │\n│ │   spec = ModuleSpec(name='src.main', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py') │                     │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                     │\n│ in exec_module:1023                                                                                                                                                                                                      │\n│ ╭─────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────╮                                                                                 │\n│ │   code = <code object <module> at 0xa435edc00, file \"/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py\", line 1> │                                                                                 │\n│ │ module = <module 'src.main' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py'>                            │                                                                                 │\n│ │   self = <_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>                                                         │                                                                                 │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                                                                                 │\n│ in _call_with_frames_removed:488                                                                                                                                                                                         │\n│ ╭────────────────────────────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────────────────────────────╮  │\n│ │ args = (                                                                                                                                                                                                            │  │\n│ │        │   <code object <module> at 0xa435edc00, file \"/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py\", line 1>,                                                                             │  │\n│ │        │   {                                                                                                                                                                                                        │  │\n│ │        │   │   '__name__': 'src.main',                                                                                                                                                                              │  │\n│ │        │   │   '__doc__': 'Legal AI Engine - FastAPI Service.\\n\\nThis service provides AI-powered legal assis'+185,                                                                                                 │  │\n│ │        │   │   '__package__': 'src',                                                                                                                                                                                │  │\n│ │        │   │   '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>,                                                                                                                   │  │\n│ │        │   │   '__spec__': ModuleSpec(name='src.main', loader=<_frozen_importlib_external.SourceFileLoader object at 0x1091e58b0>, origin='/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py'), │  │\n│ │        │   │   '__file__': '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py',                                                                                                                 │  │\n│ │        │   │   '__cached__': '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/__pycache__/main.c'+14,                                                                                                 │  │\n│ │        │   │   '__builtins__': {                                                                                                                                                                                    │  │\n│ │        │   │   │   '__name__': 'builtins',                                                                                                                                                                          │  │\n│ │        │   │   │   '__doc__': 'Built-in functions, types, exceptions, and other objects.\\n\\nThis module provides '+346,                                                                                             │  │\n│ │        │   │   │   '__package__': '',                                                                                                                                                                               │  │\n│ │        │   │   │   '__loader__': <class '_frozen_importlib.BuiltinImporter'>,                                                                                                                                       │  │\n│ │        │   │   │   '__spec__': ModuleSpec(name='builtins', loader=<class '_frozen_importlib.BuiltinImporter'>, origin='built-in'),                                                                                  │  │\n│ │        │   │   │   '__build_class__': <built-in function __build_class__>,                                                                                                                                          │  │\n│ │        │   │   │   '__import__': <built-in function __import__>,                                                                                                                                                    │  │\n│ │        │   │   │   'abs': <built-in function abs>,                                                                                                                                                                  │  │\n│ │        │   │   │   'all': <built-in function all>,                                                                                                                                                                  │  │\n│ │        │   │   │   'any': <built-in function any>,                                                                                                                                                                  │  │\n│ │        │   │   │   ... +149                                                                                                                                                                                         │  │\n│ │        │   │   },                                                                                                                                                                                                   │  │\n│ │        │   │   '__annotations__': {},                                                                                                                                                                               │  │\n│ │        │   │   'asyncio': <module 'asyncio' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/asyncio/__init__.py'>,                                                     │  │\n│ │        │   │   ... +27                                                                                                                                                                                              │  │\n│ │        │   }                                                                                                                                                                                                        │  │\n│ │        )                                                                                                                                                                                                            │  │\n│ │    f = <built-in function exec>                                                                                                                                                                                     │  │\n│ │ kwds = {}                                                                                                                                                                                                           │  │\n│ ╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯  │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/main.py:46 in <module>                                                                                                                                     │\n│                                                                                                                                                                                                                          │\n│     43 │   ValidationError,                                                                                                                                                                                              │\n│     44 )                                                                                                                                                                                                                 │\n│     45 from .langfuse_init import flush                                                                                                                                                                                  │\n│ ❱   46 from .models.requests import (                                                                                                                                                                                    │\n│     47 │   AskQuestionRequest,                                                                                                                                                                                           │\n│     48 │   ClassifyCaseRequest,                                                                                                                                                                                          │\n│     49 │   ClarificationAnswerRequest,                                                                                                                                                                                   │\n│                                                                                                                                                                                                                          │\n│ ╭─────────────────────────────────────────────────────────────────────────────── locals ───────────────────────────────────────────────────────────────────────────────╮                                                 │\n│ │      _env_path = PosixPath('/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.env')                                                                         │                                                 │\n│ │ AsyncGenerator = typing.AsyncGenerator                                                                                                                               │                                                 │\n│ │        asyncio = <module 'asyncio' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/asyncio/__init__.py'>                │                                                 │\n│ │        logging = <module 'logging' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/logging/__init__.py'>                │                                                 │\n│ │     sentry_sdk = <module 'sentry_sdk' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/sentry_sdk/__init__.py'>    │                                                 │\n│ │         status = <module 'starlette.status' from '/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/.venv/lib/python3.13/site-packages/starlette/status.py'> │                                                 │\n│ │           time = <module 'time' (built-in)>                                                                                                                          │                                                 │\n│ │           uuid = <module 'uuid' from '/Users/piteer/.local/share/uv/python/cpython-3.13.11-macos-aarch64-none/lib/python3.13/uuid.py'>                               │                                                 │\n│ ╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                                                 │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/models/__init__.py:7 in <module>                                                                                                                           │\n│                                                                                                                                                                                                                          │\n│    4 \"\"\"                                                                                                                                                                                                                 │\n│    5                                                                                                                                                                                                                     │\n│    6 # Request models                                                                                                                                                                                                    │\n│ ❱  7 from .requests import (                                                                                                                                                                                             │\n│    8 │   AskQuestionRequest,                                                                                                                                                                                             │\n│    9 │   ClassifyCaseRequest,                                                                                                                                                                                            │\n│   10 │   ClarificationAnswer,                                                                                                                                                                                            │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/models/requests.py:106 in <module>                                                                                                                         │\n│                                                                                                                                                                                                                          │\n│   103 │   CLARIFICATION_QUESTION = \"CLARIFICATION_QUESTION\"  # Response contains clarification                                                                                                                           │\n│   104                                                                                                                                                                                                                    │\n│   105                                                                                                                                                                                                                    │\n│ ❱ 106 class AskQuestionRequest(BaseModel):                                                                                                                                                                               │\n│   107 │   \"\"\"Request to ask a legal question or submit clarification answers.                                                                                                                                            │\n│   108 │                                                                                                                                                                                                                  │\n│   109 │   This unified request model handles both:                                                                                                                                                                       │\n│                                                                                                                                                                                                                          │\n│ /Users/piteer/workspace/radca-prawny/legal/apps/ai-engine/src/models/requests.py:129 in AskQuestionRequest                                                                                                               │\n│                                                                                                                                                                                                                          │\n│   126 │   │   default=None,                                                                                                                                                                                              │\n│   127 │   │   description=\"Original question that prompted clarification (required for CLARIFI                                                                                                                           │\n│   128 │   )                                                                                                                                                                                                              │\n│ ❱ 129 │   clarification_answers: list[ClarificationAnswer] | None = Field(                                                                                                                                               │\n│   130 │   │   default=None,                                                                                                                                                                                              │\n│   131 │   │   description=\"User's answers to clarification questions (required for CLARIFICATI                                                                                                                           │\n│   132 │   )                                                                                                                                                                                                              │\n│                                                                                                                                                                                                                          │\n│ ╭──────────────────────────────────────────────────────────────────────────────────────── locals ────────────────────────────────────────────────────────────────────────────────────────╮                               │\n│ │ clarification_answers = FieldInfo(annotation=NoneType, required=False, default=None, description=\"User's answers to clarification questions (required for CLARIFICATION_ANSWER)\")      │                               │\n│ │          message_type = FieldInfo(annotation=NoneType, required=False, default=<MessageType.QUESTION: 'QUESTION'>, description='Type of message: QUESTION or CLARIFICATION_ANSWER')    │                               │\n│ │                  mode = FieldInfo(annotation=NoneType, required=False, default='SIMPLE', description='Response mode: LAWYER (detailed) or SIMPLE (layperson)')                         │                               │\n│ │     original_question = FieldInfo(annotation=NoneType, required=False, default=None, description='Original question that prompted clarification (required for CLARIFICATION_ANSWER'+1) │                               │\n│ │              question = FieldInfo(annotation=NoneType, required=True, description='Legal question to answer', metadata=[MinLen(min_length=5)])                                         │                               │\n│ │            session_id = FieldInfo(annotation=NoneType, required=True, description='User session ID for tracking')                                                                      │                               │\n│ ╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯                               │\n╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯\nNameError: name 'ClarificationAnswer' is not defined\n ELIFECYCLE  Command failed with exit code 1.\n WARN   Local package.json exists, but node_modules missing, did you mean to install?\ncommand finished with error: command (/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine) /opt/homebrew/bin/pnpm run dev exited (1)\n└─ @legal/ai-engine#dev ──\n@legal/ai-engine#dev: command (/Users/piteer/workspace/radca-prawny/legal/apps/ai-engine) /opt/homebrew/bin/pnpm run dev exited (1)\n",
      "timestamp": "2026-01-29T08:57:26.139Z",
      "source": "initial"
    }
  ],
  "startedAt": "2026-01-29T08:57:26.193Z"
}