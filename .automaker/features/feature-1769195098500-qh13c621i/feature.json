{
  "category": "Uncategorized",
  "description": "## Parent Task Context (Already Completed)\n\n> **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.\n\n### Analyze CSRF Token Endpoint Configuration\n\n**Description:** Investigate why CSRF token requests are hitting /api/api/csrf-token (double api prefix) instead of the correct endpoint. Examine the GraphQL client configuration, CSRF token fetching logic, and backend route registration. Identify where the duplicate /api/ prefix is being introduced in the request path.\n\n---\n\n## Task Description\n\nAfter changes with csrf token, now the same chat endpoint returns bad request exception:\n\n{\n    \"errors\": [\n        {\n            \"message\": \"Bad Request Exception\",\n            \"locations\": [\n                {\n                    \"line\": 3,\n                    \"column\": 13\n                }\n            ],\n            \"path\": [\n                \"askLegalQuestion\"\n            ],\n            \"extensions\": {\n                \"code\": \"BAD_REQUEST\",\n                \"stacktrace\": [\n                    \"BadRequestException: Bad Request Exception\",\n                    \"    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)\",\n                    \"    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)\",\n                    \"    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\",\n                    \"    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)\",\n                    \"    at async Promise.all (index 0)\",\n                    \"    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)\",\n                    \"    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17\"\n                ],\n                \"originalError\": {\n                    \"message\": [\n                        \"Session ID must be a valid UUID v4\"\n                    ],\n                    \"error\": \"Bad Request\",\n                    \"statusCode\": 400\n                }\n            }\n        }\n    ],\n    \"data\": null\n}",
  "title": "Fix chat endpoint validation for session ID",
  "images": [],
  "imagePaths": [],
  "textFilePaths": [],
  "skipTests": false,
  "model": "claude-opus",
  "thinkingLevel": "none",
  "reasoningEffort": "none",
  "branchName": "002-legal-ai-core",
  "priority": 2,
  "planningMode": "skip",
  "requirePlanApproval": false,
  "dependencies": [
    "analyze-csrf-token-endpoint-issue"
  ],
  "workMode": "current",
  "titleGenerating": false,
  "status": "completed",
  "id": "feature-1769195098500-qh13c621i",
  "descriptionHistory": [
    {
      "description": "## Parent Task Context (Already Completed)\n\n> **Note:** The following parent task has already been completed. This context is provided to help you understand the background and requirements for this sub-task. Do not re-implement the parent task - focus only on the new sub-task described below.\n\n### Analyze CSRF Token Endpoint Configuration\n\n**Description:** Investigate why CSRF token requests are hitting /api/api/csrf-token (double api prefix) instead of the correct endpoint. Examine the GraphQL client configuration, CSRF token fetching logic, and backend route registration. Identify where the duplicate /api/ prefix is being introduced in the request path.\n\n---\n\n## Task Description\n\nAfter changes with csrf token, now the same chat endpoint returns bad request exception:\n\n{\n    \"errors\": [\n        {\n            \"message\": \"Bad Request Exception\",\n            \"locations\": [\n                {\n                    \"line\": 3,\n                    \"column\": 13\n                }\n            ],\n            \"path\": [\n                \"askLegalQuestion\"\n            ],\n            \"extensions\": {\n                \"code\": \"BAD_REQUEST\",\n                \"stacktrace\": [\n                    \"BadRequestException: Bad Request Exception\",\n                    \"    at ValidationPipe.exceptionFactory (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:107:20)\",\n                    \"    at ValidationPipe.transform (/app/node_modules/.pnpm/@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_reflect-metadata@0.2.2_rxjs@7.8.2/node_modules/@nestjs/common/pipes/validation.pipe.js:74:30)\",\n                    \"    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\",\n                    \"    at async resolveParamValue (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:136:31)\",\n                    \"    at async Promise.all (index 0)\",\n                    \"    at async pipesFn (/app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:138:13)\",\n                    \"    at async /app/node_modules/.pnpm/@nestjs+core@11.1.11_@nestjs+common@11.1.11_class-transformer@0.5.1_class-validator@0.14.3_re_dbqbm4zvibvqpchgjldjj4kszy/node_modules/@nestjs/core/helpers/external-context-creator.js:66:17\"\n                ],\n                \"originalError\": {\n                    \"message\": [\n                        \"Session ID must be a valid UUID v4\"\n                    ],\n                    \"error\": \"Bad Request\",\n                    \"statusCode\": 400\n                }\n            }\n        }\n    ],\n    \"data\": null\n}",
      "timestamp": "2026-01-23T19:04:58.613Z",
      "source": "initial"
    }
  ],
  "startedAt": "2026-01-23T19:04:58.664Z",
  "updatedAt": "2026-01-23T19:08:23.853Z"
}