# Implementation Plan: Core Legal AI Features

**Branch**: `002-legal-ai-core` | **Date**: 2025-12-09 | **Spec**: [specs/002-legal-ai-core/spec.md](specs/002-legal-ai-core/spec.md)
**Input**: Feature specification from `/specs/002-legal-ai-core/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

The goal is to build the core of the Legal AI platform, enabling users to generate legal documents, ask legal questions, and search for court rulings. The system will be architected as a monorepo containing:

1.  **Frontend**: A Next.js application using Refine.dev, Shadcn UI, and Tailwind CSS.
2.  **Core Backend**: A Nest.js modular monolith using `nestjs-query` for standard CRUD and adhering to strict module boundaries with asynchronous event-driven communication.
3.  **AI Engine**: A Python service using FastAPI, PydanticAI, and LangGraph for complex agentic workflows.

## Technical Context

<!--
  ACTION REQUIRED: Replace the content in this section with the technical details
  for the project. The structure here is presented in advisory capacity to guide
  the iteration process.
-->

**Language/Version**: TypeScript 5+ (Node.js 20+), Python 3.11+
**Primary Dependencies**:

- **Frontend**: Next.js, Refine.dev, Shadcn UI, Tailwind CSS, `react-i18next`, `@graphql-codegen/cli`
- **Backend**: Nest.js, `nestjs-query` (Code-First GraphQL), `@nestjs/event-emitter`, `@nestjs/bull`, `bull`, `nestjs-openapi`
- **AI**: FastAPI, PydanticAI (Code-First), LangGraph, LangChain
  **Storage**: PostgreSQL (Primary), Redis (Bull Queue)
  **Testing**: Jest/Vitest (TS), Pytest (Python)
  **Target Platform**: Docker/Cloud Container
  **Project Type**: Monorepo (Turborepo)
  **Performance Goals**: AI draft generation < 30s
  **Constraints**:
- Domain Driven Design
- Modular Monolith (Strict boundaries, async events only, CQRS)
- English-first codebase
- Strong Typing (No `any`)
- Autogenerated Clients (Internal & Public)
  **Scale/Scope**: MVP of core features

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

- [x] **Domain-Driven Design**: Plan prioritizes domain entities and separation.
- [x] **Modular Monolith & CQRS**: Backend structure enforces module boundaries and read/write separation where needed, though using one and the same tables/databases for now.
- [x] **Defined Technology Stack**: Next.js/Refine, Nest.js, Python/FastAPI aligned with Constitution.
- [x] **AI-First Capabilities**: Architecture explicitly separates and integrates AI service.
- [x] **English-First**: Plan written in English.
- [x] **Monorepo Structure**: Project structure reflects monorepo.
- [x] **Code-First & Strong Typing**: API contracts generated from code; strict typing enforced.

## Project Structure

### Documentation (this feature)

```text
specs/002-legal-ai-core/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (Empty - Code First)
└── tasks.md             # Phase 2 output (/speckit.tasks command)
```

### Source Code (repository root)

```text
apps/
├── web/                  # Next.js + Refine.dev frontend
│   ├── src/
│   │   ├── app/
│   │   ├── components/
│   │   └── providers/
├── backend/              # Nest.js Modular Monolith
│   ├── src/
│   │   ├── app.module.ts
│   │   ├── [module-name]/ # Unit tests (.spec.ts) co-located here
│   │   └── shared/       # Shared kernel/infrastructure
│   └── tests/            # Tests outside specific modules
│       ├── integration/  # Integration tests
│       └── e2e/          # Use-case driven E2E tests
└── ai-engine/            # Python FastAPI AI Service
    ├── src/
    │   ├── main.py
    │   ├── agents/
    │   └── graphs/       # LangGraph definitions
    └── tests/
        ├── unit/         # Unit tests
        ├── integration/  # Integration tests
        └── e2e/          # End-to-end tests

packages/                 # Shared libraries (optional)
├── ui/                   # Shared UI components (shadcn)
├── types/                # Shared Types/DTOs
└── config/               # Shared ESLint/TSConfig
```

**Structure Decision**: Monorepo with three main applications.

- **Backend Testing**: Unit tests co-located (`.spec.ts`), Integration/E2E separated in `tests/`.
- **AI Testing**: Standard Python structure with `unit`, `integration`, `e2e` separation.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
| --------- | ---------- | ------------------------------------ |
| N/A       |            |                                      |
