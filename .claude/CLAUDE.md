# Legal AI Platform - Claude Instructions

## Core Principles

- **Domain-Driven Design (DDD)**: Software model must reflect the legal business domain.
- **Modular Monolith**: Strict boundaries between modules in `apps/backend/src/modules`. No direct imports across modules. Communication via asynchronous events.
- **English-First**: All code, comments, and commit messages in English.
- **Strong Typing**: No `any` (TS) or untyped `Dict`/`Any` (Python).
- **Simplicity**: YAGNI. Concise code. Avoid over-engineering.

## Tech Stack

- **Web**: Next.js, refine.dev, Tailwind CSS, shadcn/ui.
- **Backend**: Nest.js, `@ptc-org/nestjs-query`, GraphQL (Code-First), PostgreSQL.
- **AI Service**: Python, FastAPI, PydanticAI, LangGraph.
- **Package Managers**: `pnpm` (Node), `uv` (Python).

## Build & Development Commands

- **Full Project**:
  - Dev: `pnpm dev`
  - Build: `pnpm build`
  - Lint: `pnpm lint`
  - Format: `pnpm format`
- **Frontend (@legal/web)**: `pnpm dev:web`
- **Backend (@legal/backend)**: `pnpm dev:backend`
- **AI Engine (Python)**:
  - Dev: `uv run dev` (inside `apps/ai-engine`)
  - Test: `uv run pytest`
  - Export OpenAPI: `uv run export-openapi`

## Testing

- **Monorepo-wide**: `pnpm test`
- **E2E**: `pnpm test:e2e`
- **Integration**: `pnpm test:integration`
- **AI Engine**: `uv run pytest` (inside `apps/ai-engine`)

## Coding & Architecture Guidelines

- **Commits**: Follow [Conventional Commits](https://www.conventionalcommits.org/).
- **API Strategy**:
  - Service-to-Service: REST (OpenAPI autogenerated clients).
  - Frontend-Backend: GraphQL exclusively (autogenerated clients). NO REST for frontend.
- **NestJS Query**: Use auto-generated resolvers for standard CRUD. Use custom resolvers ONLY for business logic (AI triggers, etc.).
- **Async Communication**: Use events for cross-module interaction in the backend.
- **SSOT**: Environment variables are the only source for secrets/config.
