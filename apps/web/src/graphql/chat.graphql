# GraphQL Operations for Chat Module
# Contains queries and mutations for legal Q&A functionality

# Fragment for LegalQuery fields - reused across queries and mutations
fragment LegalQueryFragment on LegalQuery {
  id
  question
  answerMarkdown
  citations {
    source
    url
    excerpt
    article
  }
  sessionId
  createdAt
  updatedAt
}

# Mutation: Ask a legal question and get AI answer synchronously
mutation AskLegalQuestion($input: AskLegalQuestionInput!) {
  askLegalQuestion(input: $input) {
    ...LegalQueryFragment
  }
}

# Query: Get a single legal query by ID
query GetLegalQuery($id: ID!) {
  legalQuery(id: $id) {
    ...LegalQueryFragment
  }
}

# Query: Get all queries for a specific session (for chat history)
# Uses the queriesBySession field from the Query type
query GetSessionQueries($sessionId: String!) {
  queriesBySession(sessionId: $sessionId) {
    ...LegalQueryFragment
  }
}

# Query: Get pending queries (queries without answers)
query GetPendingQueries {
  pendingQueries {
    ...LegalQueryFragment
  }
}

# Clarification Session Fragment
fragment ClarificationSessionFragment on ClarificationSession {
  id
  state
  originalQuery
  questionsAsked
  answersReceived {
    question
    answer
    question_type
  }
  rounds
  accumulatedContext
  finalQueryId
  completedAt
  expiresAt
  createdAt
  updatedAt
}

# Mutation: Submit answers to clarification questions
mutation SubmitClarificationAnswers($input: SubmitClarificationAnswersInput!) {
  submitClarificationAnswers(input: $input) {
    ...ClarificationSessionFragment
  }
}

# Mutation: Cancel an active clarification session
mutation CancelClarificationSession($input: CancelClarificationSessionInput!) {
  cancelClarificationSession(input: $input) {
    ...ClarificationSessionFragment
  }
}

# Query: Get active clarification session for a query
query GetClarificationSessionByQuery($queryId: ID!) {
  clarificationSessionByQuery(queryId: $queryId) {
    ...ClarificationSessionFragment
  }
}
